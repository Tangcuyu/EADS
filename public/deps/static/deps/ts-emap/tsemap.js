/*!
 * 
 *  Thu Aug 29 2019 14:24:54 GMT+0800 (中国标准时间)
 *  版本：3.1.0
 * 
 */
!function(e,t){if("object"==typeof exports&&"object"==typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var i=t();for(var r in i)("object"==typeof exports?exports:e)[r]=i[r]}}(window,function(){return function(e){var t={};function i(r){if(t[r])return t[r].exports;var o=t[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,i),o.l=!0,o.exports}return i.m=e,i.c=t,i.d=function(e,t,r){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(i.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)i.d(r,o,function(t){return e[t]}.bind(null,o));return r},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="",i(i.s=24)}([function(e,t,i){"use strict";var r,o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};void 0===(r=function(){var e=window.G||{};window.G=e,e.import=e.import||{},"function"!=typeof String.prototype.endsWith&&(String.prototype.endsWith=function(e){return-1!==this.indexOf(e,this.length-e.length)}),"function"!=typeof String.prototype.startsWith&&(String.prototype.startsWith=function(e){return this.slice(0,e.length)===e});var t={_showLoading:function(e){},isFunction:function(e){return"[object Function]"===Object.prototype.toString.call(e)},isArray:function(e){return"[object Array]"===Object.prototype.toString.call(e)},isObject:function(e){return"[object Object]"===Object.prototype.toString.call(e)},isString:function(e){return"[object String]"===Object.prototype.toString.call(e)},isEmptyObject:function(e){for(var t in e)return!1;return!0},ajaxGet:function(e,i,r,o){var n=jQuery.extend({},e);return n.type="get",n.success=function(n,a,s){e.showLoading&&t._showLoading(!1),t.isFunction(i)&&i.call(r,n,a,s,o)},n.error=function(n,a,s){e.showLoading&&t._showLoading(!1),console.error(e.url+" request failed!"),t.isFunction(i)&&i.call(r,null,a,n,o)},e.showLoading&&t._showLoading(!0),jQuery.ajax(n)},ajaxPost:function(e,i,r,o){var n=jQuery.extend({},e);return n.type="post",n.success=function(n,a,s){t.isFunction(i)&&i.call(r,n,a,s,o),e.showLoading&&t._showLoading(!1)},n.error=function(n,a,s){t.isFunction(i)&&i.call(r,null,a,n,o),e.showLoading&&t._showLoading(!1)},e.showLoading&&t._showLoading(!0),jQuery.ajax(n)},cancelRequest:function(e){if(e instanceof XMLHttpRequest&&4!=e.readyState)try{e.abort()}catch(e){}},getConfig:function(e){var i;e=e||{};return t.ajaxGet({url:e.url,dataType:"json",async:!1},function(e){i=e||{}}),i}};return Date.prototype.format=function(e){var t={"M+":this.getMonth()+1,"d+":this.getDate(),"h+":this.getHours(),"m+":this.getMinutes(),"s+":this.getSeconds(),"q+":Math.floor((this.getMonth()+3)/3),S:this.getMilliseconds()};for(var i in/(y+)/.test(e)&&(e=e.replace(RegExp.$1,(this.getFullYear()+"").substr(4-RegExp.$1.length))),t)new RegExp("("+i+")").test(e)&&(e=e.replace(RegExp.$1,1==RegExp.$1.length?t[i]:("00"+t[i]).substr((""+t[i]).length)));return e},t.assertWithin=function(e,i){var r=function(e,t){return null!=t&&(t instanceof RegExp?t.test(e):!!function(e,t){return"null"==t.toLowerCase()&&(null==e||""==e)}(e,t)||void 0)}(e,i);if(null!=r)return r;if(i.indexOf("※")>=0)return function(e,i,r){for(var o=e.split(r),n=0,a=o.length;n<a;n++){var s=o[n];if(s&&t.assertWithin(i,s))return!0}return!1}(i,e,"※");var o=function(e,t){if(i=i.trim(),0==/[\[\(\)\]].*/i.test(i))return e==i;if(e=parseFloat(e),isNaN(e))return!1;var r=i.replace(/[\[\]\(\)]/g,"").split(",");return 1==r.length?e==parseFloat(r[0]):void 0}(e);if(null!=o)return o;var n=function(e,t){if(t&&(t=t.trim()),!/[\[\(\)\]].*/i.test(t))return e==t;if(e=parseFloat(e),isNaN(e))return!1;var i=t.replace(/[\[\]\(\)]/g,"").split(",");if(1==i.length)return e==parseFloat(i[0]);for(var r=parseFloat(i[0]),o=parseFloat(i[1]),n=[function(e,t){if(!isNaN(r)&&isNaN(o)){if(t.startsWith("["))return e>=r;if(t.startsWith("("))return e>r}},function(e,t){if(isNaN(r)&&!isNaN(o)){if(t.endsWith("]"))return e<=o;if(t.endsWith(")"))return e<o}},function(e,t){var i=!0;return t.startsWith("[")?i=i&&e>=r:t.startsWith("(")&&(i=i&&e>r),!!i&&(t.endsWith("]")?i=i&&e<=o:t.endsWith(")")&&(i=i&&e<o),i)}],a=void 0,s=0,l=n.length;s<l&&null==(a=n[s](e,t));s++);return a}(e,i);return null!=n&&n},t.getEquivalentNum=function(e,t,i){var r=parseInt(e),o=t,n=i=i||10;if(isNaN(r))return n;var a=r+"",s=a.length;n=(s-1)*t;for(var l=0;l<s;l++){n+=parseInt(a[l])*(o/=10)}return n<i&&(n=i),Math.round(n)},t.getValByVarPath=function(e){var t=null;if(e){for(var i=e.split("."),r=window,o=0,n=i.length;o<n;o++){var a=i[o];if("window"!==a){if(!r)break;r=r[a]}}t=r}return t},t.lastId=0,t.stamp=function(e){return e instanceof Object?(e._unique_id=e._unique_id||++this.lastId,e._unique_id):NaN},t.newUUID=function(){var e=function(){return(65536*(1+Math.random())|0).toString(16).substring(1)};return e()+e()+"-"+e()+"-"+e()+"-"+e()+"-"+e()+e()+e()},t.newUUID32=function(){return this.newUUID().replace(/-/g,"")},t.replacePlaceHolder=function(e,t){if(!t)return"";var i=/([\w\_\-\d]+)/g,r=t.match(/(\$\{[\w\_\-\d]{0,}\})/g),o=t;if(r&&r.length>0)for(var n=0,a=r.length;n<a;n++){var s=r[n],l="",c=s.match(i);c&&1==c.length&&(l=e[c[0]]||""),o=o.replace(s,l)}return o},t.Browser=function(){function e(e,t){return-1!==e.indexOf(t)}var t,i="ActiveXObject"in window,r=function(e){return e&&!document.addEventListener}(i),n=navigator.userAgent.toLowerCase(),a=e(n,"webkit"),s=e(n,"chrome"),l=e(n,"phantom"),c=e(n,"android"),h=e(n,"android [23]"),p=e(n,"gecko"),u=("undefined"==typeof orientation?"undefined":o(orientation))!==void 0+"",f=!window.PointerEvent&&window.MSPointerEvent,y=function(e){return window.PointerEvent&&window.navigator.pointerEnabled||e}(f),d="devicePixelRatio"in window&&window.devicePixelRatio>1||"matchMedia"in window&&window.matchMedia("(min-resolution:144dpi)")&&window.matchMedia("(min-resolution:144dpi)").matches,m=document.documentElement,g=function(e,t){return e&&"transition"in t.style}(i,m),v=function(e){return"WebKitCSSMatrix"in window&&"m11"in new window.WebKitCSSMatrix&&!e}(h),_="MozPerspective"in m.style,b="OTransition"in m.style,w=(t=[g,v,_,b,l],!window.L_DISABLE_3D&&(t[0]||t[1]||t[2]||t[3])&&!t[4]),S=function(e,t){return!window.L_NO_TOUCH&&!e&&(t||"ontouchstart"in window||window.DocumentTouch&&document instanceof window.DocumentTouch)}(l,y);return{ie:i,ielt9:r,webkit:a,gecko:p&&!a&&!window.opera&&!i,android:c,android23:h,chrome:s,ie3d:g,webkit3d:v,gecko3d:_,opera3d:b,any3d:w,mobile:u,mobileWebkit:u&&a,mobileWebkit3d:u&&v,mobileOpera:u&&window.opera,touch:S,msPointer:f,pointer:y,retina:d}},t}.apply(t,[]))||(e.exports=r)},function(e,t,i){"use strict";var r,o;r=[i(8)],void 0===(o=function(e){return e.extend({options:{map:null},initialize:function(t){e.prototype.initialize.call(this,t)},destroy:function(){e.prototype.destroy.call(this)}})}.apply(t,r))||(e.exports=o)},function(e,t,i){"use strict";var r;void 0===(r=function(){var e={},t=null;return e._getLogger=function(){return null==t&&e.setOptions({type:"console"}),t},e.setOptions=function(e){if(e)if("log4js"===e.type){if(!window.log4javascript)throw new Error("log4javascript is not defined!");var i={popup:new log4javascript.PopupAppender,inpage:new log4javascript.InPageAppender};t=window.log4javascript.getLogger("main"),log.addAppender(i[e.appender||"popup"])}else t=(e.type,window.console)},e.info=function(t){e._getLogger().info(t)},e.trace=function(t){e._getLogger().trace(t)},e.debug=function(t){e._getLogger().debug(t)},e.warn=function(t){e._getLogger().warn(t)},e.error=function(t){e._getLogger().error(t)},e.clear=function(){e._getLogger().clear(obj)},e}.apply(t,[]))||(e.exports=r)},function(e,t,i){"use strict";var r,o;r=[i(0)],void 0===(o=function(e){var t={_wktReader:null,_wktWriter:null,_geoJSONReader:null,_geoJSONWriter:null,getWktReader:function(){return null==this._wktReader&&(this._wktReader=new jsts.io.WKTReader(new jsts.geom.GeometryFactory(new jsts.geom.PrecisionModel(1e5)))),this._wktReader},getWktWriter:function(){return null==this._wktWriter&&(this._wktWriter=new jsts.io.WKTWriter(new jsts.geom.GeometryFactory(new jsts.geom.PrecisionModel(1e5)))),this._wktWriter},getGeoJSONReader:function(){return null==this._geoJSONReader&&(this._geoJSONReader=new jsts.io.GeoJSONReader(new jsts.geom.GeometryFactory(new jsts.geom.PrecisionModel(1e5)))),this._geoJSONReader},getGeoJSONWriter:function(){return null==this._geoJSONWriter&&(this._geoJSONWriter=new jsts.io.GeoJSONWriter(new jsts.geom.GeometryFactory(new jsts.geom.PrecisionModel(1e5)))),this._geoJSONWriter}},i=/^\-?\d{0,}(\.\d{0,})?$/;return t.validateLngLat=function(t,r){if(i.test(t)&&i.test(r)){var o=parseFloat(t),n=parseFloat(r);if(e.assertWithin(o,"[-180,180]")&&e.assertWithin(n,"[-90,90]"))return[o,n]}return!1},t.validateCoordinate=function(e,t){return!(!i.test(e)||!i.test(t))&&[parseFloat(e),parseFloat(t)]},t.getSpiderfy=function(e,t,i,r,o){var n,a=1*(i=i||10),s=1*(o=o||28),l=1*(r=r||5)*2*Math.PI,c=0,h=[];for(n=t-1;n>=0;n--){c+=s/a+5e-4*n;var p=e[0]+a*Math.cos(c),u=e[1]+a*Math.sin(c);h[n]=[p,u],a+=l/c}return h},t.getCirclePonits=function(e){var t=e.center,i=e.count||128,r=parseFloat(e.radius),o=e.spatialReference||3857,n=2*Math.PI/i,a=360/i,s=[],l=t[0],c=t[1];if("4326"==o||"4490"==o)for(var h=0;h<i;h++){var p=a*h,u=this.getGeographyDistancePoint(t,p,r);s.push(u)}else for(h=0;h<i;h++){var f=n*h,y=l+r*Math.cos(f),d=c+r*Math.sin(f);s.push([y,d])}return s},t.getGeographyDistancePoint=function(t,i,r){if(!e.isArray(t))throw new Error("参数错误！");t[0]=l(t[0]),t[1]=l(t[1]),r/=6378137,i=i*Math.PI/180;var o=t[1]*Math.PI/180,n=t[0]*Math.PI/180,a=Math.asin(Math.sin(o)*Math.cos(r)+Math.cos(o)*Math.sin(r)*Math.cos(i)),s=n+Math.atan2(Math.sin(i)*Math.sin(r)*Math.cos(o),Math.cos(r)-Math.sin(o)*Math.sin(a));return isNaN(a)||isNaN(s)?null:[180*s/Math.PI,180*a/Math.PI];function l(e){var t=e;return Math.abs(t)<1e-5&&(t=1e-5),t}},t.getGeometryCenter=function(e){var t=new jsts.geom.GeometryFactory(new jsts.geom.PrecisionModel(1e5)),i=new jsts.io.WKTReader(t);if(e.getGeometryType()==g2.sfs.GeometryType.Point)return e;if(e.getGeometryType()==g2.sfs.GeometryType.Polyline)return e.middlePoint();if(e.getGeometryType()==g2.sfs.GeometryType.Polygon||e.getGeometryType()==g2.sfs.GeometryType.MultiPolygon){var r=i.read(e.asWkt()).getCentroid();return r=g2.sfs.GeometryFormatter.fromWKT(r.toString())}},t.meter2Rad=function(e){return 360*e/(2*Math.PI*6378137)},t.measureLength=function(e){if(!e instanceof g2.sfs.Polyline)throw new Error("参数类型错误！");var t=new g2.sfs.CoordinateTransform;return new g2.sfs.MeasureService({projectService:t}).length(e)},t.measureArea=function(e){if(!e instanceof g2.sfs.Polygon)throw new Error("参数类型错误！");var t=new g2.sfs.CoordinateTransform;return new g2.sfs.MeasureService({projectService:t}).area(e)},t.simplify=function(e,t){var i=e.getLength()/e.getNumPoints()*3.82;return i>t&&(i=t),e=jsts.simplify.DouglasPeuckerSimplifier.simplify(e,i)},t.toJstsGeometry=function(e){return(t._getJstsGeometry(e)||{}).geometry||null},t.fromJstsGeometry=function(e){var i={g2geom:1,wkt:2,geojson:3};if(!((e=e||{}).jstsGeom instanceof jsts.geom.Geometry&&i[e.type]))throw new Error("参数错误！");return t._fromJstsGeometry({geometry:e.jstsGeom,type:i[e.type],spatialReference:e.spatialReference})},t._getJstsGeometry=function(e){if(!e)return null;var i,r;if(e instanceof jsts.geom.Geometry)r=e,i=0;else if(null!=t._getG2GeometryType(e)){var o=e.asWkt();r=t.getWktReader().read(o),i=1}else"string"==typeof e?(r=t.getWktReader().read(e),i=2):(r=t.getGeoJSONReader().read(e),i=3);if(r){var n=t.getGeoJSONWriter().write(r);if(n&&n.type){if("POLYGON"==n.type.toUpperCase())c(n.coordinates);else if("MULTIPOLYGON"==n.type.toUpperCase())for(var a=n.coordinates,s=0,l=a.length;s<l;s++){c(a[s])}r=t.getGeoJSONReader().read(n)}}return{type:i,geometry:r};function c(e){for(var t=0,i=e.length;t<i;t++){var r=e[t],o=r[0],n=r[r.length-1];o&&2==o.length&&n&&2==n.length&&(o[0]==n[0]&&o[1]==n[1]||r.push([o[0],o[1]]))}}},t._fromJstsGeometry=function(e){var t=e.geometry,i=e.type||1,r=null;if(t)switch(i){case 1:(r=g2.sfs.GeometryFormatter.fromWKT(t.toString())).spatialReference=e.spatialReference||"4326";break;case 2:r=t.toString();break;case 3:"jsts.geom.GeometryCollection"==t.CLASS_NAME&&0==t.geometries.length&&(t=null),t&&(r=(r=g2.sfs.GeometryFormatter.fromWKT(t.toString())).asGeoJson())}return r},t._getG2GeometryType=function(t){var i=g2.sfs,r=null;for(var o in i){var n=i[o];if(e.isFunction(n)&&t instanceof n){r=n;break}}return r},t.getG2GeometryType=function(e){return t._getG2GeometryType(e)},t.getGeometryEnvlop=function(e){if(!e||e.length<1)return null;for(var t=null,i=null,r=0,o=[],n=0,a=e.length;n<a;n++){var s=e[n];if(s){var l=this._getJstsGeometry(s);if(l){var c=l.geometry;if(r=l.type,o.push(c),c)if(t)t.expandToInclude(c.getEnvelopeInternal());else if("jsts.geom.Point"==c.CLASS_NAME){var h=c.coordinate.x,p=c.coordinate.y;t=new jsts.geom.Envelope(h-1e-6,h+1e-6,p-1e-6,p+1e-6)}else t=c.getEnvelopeInternal()}}}if(t){var u="POLYGON((";switch(u+=t.getMinX()+" "+t.getMinY()+",",u+=t.getMaxX()+" "+t.getMinY()+",",u+=t.getMaxX()+" "+t.getMaxY()+",",u+=t.getMinX()+" "+t.getMaxY()+",",u+=t.getMinX()+" "+t.getMinY(),u+="))",r){case 1:i=g2.sfs.GeometryFormatter.fromWKT(u);break;case 2:i=u;break;case 3:i=(i=g2.sfs.GeometryFormatter.fromWKT(u)).asGeoJson()}}return i},t.getPlotEnvlop=function(e,i){var r=null,o=null;i=i||4326;if(e)for(var n in e){var a=e[n];if(a){var s=c(a);s&&(o=o?o.union(s).getEnvelope():s)}}if(o){var l=o.toString();(r=g2.sfs.GeometryFormatter.fromWKT(l)).spatialReference=i}return r;function c(e){for(var i=e.elements||[],r=[],o=null,n=0,a=i.length;n<a;n++){var s=i[n];if(s){var l=s.geometry;r.push(l.asWkt())}}if(r.length>0){var c=t._unionGeometry(r);o=t.getWktReader().read(c).getEnvelope()}return o}},t._unionGeometry=function(e){if(!e||e.length<1)return null;for(var t=0,i=e.length,r=null,o=null,n=0,a=360/(2*Math.PI*6378137);t<i;t++){var s,l=e[t],c=this._getJstsGeometry(l);c&&((s=c.geometry)instanceof jsts.geom.Point||(s=jsts.simplify.DouglasPeuckerSimplifier.simplify(s,a)),n=c.type),s&&(r?r.contains(s)||(r=r.within(s)?s:r.union(s)):r=s)}if(r)switch(n){case 1:o=g2.sfs.GeometryFormatter.fromWKT(r.toString());break;case 2:o=r.toString();break;case 3:o=(o=g2.sfs.GeometryFormatter.fromWKT(r.toString())).asGeoJson()}return o},t.esriGeom2TSGISGeom=function(e,t,i){var r=i;t.spatialReference&&(r=t.spatialReference.latestWkid);var o=ArcGISToGeoJSON.arcgisToGeoJSON(t);return g2.sfs.GeometryFactory.createGeometryFromGeoJson(o,r)},t}.apply(t,r))||(e.exports=o)},function(e,t,i){"use strict";var r;void 0===(r=function(){var e=(window.G||{}).lang={extend:function(e){var t,i,r,o;for(i=1,r=arguments.length;i<r;i++)for(t in o=arguments[i])e[t]=o[t];return e},create:Object.create||function(){function e(){}return function(t){return e.prototype=t,new e}}()};!function(){function t(e){return window["webkit"+e]||window["moz"+e]||window["ms"+e]}var i=0;function r(e){var t=+new Date,r=Math.max(0,16-(t-i));return i=t+r,window.setTimeout(e,r)}var o=window.requestAnimationFrame||t("RequestAnimationFrame")||r,n=window.cancelAnimationFrame||t("CancelAnimationFrame")||t("CancelRequestAnimationFrame")||function(e){window.clearTimeout(e)};e.requestAnimFrame=function(e,t,i){if(!i||o!==r)return o.call(window,function(e,t){var i=Array.prototype.slice;if(e.bind)return e.bind.apply(e,i.call(arguments,1));var r=i.call(arguments,2);return function(){return e.apply(t,r.length?r.concat(i.call(arguments)):arguments)}}(e,t));e.call(t)},e.cancelAnimFrame=function(e){e&&n.call(window,e)}}();var t=function(){};return t.setOptions=function(t,i){for(var r in t.hasOwnProperty("options")||(t.options=t.options?e.create(t.options):{}),i)t.options[r]=i[r];return t.options},t.extend=function(t){var i=function(){this.initialize&&this.initialize.apply(this,arguments),this.callInitHooks()},r=i.__super__=this.prototype,o=e.create(r);for(var n in o.constructor=i,i.prototype=o,this)this.hasOwnProperty(n)&&"prototype"!==n&&(i[n]=this[n]);return t.statics&&(e.extend(i,t.statics),delete t.statics),t.includes&&(e.extend.apply(null,[o].concat(t.includes)),delete t.includes),o.options&&(t.options=e.extend(e.create(o.options),t.options)),e.extend(o,t),o._initHooks=[],o.callInitHooks=function(){if(!this._initHooksCalled){r.callInitHooks&&r.callInitHooks.call(this),this._initHooksCalled=!0;for(var e=0,t=o._initHooks.length;e<t;e++)o._initHooks[e].call(this)}},i},t.include=function(t){return t="prototype"in t?t.prototype:t,e.extend(this.prototype,t),this},t.mergeOptions=function(t){return e.extend(this.prototype.options,t),this},t.addInitHook=function(e){var t=Array.prototype.slice.call(arguments,1),i="function"==typeof e?e:function(){this[e].apply(this,t)};return this.prototype._initHooks=this.prototype._initHooks||[],this.prototype._initHooks.push(i),this},t.defaults=function(e,t,i){for(var r in t)t.hasOwnProperty(r)&&(i?null!=t[r]:null==e[r])&&(e[r]=t[r]);return e},t.inherits=function(e,t){var i=e.prototype;function r(){}for(var o in r.prototype=t.prototype,e.prototype=new r,i)e.prototype[o]=i[o];e.prototype.constructor=e,e.superClass=t},t.mixin=function(e,i,r){e="prototype"in e?e.prototype:e,i="prototype"in i?i.prototype:i,t.defaults(e,i,r)},t.prototype={equals:function(e,t){return i(e,t)&&i(t,e);function i(e,t){if(e&&e.constructor==Object){if(t&&t.constructor==Object){for(var r in e){var o=e[r],n=t[r];if(!(i(o,n)&&i(n,o)))return!1}return!0}return!1}return e===t}}},t}.apply(t,[]))||(e.exports=r)},function(e,t,i){"use strict";var r,o;r=[i(0),i(3)],void 0===(o=function(e,t){var i={symbol2ImageHtml:function(e,t){var i;t=t||{};var r=this,o=e.$type.split(",")[0],n={PictureMarkerSymbol:function(){if(e.source.indexOf("data:image/png;base64,")>-1)var t=e.source;else t="data:image/png;base64,"+e.source;return console.log(e.source),console.log(t),console.log("============================"),i='<img src="'+t+'" alt="">'},SimpleMarkerSymbol:function(){var r=e.size;return r=r>10?10:r,isNaN(t.size)||(r=t.size),i='<svg width="25px" height="25px" version="1.0.0">',i+="<circle",i+=' cx="12" ',i+=' cy="12" ',i+=' r="'+r+'" ',i+=' stroke="'+c(e.borderColor)+'" ',i+=' stroke-opacity="'+e.borderColor.a/255+'" ',i+=' stroke-width="'+e.borderThickness+'" ',i+=' fill="'+c(e.fillColor)+'"',i+=' fill-opacity="'+e.fillColor.a/255+'" ',i+="></svg>"},SimpleLineSymbol:function(){i='<svg width="30px" height="20px" version="1.0.0">',i+="<line",i+=' x1="5" y1="10"',i+=' x2="25" y2="10"',i+=' stroke="'+c(e.color)+'" ';var t=parseInt(e.style);return 1!=t&&5!=t&&(i+=' stroke-dasharray="5,5"'),i+=' stroke-opacity="'+e.color.a/255+'" ',i+=' stroke-width="'+e.width+'" ',i+="></svg>"},SimpleFillSymbol:function(){return i='<svg width="30px" height="20px" version="1.0.0">',i+="<polygon",i+=' points="0,0,0,20,25,20,25,0" ',i+=' stroke="'+c(e.borderColor)+'" ',i+=' stroke-opacity="'+e.borderColor.a/255+'" ',i+=' stroke-width="'+e.borderThickness+'" ',i+=' fill="'+c(e.fillColor)+'"',i+=' fill-opacity="'+e.fillColor.a/255+'" ',i+="></svg>"},CurrencySymbol:function(){var t=e.markerSymbol||e.fillSymbol;i=r.symbol2ImageHtml(t);var o=e.textSymbol;if(o){i+='<span style="',i+="position: relative;",i+="left: -20px;",i+="top: -8px;",i+="font-size: 10px;";var n="#fff";return o.foreground&&(n=o.foreground.toHex().substr(0,7)),i+="color:"+n+";",o.fontFamilyName&&(i+="font-family:"+o.fontFamilyName+";"),o.fontWeight&&(i+="font-weight:"+o.fontWeight+";"),i+='">10</span>'}}};if(e&&"pixelcluster"==e.$type){var a=e.fillStrokeWidth||10,s=new g2.sfs.SimpleMarkerSymbol({borderColor:e.fillStrokeColor,fillColor:e.fillColor,borderThickness:a/2,size:a});i=function(e,i,r){var o=isNaN(e.borderThickness)?0:e.borderThickness,n=e.size,a=n+o,s=1,i=isNaN(i)?12:i,r=isNaN(r)?5:r;a>i&&(s=i/(a=i));o*=s,(n*=s)>r&&(o+=n-r,n=r);isNaN(t.size)||(n=t.size);var l=i,h='<svg width="25px" height="25px" version="1.0.0">';return h+="<circle",h+=' cx="'+l+'" ',h+=' cy="'+l+'" ',h+=' r="'+n+'" ',h+=' fill="rgb(255,255,255)"',h+=' fill-opacity="0" ',h+=' stroke="'+c(e.borderColor)+'"',h+=' stroke-width="'+o+'" ',h+=' stroke-opacity="'+e.borderColor.a/255+'" />',h+="<circle",h+=' cx="'+l+'" ',h+=' cy="'+l+'" ',h+=' r="'+n+'" ',h+=' fill="'+c(e.fillColor)+'"',h+=' fill-opacity="'+e.fillColor.a/255+'"/>',h+="</svg>"}(s,12,7),i+='<span style="',i+="position: relative;",i+="left: -16px;",i+="top: -8px;",i+="font-size: 10px;";var l="#fff";e.textFillColor&&(l=e.textFillColor.toHex().substr(0,7)),i+="color:"+l+";",i+='">1</span>'}else"function"==typeof n[o]&&(i=n[o]());return i;function c(e){if(e)return"rgb("+e.r+","+e.g+","+e.b+")"}},object2Symbol:function(t){if(0==arguments.length)throw new Error("参数错误！");if(1==arguments.length){t=arguments[0];if(e.isString(t))try{t=JSON.parse(t)}catch(e){}return i.object2Symbol(t.type,t.options)}var r=arguments[0],o=arguments[1],n={TextSymbol:function(e){return s(e,["foreground","borderColor"]),new g2.sfs.TextSymbol(e)},PictureMarkerSymbol:function(t){var i=t.source||"",r=t.sourceKey||"";return r=r.trim(),t.width=isNaN(t.width)?20:t.width,t.height=isNaN(t.height)?20:t.height,t.offsetX=isNaN(t.offsetX)?t.width/2:t.offsetX,t.offsetY=isNaN(t.offsetY)?t.height/2:t.offsetY,r&&!i&&(r.indexOf(".")<0?t.source=window[r]||G.icons[r]:t.source=e.getValByVarPath(r)),new g2.sfs.PictureMarkerSymbol(t)},SimpleMarkerSymbol:function(e){return e.size=isNaN(e.size)?5:e.size,e.offsetX=isNaN(e.offsetX)?e.size/2:e.offsetX,e.offsetY=isNaN(e.offsetY)?e.size/2:e.offsetY,s(e,["borderColor","fillColor"]),new g2.sfs.SimpleMarkerSymbol(e)},SimpleLineSymbol:function(e){return s(e,["color"]),new g2.sfs.SimpleLineSymbol(e)},SimpleFillSymbol:function(e){return s(e,["borderColor","fillColor"]),new g2.sfs.SimpleFillSymbol(e)}},a=n[r||"PictureMarkerSymbol"];if(!e.isFunction(a))throw new Error("type值错误！");return a(jQuery.extend(!0,{},o));function s(e,t){e=e||{};for(var r=0,o=(t=t||[]).length;r<o;r++){var n=t[r];e[n]&&(e[n]=i._getColor(e[n]))}}},symbol2Object:function(t){var r=null;if(t&&t.$type){var o=t.$type,n=/^(.*Symbol),http\:\/\/www.Gs.com$/;n.test(o)&&(r=n.exec(o)[1])}if(!r)throw new Error("参数类型错误！");var a=JSON.parse(JSON.stringify(t));delete a.$type,function(t){for(var r=["color","borderColor","fillColor","foreground"],o=0,n=r.length;o<n;o++){var a=r[o],s=t[a];e.isObject(s)&&(t[a]=i.color2Object(s))}}(a);return{type:{TextSymbol:"TextSymbol",SimpleMarkerSymbol:"SimpleMarkerSymbol",PictureMarkerSymbol:"PictureMarkerSymbol",SimpleLineSymbol:"SimpleLineSymbol",SimpleFillSymbol:"SimpleFillSymbol"}[r],options:a}},object2Color:function(e){return i._getColor(e)},color2Object:function(t){var i={};if(e.isString(t))try{t=g2.sfs.Color.fromHex(t)}catch(e){}return t&&"Color,http://www.Gs.com"==t.$type&&(i.alpha=t.a,i.r=t.r,i.g=t.g,i.b=t.b),i},_getColor:function(t){if(e.isObject(t)){var i=jQuery.extend(!0,{},t);return i.alpha&&(i.a=i.alpha,delete i.alpha),new g2.sfs.Color(i)}return"string"==typeof t?g2.sfs.Color.fromHex(t):t},geoinfoToElement:function(r,o,n){var a;console.log(o),a=o.$type?o:i.object2Symbol(o.type,o.options),console.log(a);var s,l=g2.sfs.GeometryFactory,c=e.isObject(r),h=e.isString(r);(n=n||{}).hasOwnProperty("id")||(n.id=e.newUUID32());var p=[];if(null!=t.getG2GeometryType(r)?s=r:c?s=l.createGeometryFromGeoJson(r):h&&(s=l.createGeometryFromWkt(r)),s){if(n.layer instanceof g2.carto.FeatureLayer){var u=new g2.sfs.Feature({geometry:s,values:n.property});return u.symbol=a,u.id=n.id,u.name=n.name,u}var f=new g2.sfs.Element({geometry:s,symbol:a,id:n.id,name:n.name}),y=n.property,d=new g2.sfs.Attribute({name:"data",value:y});return p.push(d),f.attributeSet.attributes=p,n.layer&&n.layer.add(f),f}throw new Error("geoinfo格式错误！")}};return i}.apply(t,r))||(e.exports=o)},function(e,t,i){var r;void 0===(r=function(){var e,t=Array.prototype.slice,i=function(e){this._$handlers={},e&&e.map instanceof G.Map&&this.delegateMapEvents(e.map)};return(i.prototype={constructor:i,once:function(e,t,i){this._$handlers||(this._$handlers={});var r=this._$handlers;if(!t||!e)return this;r[e]||(r[e]=[]);for(var o=0;o<r[e].length;o++)if(r[e][o].h===t)return this;return r[e].push({h:t,one:!0,ctx:i||this}),this},addEventListener:function(e,t,i){this._$handlers||(this._$handlers={});var r=this._$handlers;if(!t||!e)return this;r[e]||(r[e]=[]);for(var o=0;o<r[e].length;o++)if(r[e][o].h===t)return this;return r[e].push({h:t,one:!1,ctx:i||this}),this},listens:function(e,t){this._$handlers||(this._$handlers={});var i=this._$handlers;if(t){for(var r=0;r<i[e].length;r++)if(i[e][r].h==t)return!0;return!1}return!(!i[e]||!i[e].length)},removeEventListener:function(e,t){this._$handlers||(this._$handlers={});var i=this._$handlers;if(!e)return this._$handlers={},this;if(t){if(i[e]){for(var r=[],o=0,n=i[e].length;o<n;o++)i[e][o].h!=t&&r.push(i[e][o]);i[e]=r}i[e]&&0===i[e].length&&delete i[e]}else delete i[e];return this},fireEvent:function(e){this._$handlers||(this._$handlers={});var i=[];if(this._$handlers[e]){var r=arguments,o=r.length;o>3&&(r=t.call(r,1));for(var n=this._$handlers[e],a=n.length,s=0;s<a;){var l=null;switch(o){case 1:l=n[s].h.call(n[s].ctx);break;case 2:l=n[s].h.call(n[s].ctx,r[1]);break;case 3:l=n[s].h.call(n[s].ctx,r[1],r[2]);break;default:l=n[s].h.apply(n[s].ctx,r)}i.push(l),n[s].one?(n.splice(s,1),a--):s++}}return i},fireWithContext:function(e){if(this._$handlers||(this._$handlers={}),this._$handlers[e]){var i=arguments,r=i.length;r>4&&(i=t.call(i,1,i.length-1));for(var o=i[i.length-1],n=this._$handlers[e],a=n.length,s=0;s<a;){switch(r){case 1:n[s].h.call(o);break;case 2:n[s].h.call(o,i[1]);break;case 3:n[s].h.call(o,i[1],i[2]);break;default:n[s].h.apply(o,i)}n[s].one?(n.splice(s,1),a--):s++}}return this}}).on=i.prototype.addEventListener,i.prototype.off=i.prototype.removeEventListener,i.prototype.fire=i.prototype.fireEvent,e={click:{args:["button","shift","screenX","screenY","mapX","mapY","handle"],var:"clickDelegates_",api:"MapClick"},dblclick:{args:["screenX","screenY","mapX","mapY"],var:"dblClickDelegates_",api:"MapDblClick"},mousemove:{args:["button","shift","screenX","screenY","mapX","mapY","handle"],var:"mouseMoveDelegates_",api:"MapMouseMove"},mousedown:{args:["button","shift","screenX","screenY","mapX","mapY","handle"],var:"mouseDownDelegates_",api:"MapMouseDown"},mouseup:{args:["button","shift","screenX","screenY","mapX","mapY","handle"],var:"mouseUpDelegates_",api:"MapMouseUp"},extentchanged:{args:["left","top","right","bottom"],var:"extentChangedDelegates_",api:"MapExtentChange"},resize:{args:["newSize","oldSize"],var:"resizeDelegates_",api:"MapResize"},resolutionchanged:{args:["newResolution","oldResolution","level"],var:"resolutionChangedDelegates_",api:"MapResolutionChange"}},i.prototype.delegateMapEvents=function(t){if(!(t instanceof g2.carto.Map))throw new Error("map对象必须为g2.carto.Map类型！");var i=this,r={};for(var o in function(){for(var t in e){var i=e[t];this[i.var]=[],this[i.var]["_"+t+"_index"]=0}}.call(i),e){e[o];var n=a(o);t._g2_on(o,n),r[o]=n}function a(t){var r=function(){for(var t=[],r=0,o=arguments.length;r<o;r++)t.push(arguments[r]);(function(t,i){var r=e[t];if(r){for(var o=this[r.var],n=r.args,a={},s=0,l=n.length;s<l;s++){var c=n[s];a[c]=i[s]}if("[object Array]"==Object.prototype.toString.call(o))for(var s=0,l=o.length;s<l;s++){var h=o[s];if(h)try{h.callback.call(h.context,a)}catch(e){console.error(e)}}}}).call(i,arguments.callee._event,t)};return r._event=t,r}this._g2mapListeners=r},i.prototype.unDelegateMapEvents=function(e){if(e instanceof g2.carto.Map&&this._g2mapListeners)for(var t in this._g2mapListeners)try{e._g2_un(t,this._g2mapListeners[t])}catch(e){}},i.prototype._on=function(t,i,r){var o=!1;try{var n=e[t];if(n){var a=this[n.var],s="_"+t+"_index",l=a[s];a[l]={context:r,callback:i},a[s]=l+1,o=!0}}catch(e){console.error(e.message)}return o},i.prototype.isMapEvent=function(t){return e.hasOwnProperty(t)},i.prototype._off=function(t,i,r){var o=!1,n="[object Function]"==Object.prototype.toString.call(i),a=!!r;try{for(var s=this[e[t].var],l=0,c=s.length;l<c;l++){var h=s[l];h&&p(h)&&(s[l]=void 0,o=!0)}}catch(e){console.error(e.message)}function p(e){return e=e||{},n&&a?e.callback===i&&e.context===r:n?e.callback===i:e.context===r}return o},i}.apply(t,[]))||(e.exports=r)},function(e,t,i){"use strict";var r,o;r=[i(0),i(3)],void 0===(o=function(e,t){var i={createBaseLayer:function(t){if(!e.isObject(t))throw new Error("参数类型错误!");var i=null;if("group"==t.type){for(var r=t.layers,o=t.id||e.newUUID(),n=new g2.carto.GroupLayer({id:o,name:t.title||"",zIndex:t.zIndex,layers:[]}),a=0,s=r.length;a<s;a++){var l=c(r[a]);n.addLayer(l)}i=n}else(i=c(t)).name=t.title||"";return i._type=G.lys.TYPES.BASE_LAYER_TAG,i.layerGroups=t.layerGroups||"",i;function c(e){var i=new g2.carto.TileLayer(e);return t.zIndex&&i.setZIndex(t.zIndex),i}},getBaseLayer:function(e){if(!(e instanceof G.Map))throw new Error("参数类型错误！");for(var t=e.getMap().layers,i=[],r=0,o=t.length;r<o;r++){var n=t[r];n&&n._type==G.lys.TYPES.BASE_LAYER_TAG&&i.push(n)}return i},removeBaseLayer:function(e){if(!(e instanceof G.Map))throw new Error("参数类型错误！");for(var t=i.getBaseLayer(e),r=e.getMap(),o=0,n=t.length;o<n;o++){var a=t[o];r.removeLayer(a)}return t},removeBaseLayerById:function(e,t){var r=i.getLayerById(e,t);r&&e.getMap().removeLayer(r)},ClearLayerByName:function(e,t){var i=e.getMap().findLayer(t);i&&i.clear()},ClearAllLayer:function(e){for(var t=0;t<e.getMap().layers.length;t++)e.getMap().layers[t].clear()},switchBaseLayer:function(t){if(!(t&&t.layerOpts&&t.map instanceof G.Map))throw new Error("参数类型错误！");var r=t.map,o=r.getMap(),n=i.removeBaseLayer(r),a=[];if(e.isArray(t.layerOpts))for(var s=0,l=t.layerOpts.length;s<l;s++){var c=t.layerOpts[s];if(e.isObject(c)){var h=i.createBaseLayer(c);o.addLayer(h),a.push(h)}}else{h=i.createBaseLayer(t.layerOpts);o.addLayer(h),a.push(h)}var p=r.getLayers();for(s=0,l=p.length;s<l;s++){var u=p[s];u._type!==G.lys.TYPES.BASE_LAYER_TAG&&(u.getZIndex()>0||u.setZIndex(1))}var f={};f.old=n,f.new=a,r.fire(G.misc.AppEvents.SWITCH_BASE_LAYER,f)},getLayerById:function(e,t){if(!(e instanceof G.Map))throw new Error("参数类型错误！");if(t){var i=e.getMap().layers,r={};for(var o in i){n(r,i[o],t)}return r.layer||null}return null;function n(e,t,i){if(!e.layer)if(t.id!=i){if(t instanceof g2.carto.GroupLayer){var r=t.groupLayers;for(var o in r){n(e,r[o],i)}}}else e.layer=t}}},r={point:1,polyline:2,polygon:3},o=[{id:"default-point-group",name:"点图层组"},{id:"default-polyline-group",name:"线图层组"},{id:"default-polygon-group",name:"面图层组"}];i.initGroupLayers=function(e){if(!e instanceof G.Map)throw new Error("参数类型错误！");if(!e._group_layer_initialized){for(var t=2;t>=0;t--){var i=o[t],r=new g2.carto.GroupLayer({id:i.id,name:i.name,layers:[]});e.addLayer(r)}e._group_layer_initialized=!0}},i.addLayer2Group=function(e,t,n){if(!e instanceof G.Map)throw new Error("参数类型错误！");var a=o[(r[n]||1)-1],s=i.getLayerById(e,a.id);return!!s&&(s.addLayer(t),!0)},i.removeLayerFromGroup=function(e,t,n){if(!e instanceof G.Map)throw new Error("参数类型错误！");var a=o[(r[n]||1)-1],s=i.getLayerById(e,a.id);return!!s&&(s.removeLayer(t),!0)},i.addImageLayer=function(e){var t=new g2.carto.ImageLayer({id:e.id,name:e.name,imageType:702,extent:[e.pointArr[0].x,e.pointArr[0].y,e.pointArr[1].x,e.pointArr[1].y],crossOrigin:"anonymous",url:e.url});e.map.addLayer(t)},i.clearImageLayer=function(e,t){e.findLayer(t)&&e.getMap().removeLayer(e.findLayer(t))},i.addElementLayer=function(e){var t;null==e.map.findLayer(e.name)?(t=new g2.carto.ElementLayer({map:e.map.getMap(),name:e.name,id:e.id}),e.map.getMap().addLayer(t)):t=e.map.findLayer(e.name);var i=G.utils.RenderUtil.geoinfoToElement(e.geoInfo,e.symbol,e.eleInfo);t.add(i)},i.getLayerExtent=function(e){e instanceof G.lys.BaseLayer&&(e=e.getLayer());var i=function e(t){var i=[],r=[];if(t instanceof g2.carto.FeatureLayer)i=t.features;else{if(!(t instanceof g2.carto.ElementLayer)){if(t instanceof g2.carto.GroupLayer){var o=t.groupLayers;for(var n in o){var a=o[n],s=e(a)||[];r=r.concat(s)}return r}throw new Error("图层类型错误！")}i=t.elements}for(var l in i){var c=i[l];c&&c.geometry&&r.push(c.geometry)}return r}(e);return t.getGeometryEnvlop(i)},i.setLayerSymbol=function(t,r,o){if(!r&&0==o.length)throw new Error("参数类型错误！");e.isEmptyObject(r.symbol)&&(r.symbol={});var n={TextSymbol:"TextSymbol",SimpleMarkerSymbol:"SimpleMarkersymbol",PictureMarkerSymbol:"Picturemarkersymbol",SimpleLineSymbol:"SimpleLinesymbol",SimpleFillSymbol:"SimpleFillsymbol"};if(r instanceof g2.carto.GroupLayer){var a=r.id.substr(0,r.id.length-12);s(i.getLayerById(t,a+"elementLayer")),s(i.getLayerById(t,a+"featureLayer"))}else s(r);function s(e){if(e instanceof g2.carto.ElementLayer)for(var t=0;t<o.length;t++){e.symbol[o[t].type]=o[t].options;var i=e.elements,r=n[o[t].type];if(i.length>0)for(var a=0;a<i.length;a++){(s=new g2.syms[r](o[t].options)).$type==i[a].symbol.$type&&(i[a].symbol=s,e.update(i[a],!0))}}else{r=n[o[0].type];var s=new g2.syms[r](o[0].options),l=new g2.render.SimpleRenderer({symbol:s});e.featureRenders.length=0,e.render(l)}}},i.getLayerSymbol=function(t,i){if(!t&&!i)throw new Error("参数类型错误！");var r={};return e.isEmptyObject(t.symbol)?r={}:(r.type=i,r.options=t.symbol[i]),r};return i.selectElementOnMap=function(e,t,i){if(!e||0==t.length)throw new Error("传入参数错误");i||(i="intersects");for(var r=G.utils.GeometryUtil.toJstsGeometry(e),o={},n=0;n<t.length;n++){var a=t[n],s=a.getLayerId();a instanceof G.lys.DistributeLayer&&(a=a.getLayer()),o[s]=l(a,r,i)}return o;function l(e,t,i){var r=[];if(e instanceof g2.carto.ElementLayer||e instanceof g2.carto.FeatureLayer)for(var o=e.getCount(),n=0;n<o;n++){var a=e.get(n),s=G.utils.GeometryUtil.toJstsGeometry(c(a));t[i](s)&&r.push(a)}else if(e instanceof g2.carto.GroupLayer)for(var h=e.groupLayers,p=0,u=h.length;p<u;p++){var f=h[p];r=r.concat(l(f,t,i))}return r}function c(e){if(e instanceof g2.sfs.PlotElement){var t=e.elements;return t[t.length-1].geometry}return e.geometry}},i.addElementLayerToMap=function(e,t){var r=new g2.carto.ElementLayer({map:t,name:e.name,id:e.id,zIndex:e.zIndex,attr:e.attr,visible:e.visible,groupType:e.groupType});return r.attr=e.attr,"point"==e.groupType||"line"==e.groupType||"polygon"==e.groupType?i.addLayer2Group(t,r,e.groupType):t.addLayer(r),r},i}.apply(t,r))||(e.exports=o)},function(e,t,i){"use strict";var r,o,n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};r=[i(4),i(0),i(6)],void 0===(o=function(e,t,i){var r=e.extend({options:{id:null,name:null,map:null},includes:i.prototype,initialize:function(i){e.setOptions(this,i),this._moveAttrFromOpts(["map","id","name"]),this.map instanceof G.Map&&(this.appEvent=this.map.getAppEvent()),this.id=this.id||t.newUUID32()},destroy:function(){for(var e in this)this[e]=null,delete this[e]}});return r.include({_moveAttrFromOpts:function(e,t){if((e=e||[]).constructor==Array)for(var i=0,r=e.length;i<r;i++){var o=e[i];o&&(this[o]=this.options[o],t||(this.options[o]=null,delete this.options[o]))}},isNotNull:function(e){return null!=e&&null!=(void 0===e?"undefined":n(e))}}),r}.apply(t,r))||(e.exports=o)},function(e,t,i){"use strict";var r;void 0===(r=function(){var e="api_dev",t="dev",i="pro",r={_getRelative:function(){var o={};return o[t]=r.getBasePath(),o[e]=r.getBasePath(),o[i]=r.getBasePath()+"/deps/tsemap",o[r._getMode()]},_getMode:function(){return window.devMode||i},getBasePath:function(){var e=window.webApp;return e&&e.lastIndexOf("/")!=e.length-1&&(e+="/"),e},getStaticPath:function(){return r._getRelative()+"resources/static/"},getLibPath:function(){var o={};return o[e]=r._getRelative()+"deps/emaplib",o[t]=o[e],o[i]=r._getRelative()+"deps/lib",o[r._getMode()]},_getRequireJsPath:function(e,t){if(window.require){var i=requirejs.s.contexts,r=null;for(var o in i)if(!t||t==o){var n=i[o];if(n.config.paths.hasOwnProperty(e)){r=n.nameToUrl(e);break}}return r}throw new Error("requirejs未引入！")},_extractCtrlModulePath:function(e){try{var t=r._getRequireJsPath(e);null==t&&e.indexOf("Ctrl")+"Ctrl".length==e.length&&(t=r.getRelativePath()+"controls/"+e+"/js/"+e+".js");var i="^(.*)/[^/]+/"+e+".js$";return new RegExp(i).test(t)?new RegExp(i).exec(t)[1]+"/":null}catch(e){}},getControlPath:function(e){return r._extractCtrlModulePath(e)},getModulePath:function(e){return r._extractCtrlModulePath(e)},getUiPath:function(t){return r._getMode()==e?r.getBasePath()+"/src/ui/"+t:r.getBasePath()+"/deps/tsemap/ui/"+t},loadCss:function(e){var t=document.getElementsByTagName("head")[0];if("[object Array]"==Object.prototype.toString.call(e))for(var i=0,r=e.length;i<r;i++){var o=e[i];if(!a(o)){var n=document.createElement("link");n.setAttribute("href",o),n.setAttribute("rel","stylesheet"),n.setAttribute("type","text/css"),t.appendChild(n)}}function a(e){var t=jQuery("link").filter(function(){return"stylesheet"==jQuery(this).attr("rel")});if("[object String]"==Object.prototype.toString.call(e)){if(null==(e=s(e)))return!0;for(var i=0,r=t.length;i<r;i++){if(s(t.eq(i).attr("href"))==e)return!0}return!1}return!0}function s(e){var t=/^(.*\.css)(\?.*)?$/;return"[object String]"==Object.prototype.toString.call(e)&&t.test(e)?(e=t.exec(e)[1]).trim().replace(/\/\//g,"/").replace(/\\/g,"/"):null}},getLocaleValue:function(e){return t("app_local",e)||t("tsemap_local",e);function t(e,t){var i=null;try{var r=window.baseLocal[e];if(r&&"string"==typeof t){var o=t.split("."),n=0;for(i=r;i&&n<o.length;)i=i[o[n]],n++}}catch(e){i=null}return i=i||null}},getRelativePath:function(){return r._getScriptPath(/[\/^]tsemap[\-\._]?([\w\-\._]*)\.js\??/)},_getScriptPath:function(e){var t,i,r,o=document.getElementsByTagName("script"),n=null;for(t=0,i=o.length;t<i;t++)(r=o[t].src).match(e)&&(n=(n=r.split(e)[0])?n+"/":"");return n}};return r}.apply(t,[]))||(e.exports=r)},function(e,t,i){"use strict";var r;void 0===(r=function(){return{SWITCH_BASE_LAYER:"switch_base_layer",CLEAR_MAP:"clear_map",PLOT_CREATED:"plot_created",PLOT_UPDATED:"plot_updated",PLOT_DELETE:"plot_delete",PLOT_CANCELED:"plot_canceled",PLOT_CLICKED:"plot_clicked",COLLABORATIVE_PLOT_CREATED:"collaborative_plot_created",COLLABORATIVE_PLOT_UPDTAED:"collaborative_plot_updated",COLLABORATIVE_PLOT_DELETE:"collaborative_plot_delete",GLOBAL_VALUE_SETTED:"global_val_setted"}}.apply(t,[]))||(e.exports=r)},function(e,t,i){"use strict";var r,o;r=[i(3),i(0)],void 0===(o=function(e,t){var i={};function r(e,t){var i=e[0],r=e[1],o=t[0],n=t[1],a=Math.abs(i-o),s=Math.abs(r-n),l=s/Math.sqrt(Math.pow(a,2)+Math.pow(s,2)),c=Math.acos(l),h=Math.floor(180/(Math.PI/c));return o>i&&n>r&&(h=180-h),o==i&&n>r&&(h=180),o>i&&n==r&&(h=90),o<i&&n>r&&(h=180+h),o<i&&n==r&&(h=270),o<i&&n<r&&(h=360-h),180-h}function o(e,t,i){for(var o,n,a,s,l,c,h=0,p=0,u=1;u<e.length&&(o=e[u-1],n=e[u],a=o.x,s=o.y,l=n.x,c=n.y,!((h+=p=Math.sqrt(Math.pow(a-l,2)+Math.pow(s-c,2)))>=t));u++);var f=r([e[u-1].x,e[u-1].y],[e[u].x,e[u].y]),y=(t-(h-p))/p;return[o.x+(n.x-o.x)*y,o.y+(n.y-o.y)*y,f]}return i._getJstsGeometry=e._getJstsGeometry,i._fromJstsGeometry=e._fromJstsGeometry,i.unionGeometry=function(t){return e._unionGeometry(t)},i.differGeom=function(e,t){if(!e||!t)return null;var i,r,o=null,n=0,a=t.length,s=360/(2*Math.PI*6378137),l=this._getJstsGeometry(e);if(l)for(i=l.geometry,i=jsts.simplify.DouglasPeuckerSimplifier.simplify(i,s),r=l.type;n<a;n++){var c=this._getJstsGeometry(t[n]);if(c)(e=c.geometry)&&i&&(e=jsts.simplify.DouglasPeuckerSimplifier.simplify(e,s),i.within(e)?i=null:i.intersects(e)&&(i=i.difference(e)))}if(i)switch(r){case 1:o=g2.sfs.GeometryFormatter.fromWKT(i.toString());break;case 2:o=i.toString();break;case 3:"jsts.geom.GeometryCollection"==i.CLASS_NAME&&0==i.geometries.length&&(i=null),i&&(o=(o=g2.sfs.GeometryFormatter.fromWKT(i.toString())).asGeoJson())}return o},i.interGeom=function(e,t){if(!e||!t)return null;var i,r,o=null,n=0,a=t.length,s=360/(2*Math.PI*6378137),l=this._getJstsGeometry(e);if(l)for(i=l.geometry,i=jsts.simplify.DouglasPeuckerSimplifier.simplify(i,s),r=l.type;n<a;n++){var c=this._getJstsGeometry(t[n]);if(c)(e=c.geometry)&&i&&(e=jsts.simplify.DouglasPeuckerSimplifier.simplify(e,s),i.within(e)?i=e:i.intersects(e)&&(i=i.intersection(e)))}if(i)switch(r){case 1:o=g2.sfs.GeometryFormatter.fromWKT(i.toString());break;case 2:o=i.toString();break;case 3:"jsts.geom.GeometryCollection"==i.CLASS_NAME&&0==i.geometries.length&&(i=null),i&&(o=(o=g2.sfs.GeometryFormatter.fromWKT(i.toString())).asGeoJson())}return o},i.getBuffer=function(t){t.spatialReference=t.spatialReference||g2.sfs.EnumSpatialReference.EPSG4326;e.getWktReader();var i=this._getJstsGeometry(t.geometry)||{};if(!i||!i.geometry)return null;var r=t.radius,o=t.spatialReference==g2.sfs.EnumSpatialReference.EPSG4326||t.spatialReference==g2.sfs.EnumSpatialReference.EPSG4490||!1,n=i.geometry,a=null;if(n instanceof jsts.geom.Point)if(o){var s=e.getCirclePonits({center:[n.getX(),n.getY()],radius:r,count:128,spatialReference:t.spatialReference});s.push([s[0][0],s[0][1]]);var l={type:"Polygon",coordinates:[s]};a=e.getGeoJSONReader().read(l)}else a=n.buffer(r);else n instanceof jsts.geom.Geometry&&(o&&(r=e.meter2Rad(r)),a=n.buffer(r));return this._fromJstsGeometry({geometry:a,type:i.type,spatialReference:t.spatialReference})},i.caculateDisatance=function(e,i,r){if(!t.isArray(e)||!t.isArray(i))throw new Error("参数类型错误！");r=isNaN(r)?4326:r;var o=new g2.sfs.Point({x:e[0],y:e[1]}),n=new g2.sfs.Point({x:i[0],y:i[1]}),a=new g2.sfs.Polyline({spatialReference:r}),s=new g2.sfs.Path({spatialReference:r});s.addPoint(o),s.addPoint(n),a.addGeometry(s);var l=new g2.sfs.CoordinateTransform;return new g2.sfs.MeasureService({projectService:l}).length(a)},i.point2SegmentDistance=function(e,t,i,r,o,n){var a,s,l={},c=(o-i)*(e-i)+(n-r)*(t-r);if(c<=0)return l.nearest=[i,r],l.distance=Math.sqrt((e-i)*(e-i)+(t-r)*(t-r)),l;if(c>=(o-i)*(o-i)+(n-r)*(n-r))return l.nearest=[o,n],l.distance=Math.sqrt((e-o)*(e-o)+(t-n)*(t-n)),l;if(i==o)a=i,s=t,l.nearest=[a,s],l.distance=Math.abs(e-a);else if(r==n)a=e,s=r,l.nearest=[a,s],l.distance=Math.abs(t-s);else{var h,p,u;s=(h=(r-n)/(i-o))*(a=(t-(u=-1/h)*e-(p=r-h*i))/(h-u))+p,l.nearest=[a,s],l.distance=Math.sqrt((e-a)*(e-a)+(t-s)*(t-s))}return l},i.getPointAlongPath=function(t){var i,n,a,s,l=new g2.sfs.CoordinateTransform;try{var c;i=t.pathGeometry,n=t.pathSrid||3857,s=t.step,(c=i instanceof g2.sfs.Polyline?i:g2.sfs.GeometryFactory.createGeometryFromGeoJson(i)).spatialReference=t.pathSrid,3857!=n&&(c=l.transform(c,3857)),a=e.toJstsGeometry(c)}catch(e){throw new Error("参数错误！")}var h=[],p=a.points,u=s,f=a.getLength(),y=r([p[0].x,p[0].y],[p[1].x,p[1].y]);for(m(h,[p[0].x,p[0].y,y],n,3857);u<=f;){m(h,o(p,u,n),n,3857),u+=s}var d=r([p[p.length-2].x,p[p.length-2].y],[p[p.length-1].x,p[p.length-1].y]);return m(h,[p[p.length-1].x,p[p.length-1].y,d],n,3857),h;function m(e,t,i,r){var o=new g2.sfs.Point({x:t[0],y:t[1],spatialReference:r});o=l.transform(o,i),t[0]=o.x,t[1]=o.y,t[2]=t[2],e.push(t)}},i.getPointOnPath=function(t){var i,r,n,a,s=new g2.sfs.CoordinateTransform;try{var l;i=t.pathGeometry,r=t.pathSrid||3857,a=t.distance,(l=i instanceof g2.sfs.Polyline?i:g2.sfs.GeometryFactory.createGeometryFromGeoJson(i)).spatialReference=t.pathSrid,3857!=r&&(l=s.transform(l,3857)),n=e.toJstsGeometry(l)}catch(e){throw new Error("参数错误！")}var c,h=n.points,p=n.getLength()<a;if(!p){c=o(h,a);var u=new g2.sfs.Point({x:c[0],y:c[1],spatialReference:3857});3857!=r&&(u=s.transform(u,r),c[0]=u.x,c[1]=u.y,c[2]=c[2])}return{point:c,arrival:p}},i}.apply(t,r))||(e.exports=o)},function(module,exports,__webpack_require__){"use strict";var __WEBPACK_AMD_DEFINE_ARRAY__,__WEBPACK_AMD_DEFINE_RESULT__;__WEBPACK_AMD_DEFINE_ARRAY__=[__webpack_require__(15),__webpack_require__(0),__webpack_require__(3),__webpack_require__(38),__webpack_require__(2),__webpack_require__(5)],__WEBPACK_AMD_DEFINE_RESULT__=function(BaseLayer,CommonUtil,GeometryUtil,layerExtend,LoggerUtil,RenderUtil){var layer=BaseLayer.extend({options:{idKey:"id",attributeField:"",geometryField:null,symbolConfigUrl:"",defaultSymbolKey:"default"},initialize:function(e){BaseLayer.prototype.initialize.call(this,e),this.type=this.constructor.type,CommonUtil.isObject(this.options.symbolConfig)&&(this.symbolConfig=jQuery.extend(!0,{},this.options.symbolConfig),delete this.options.symbolConfig),this.layer=new g2.carto.ElementLayer({id:this.options.layerId,name:this.options.layerName||"",map:this.map}),this.options.idKey.indexOf(".")<0?this._getRecordId=function(e){return e[this.options.idKey]}:this._getRecordId=function(e){if(e){var t=this.options.idKey.split("."),i=e;if(t.length>0)for(var r=0,o=t.length;r<o;r++){var n=t[r];if(!i||!n){i=null;break}i=i[n]}if(null!=i)return i;e=e||{},LoggerUtil.error("fail to  get id of "+JSON.stringify(e))}},this.currentSymbols=[],this.allSymbols=[],this.renderFields=[],this._getSymbolCfg();var t=new jsts.geom.GeometryFactory(new jsts.geom.PrecisionModel(1e5));this.wktReader=new jsts.io.WKTReader(t)},_addListeners:function(){BaseLayer.prototype._addListeners.call(this),this.map.on("click",this._mapClickListener,this)},_removeListeners:function(){this.map.off("click",this._mapClickListener,this),BaseLayer.prototype._removeListeners.call(this)},_mapClickListener:function(e){var t=this.hitTest(e.screenX,e.screenY);t&&this.fire("click",{element:t.element,layer:t.layer})},_createSymbol:function(e,t){return RenderUtil.object2Symbol(e,t)},addElements:function(e,t){},_getGeometry:function(e,t,i){if(!e)return null;var r=this.options.geometryField,o=null;try{if(r){var n=e[r];try{"string"==typeof n?(n=this.wktReader.read(n).toString(),o=g2.sfs.GeometryFactory.createGeometryFromWkt(n,t)):o=g2.sfs.GeometryFactory.createGeometryFromGeoJson(n,t)}catch(e){}}else{var a,s;a=this._getXyVal(e,this.options.xField),s=this._getXyVal(e,this.options.yField),o=new g2.sfs.Point({x:a,y:s,spatialReference:t})}if(o instanceof g2.sfs.Point)GeometryUtil.validateCoordinate(o.x,o.y,t)||(o=null)}catch(t){LoggerUtil.warn("record "+e._id+" 没有坐标 ")}return t&&i&&t!=i&&(o=this.projService.transform(o,i)),o},_getXyVal:function _getXyVal(data,field){var val;try{val=field.indexOf(".")<0?data[field]:parseFloat(eval("data."+field))}catch(e){}return val},getSymbol:function(e,t){return this._getSymbol(e,t)},_getSymbol:function(e,t){var i;t=this._getSymbol_Zoom(t),i=this._getSymbol_DataObj(e,this.options.attributeField),i=this._getDataOrData2(i,e);var r=this._getSymbol_symKeyObj(this.renderFields,i),o=r.symKey,n=r.rangeStr;o=this._getSymbol_symKeyLookstr(o,"$_$");for(var a,s,l=1,c=this.allSymbols.length,h=[];l<c;l++){var p=this.allSymbols[l];if(p){var u=p.symbolKey;if(u==o){a=p;break}if(u.startsWith(o)&&u.indexOf("zoomLevel$=$")>=0){var f=u.split("$_$");n=f[f.length-1].split("$=$")[1];CommonUtil.assertWithin(t,n)&&(s=n,a=p),h.push(n)}}}var y=this.symbolConfig,d=y.defaultSymbol,m={};a?m={symbol:this._doGetSymbol(i,a,d),zoomRange:s,zoomRanges:h,symbolKey:a.symbolKey}:m={symbol:this._doGetSymbol(i,y,d),zoomRange:!1,symbolKey:this.options.defaultSymbolKey};return m},getHighlightSymbol:function(e){var t=null,i=this.getElementSymbol(e);if(i){var r=this.symbolConfig.highlight;r&&(t=this._generateNewSymbol(i,r))}return t},updateSymbol:function(e){try{var t,i=0;t=this.elements;for(var r=0,o=t.length;r<o;r++){var n=t[r];if(!1!==n._zoomRange){var a=this._getSymbol(n._data,e);a.zoomRange!==n._zoomRange&&(n.symbol=a.symbol,this.layer.update(n,!0),n._zoomRange=a.zoomRange,n._symbolKey=a.symbolKey,i++)}}i>0&&this._onSymbolsUpdated()}catch(e){LoggerUtil.error(e)}},removeElements:function(e){},setMetaData:function(e){this.metaData=e||{}},validateGeometry:function(e){return!!e&&!(e instanceof g2.sfs.Point&&(isNaN(e.x)||isNaN(e.y)))},destroy:function(){this.clear(),BaseLayer.prototype.destroy.call(this)}});return layer.include({getElementById:function(e){var t=this._getLayerElementById(this.layer,e);return t?t.element:null},getElementSymbol:function(e){var t,i,r=this.elements;for(t in r){var o=r[t];o.id==e&&(i=o)}return i&&i.symbol?i.symbol:null},getSymbolSize:function(e){var t=[];return e instanceof g2.sfs.SimpleMarkerSymbol?(t.push(2*e.size),t.push(2*e.size),t.push(e.offsetX||0),t.push(e.offsetY||0)):e instanceof g2.sfs.PictureMarkerSymbol&&(t.push(e.width),t.push(e.height),t.push(e.offsetX||0),t.push(e.offsetY||0)),t},clear:function(){this.layer.clear(),Object.prototype.hasOwnProperty.call(this,"elements")?this.elements=[]:Object.prototype.hasOwnProperty.call(this,"features")&&(this.features=[]),this._onSymbolsUpdated(),this._onElementChanged(),delete this.noneSpatialArr,this.noneSpatialArr=[]},getLayer:function(){return this.layer},getLayerId:function(){if(this.layer&&this.layer.getLayerId)return this.layer.getLayerId()},getVisible:function(){return this.layer.visible},setVisible:function(e){this.layer.setVisible(e||!1),e?this.invokeCallback("symbolUpdateCallback",{layerId:this.options.layerId,symbols:this.currentSymbols}):this.invokeCallback("symbolUpdateCallback",{layerId:this.options.layerId,symbols:[]})},getLayerName:function(){return this.layer.getLayerName()},getLayerType:function(){return this.layer.getLayerType()},find:function(e){var t=this.getLayer(),i=null;if(t instanceof g2.carto.GroupLayer)for(var r=t.groupLayers,o=0,n=r.length;o<n;o++){var a=r[o];if(a&&a.find){var s=a.find(e);if(s){i=s;break}}}else i=t.find(e);return i},getElements:function(){return this.elements},hitTest:function(e,t){return this.layer.hitTest(e,t)}}),layerExtend.includeGetSymbol(layer),layerExtend.includeFindElementById(layer),layerExtend.includeGenerateNewSymbol(layer),layerExtend.includeParseSymbolCfg(layer),layer}.apply(exports,__WEBPACK_AMD_DEFINE_ARRAY__),void 0===__WEBPACK_AMD_DEFINE_RESULT__||(module.exports=__WEBPACK_AMD_DEFINE_RESULT__)},function(e,t,i){"use strict";var r,o;r=[i(4),i(0),i(7),i(6),i(27)],void 0===(o=function(e,t,i,r,o){var n=window.G||{};window.G=n;var a=function(e){this.initialize(e),this.callInitHooks()},s=g2.carto.Map;a.prototype={options:{},constructor:a,initialize:function(t){e.setOptions(this,t);var i=this.options.mapOpts||this.options;isNaN(i.defaultExtent.zoom)||(i.defaultExtent.level=i.defaultExtent.zoom),i.fullExtent&&(isNaN(i.fullExtent.zoom)||(i.fullExtent.level=i.fullExtent.zoom)),s.call(this,i),this.init({targetId:i.targetId}),this.id=i.targetId,this.layerSet={},this._g2_on("postrender",function(){try{var e=document.getElementsByClassName("ol-attribution"),t=e.length>0?e[0]:null;null!=t&&t.parentElement.removeChild(t)}catch(e){}})},destroy:function(){},callInitHooks:function(){if(!this._initHooksCalled){this._initHooksCalled=!0;for(var e=0,t=this._initHooks.length;e<t;e++)this._initHooks[e].call(this)}}},e.defaults(a,e,!0),e.inherits(a,s),a.include({getMap:function(){return this},initialGroupLayers:function(){i.initGroupLayers(this)},getAppEvent:function(){return this._appEvent||(this._appEvent=new n.misc.AppEvent({map:this})),this._appEvent},changeExtent:function(e,t){var i=this.getMap(),r=new g2.sfs.Point({x:e[0],y:e[1],spatialReference:i.spatialReference});i.setCenter(r),i.zoomTo(parseInt(t))},clear:function(e){e=e||{};var i=this.getMap().layers,r=e.filterFn||!1,o=e.matchRegex||!1,a=e.ignoreRegex||!1,s={filterFn:function(e,t){t(e)&&u.call(this,e)},matchRegex:function(e,t){p(e.id,t)&&u.call(this,e)},ignoreRegex:function(e,t){p(e.id,t)||u.call(this,e)},all:u};this.fire(n.misc.AppEvents.CLEAR_MAP);for(var l=0,c=i.length;l<c;l++){var h=i[l];if(h){if(h._type==n.lys.TYPES.BASE_LAYER_TAG)continue;t.isFunction(r)?s.filterFn.call(this,h,r):t.isArray(o)?s.matchRegex.call(this,h,o):t.isArray(a)?s.ignoreRegex.call(this,h,a):s.all.call(this,h)}}function p(e,t){var i=!1;if(t&&t.length>0)for(var r=0,o=t.length;r<o;r++){var n=t[r];if(n instanceof RegExp&&n.test(e)){i=!0;break}}return i}function u(e){if(e instanceof g2.carto.GroupLayer)for(var t=e.groupLayers,i=0,r=t.length;i<r;i++){var o=t[i];u.call(this,o)}else e&&e.clear()}},addLayer:function(e){var t=e;t instanceof n.lys.BaseLayer&&(t=e.getLayer()),s.prototype.addLayer.call(this,t),this.layerSet[e.id]=e},removeLayer:function(e){var t=e;t instanceof n.lys.BaseLayer&&(t=e.getLayer()),s.prototype.removeLayer.call(this,t),this.layerSet[e.id]=null,delete this.layerSet[e.id]},getLayerById:function(e){return this.layerSet.hasOwnProperty(e)?this.layerSet[e]:i.getLayerById(this,e)}}),a.include({addScaleLineCtrl:function(e){var t=(e=e||{}).className||"ol-scale-line";this.getMap().addScaleLineControl(t),this._scaleLineCtrlClass=t},removeScaleLineCtrl:function(){jQuery("#"+this.id).find(".ol-overlaycontainer-stopevent ."+this._scaleLineCtrlClass).remove()}});var l=a.prototype;return l._g2_on=l.on,delete l.on,l._g2_un=l.un,delete l.un,a.include({on:function(e,t,i){this.getAppEvent().isMapEvent(e)?this.getAppEvent()._on(e,t,i):r.prototype.on.call(this,e,t,i)},off:function(e,t,i){this.getAppEvent().isMapEvent(e)?this.getAppEvent()._off(e,t,i):r.prototype.off.call(this,e,t,i)},fire:function(){r.prototype.fire.apply(this,arguments)},once:function(){r.prototype.once.apply(this,arguments)}}),o.enable(a),a}.apply(t,r))||(e.exports=o)},function(e,t,i){"use strict";var r,o;r=[i(4)],void 0===(o=function(e){return e.extend({options:{url:"",params:void 0,dataType:"jsonp"},initialize:function(t){e.setOptions(this,t)},execute:function(e){var t=$.Deferred(),i=$.extend(!0,{},this.options,e);return i.success=this._getResult(t,i),i.error=this._getError(t,i),$.ajax(i),t},_getResult:function(e,t){var i=this;return function(r){var o=t.context?t.context:i;if(G.utils.CommonUtil.isFunction(t.callback)){var n=t.stripData?t.stripData(r):i.stripData(r);t.callback.call(o,n)}else{null==(n=t.stripData?t.stripData(r):i.stripData(r))&&e.reject(n),e.resolveWith(o,[n])}}},_getError:function(e,t){return function(i,r,o){var n=t.context?t.context:this;e.rejectWith(n,[i]),t.error&&t.error()}},stripData:function(e){return e||[]},destroy:function(){for(var e in this)this[e]=null,delete this[e]}})}.apply(t,r))||(e.exports=o)},function(e,t,i){"use strict";var r,o;r=[i(4),i(0),i(5),i(6)],void 0===(o=function(e,t,i,r){var o=e.extend({options:{id:null,name:null,spatialReference:null,dataSpatialReference:null,symbolUpdateCallback:function(e){},callbackContext:window},includes:r.prototype,initialize:function(e){G.base.Class.setOptions(this,e),this.map=this.options.map,this.options.layerId=this.options.layerId||this.options.id,this.options.layerName=this.options.layerName||this.options.name,this.id=this.options.layerId,this.name=this.options.layerName,this.options.spatialReference=this.map.spatialReference,this.options.dataSpatialReference=this.options.dataSpatialReference||this.options.spatialReference,this.projService=new g2.sfs.CoordinateTransform({}),this._invokeSymbolUpdateCallback=!0,this._currentExtent=[NaN,NaN,NaN,NaN],this._addListeners()},_addListeners:function(){},_removeListeners:function(){},_onSymbolsUpdated:function(){},destroy:function(){try{this._removeListeners()}catch(e){}}});return o.include({getElements:function(){},getElementById:function(e){},clear:function(){},getLayer:function(){},getLayerId:function(){},setVisible:function(e){},getVisible:function(){},setZIndex:function(e){return this.getLayer().setZIndex(e)},getZIndex:function(){return this.getLayer().getZIndex()},getLayerName:function(){},hitTest:function(e,t){},getLayerExtent:function(){return this._currentExtent},toggleInvokeSymbolUpdateCallback:function(e){"boolean"==typeof e||(e=!this._invokeSymbolUpdateCallback),this._invokeSymbolUpdateCallback=e}}),o.include({_getColor:function(e){return i._getColor(e)},_envelopeFromGeom:function(e){try{var t,i,r,o,n=e.shell.points;t=i=1e7,r=o=-1e7;for(var a=0,s=n.length;a<s;a++){var l=n[a];t=Math.min(t,l.x),i=Math.min(i,l.y),r=Math.max(r,l.x),o=Math.max(o,l.y)}return[t,i,r,o]}catch(e){return[NaN,NaN,NaN,NaN]}},invokeCallback:function(e,i){var r=this.options.callbackContext||window;"string"==typeof e&&(e=this.options[e]),t.isFunction(e)&&e.call(r,i)}}),o}.apply(t,r))||(e.exports=o)},function(e,t,i){"use strict";var r,o;r=[i(12),i(0),i(3),i(17),i(2)],void 0===(o=function(e,t,i,r,o){var n=e.extend({options:{symbolConfig:!1,xField:"LONGITUDE",yField:"LATITUDE"},initialize:function(t){e.prototype.initialize.call(this,t),this.noneSpatialArr=[],this.elements=[],this.currentZoom=this.map.getZoomLevel()},_addListeners:function(){e.prototype._addListeners.call(this),this.map.on("extentchanged",this._extentChangeListener,this)},_removeListeners:function(){this.map.off("extentchanged",this._extentChangeListener,this),e.prototype._removeListeners.call(this)},_extentChangeListener:function(){var e=this.map.getZoomLevel();this.updateSymbol(e),this.currentZoom=e},_mapClickListener:function(e){var t=this.hitTest(e.screenX,e.screenY);t&&this.fire("click",{element:t.element,layer:t.layer})},addElements:function(e,i){if(t.isArray(e)){i=i||{};for(var r=this.map.getZoomLevel(),n=this.options.spatialReference,a=i.dataSpatialReference||this.options.dataSpatialReference,s=0,l=e.length;s<l;s++){var c=e[s],h=this._getGeometry(c,a,n);if(this.validateGeometry(h)){var p=this._getSymbol(c,r),u=this._getRecordId(c),f=new g2.sfs.Element({id:u,geometry:h,symbol:p.symbol});f._data=c,f._zoomRange=p.zoomRange,f._symbolKey=p.symbolKey,this.elements.push(f),this.layer.add(f)}else this.noneSpatialArr.push(c)}this._onSymbolsUpdated(),this._onElementChanged()}else o.error("dataArr is not an array")},removeElements:function(e){if(t.isArray(e)){for(var i=e.length-1;i>=0;i--){var r=e[i];this.layer.remove(r)}this._onSymbolsUpdated(),this._onElementChanged()}},hitTest:function(e,t){var i=[],r=this.layer.hitTest(e,t);return r&&i.push(r),i[0]||null},setVisible:function(e){this.layer.setVisible(e||!1),e?this.invokeCallback("symbolUpdateCallback",{layerId:this.options.layerId,symbols:this.currentSymbols}):this.invokeCallback("symbolUpdateCallback",{layerId:this.options.layerId,symbols:[]})},clear:function(){this.elements=[],e.prototype.clear.call(this)},destroy:function(){e.prototype.destroy.call(this)}});return Object.defineProperty(n,"type",{value:11,configurable:!1,writable:!1}),n}.apply(t,r))||(e.exports=o)},function(e,t,i){"use strict";var r,o;r=[i(0)],void 0===(o=function(e){var t=function(e){this._cellSize=e,this._sqCellSize=e*e,this._grid={},this._objectPoint={}};return t.prototype={addObject:function(t,i){var r=this._getCoord(i.x),o=this._getCoord(i.y),n=this._grid,a=n[o]=n[o]||{},s=a[r]=a[r]||[],l=e.stamp(t);this._objectPoint[l]=i,s.push(t)},updateObject:function(e,t){this.removeObject(e),this.addObject(e,t)},removeObject:function(t,i){var r,o,n=this._getCoord(i.x),a=this._getCoord(i.y),s=this._grid,l=s[a]=s[a]||{},c=l[n]=l[n]||[];for(delete this._objectPoint[e.stamp(t)],r=0,o=c.length;r<o;r++)if(c[r]===t)return c.splice(r,1),1===o&&delete l[n],!0},eachObject:function(e,t){var i,r,o,n,a,s,l=this._grid;for(i in l)for(r in a=l[i])for(o=0,n=(s=a[r]).length;o<n;o++)e.call(t,s[o])&&(o--,n--)},eachCell:function(e,t){var i,r,o,n,a=this._grid;for(i in a)for(r in o=a[i])n=o[r],e.call(t,n,i,r)},getNearObject:function(t){var i,r,o,n,a,s,l,c,h=this._getCoord(t.x),p=this._getCoord(t.y),u=this._objectPoint,f=this._sqCellSize,y=null;for(i=p-1;i<=p+1;i++)if(n=this._grid[i])for(r=h-1;r<=h+1;r++)if(a=n[r])for(o=0,s=a.length;o<s;o++)l=a[o],(c=this._sqDist(u[e.stamp(l)],t))<f&&(f=c,y=l);return y},getObjects:function(e,t){var i=this._grid[e];return i?i[t]:null},_getCoord:function(e){return Math.floor(e/this._cellSize)},_sqDist:function(e,t){var i=t.x-e.x,r=t.y-e.y;return i*i+r*r},clear:function(){for(var e in this._grid){var t=this._grid[e];for(var i in t)t[i]=null,delete t[i];this._grid[e]=null,delete this._grid[e]}for(var e in this._objectPoint)delete this._objectPoint[e]},destroy:function(){for(var e in this.clear(),this._grid=null,delete this._grid,this._objectPoint)this._objectPoint[e]=null,delete this._objectPoint[e]}},t}.apply(t,r))||(e.exports=o)},function(e,t,i){"use strict";var r,o;r=[i(15),i(0)],void 0===(o=function(e,t){return e.extend({options:{geometryField:"",xField:"LONGITUDE",yField:"LATITUDE",showZero:!1,symbolConfigUrl:""},initialize:function(i){e.prototype.initialize.call(this,i),t.isObject(this.options.symbolConfig)&&(this.symbolConfig=jQuery(!0,{},this.options.symbolConfig),delete this.options.symbolConfig),this.currentSymbols=[],this.statisticsData=null,this._visible=!0},_addListeners:function(){},_removeListeners:function(){},updateStatistics:function(e){},setVisible:function(e){},getVisible:function(){return this._visible},clear:function(){this.statisticsData=null},_updateLayer:function(e){},getLayer:function(){},_mergeStatisticsData:function(e,t){for(var i in t){var r=t[i],o=e[i];o?jQuery.extend(!0,o,r):e[i]=r}},_onSymbolsUpdated:function(){},_onElementChanged:function(){var e=this.getElements(),t=[];if(e&&e.length>0){for(var i=0,r=e.length;i<r;i++){var o=e[i];o&&o.geometry&&t.push(o.geometry)}var n=G.utils.GeometryUtil.getGeometryEnvlop(t);this._currentExtent=this._envelopeFromGeom(n)}else this._currentExtent=[NaN,NaN,NaN,NaN]},destroy:function(){if(this.clear(),this._removeListeners(),this.statisticsDataType){for(var t in this.statisticsDataType)delete this.statisticsDataType[t];this.statisticsDataType=null}if(this.statisticsData){for(var t in this.statisticsData)delete this.statisticsData[t];this.statisticsData=null}for(var t in this.options)delete this.options[t];for(var t in this)delete this[t];e.prototype.destroy.call(this)}})}.apply(t,r))||(e.exports=o)},function(e,t,i){"use strict";var r;void 0===(r=function(){var e={TEXT:"text",TAILEDTEXT:"tailedtext",POINT:"point",POLYLINE:"line",POLYGON:"polygon",COMPOSITE:"composite"},t=t||{};t.algm=t.algm||{};var i={Text:{title:"文本",algorithm:"PointAlgorithm",type:e.TEXT},TAILEDTEXT:{title:"文本",algorithm:"PointAlgorithm",type:e.TAILEDTEXT},Point:{title:"点",algorithm:"PointAlgorithm",type:e.POINT},Polyline:{title:"折线",algorithm:"PolylineAlgorithm",type:e.POLYLINE},Curve:{title:"曲线",algorithm:"CurveAlgorithm",type:e.POLYLINE},Camber:{title:"弧线",algorithm:"CamberAlgorithm",type:e.POLYLINE},FreePolyline:{title:"自由标绘线",algorithm:"PolylineAlgorithm",type:e.POLYLINE},Polygon:{title:"多边形",algorithm:"PolygonAlgorithm",type:e.POLYGON},Circle:{title:"圆",algorithm:"CircleAlgorithm",type:e.POLYGON},Rectangle:{title:"矩形",algorithm:"RectangleAlgorithm",type:e.POLYGON},Ellipse:{title:"椭圆",algorithm:"EllipseAlgorithm",type:e.POLYGON},Sector:{title:"扇形",algorithm:"SectorAlgorithm",type:e.POLYGON},Arc:{title:"圆弧",algorithm:"ArcAlgorithm",type:e.POLYGON},CloseCurve:{title:"封闭曲线",algorithm:"CloseCurveAlgorithm",type:e.POLYGON},FreePolygon:{title:"自由标绘面",algorithm:"PolygonAlgorithm",type:e.POLYGON},DoubleArrow:{title:"双箭头",algorithm:"DoubleArrowAlgorithm",type:e.POLYGON},SwallowTailArrow:{title:"燕尾箭头",algorithm:"SwallowtailArrowAlgorithm",type:e.POLYGON},MultiArrow:{title:"多箭头",algorithm:"MultiArrowAlgorithm",type:e.POLYGON},BeelineArrow:{title:"细直箭头",algorithm:"BeelineArrowAlgorithm",type:e.COMPOSITE},CurveArrow:{title:"单曲箭头",algorithm:"CurveArrowAlgorithm",type:e.COMPOSITE},SimpleArrow:{title:"单箭头",algorithm:"SimpleArrowAlgorithm",type:e.POLYGON},SlightnessArrow:{title:"直箭头",algorithm:"SlightnessArrowAlgorithm",type:e.POLYGON},ShockWay:{title:"突击方向",algorithm:"ShockWayAlgorithm",type:e.POLYGON},Arsenal:{title:"武警",algorithm:"ArsenalProperty",type:e.COMPOSITE},ExpertProtect:{title:"专家",algorithm:"ExpertProtectAlgorithm",type:e.COMPOSITE},Engineer:{title:"工程",algorithm:"PowerRepairAlgorithm",type:e.COMPOSITE},Army:{title:"军队",algorithm:"ArmyAlgorithm",type:e.COMPOSITE},FireProtect:{title:"消防",algorithm:"FireProtectAlgorithm",type:e.COMPOSITE},MedicalCure:{title:"医疗",algorithm:"MedicalCureAlgorithm",type:e.COMPOSITE},PowerRepair:{title:"电力抢修",algorithm:"PowerRepairAlgorithm",type:e.COMPOSITE},ProChymic:{title:"防化",algorithm:"ProchymicAlgorithm",type:e.COMPOSITE},ProSuccor:{title:"专业救援",algorithm:"ProsuccorAlgorithm",type:e.COMPOSITE},AirWay:{title:"空中运输",algorithm:"AirwayAlgorithm",type:e.COMPOSITE},Cannon:{title:"炮弹路线",algorithm:"CannonAlgorithm",type:e.POLYLINE},AirMobile:{title:"空中机动",algorithm:"AirMobileAlgorithm",type:e.COMPOSITE},ArtilleryManenCampment:{title:"高射炮兵营地",algorithm:"ArtilleryManenCampmentAlgorithm",type:e.COMPOSITE},MotorbikeTeam:{title:"摩托化行军纵队",algorithm:"MotorbikeTeamAlgorithm",type:e.COMPOSITE},AntiairCraftForces:{title:"防空兵行军纵队",algorithm:"AntiAirCraftForceAlgorithm",type:e.COMPOSITE},TankAndMusketer:{title:"坦克及步战车进攻队形",algorithm:"TankAndMusketerAlgorithm",type:e.COMPOSITE},AttackOrder:{title:"进攻队形",algorithm:"AttackOrderAlgorithm",type:e.COMPOSITE},AttackTurnDefend2:{title:"由进攻转入防守2",algorithm:"AttackTurnDefend2Algorithm",type:e.POLYLINE},AttackTurnDefend1:{title:"由进攻转入防守1",algorithm:"AttackTurnDefend1Algorithm",type:e.POLYLINE},Artillery:{title:"炮兵行军纵队",algorithm:"ArtilleryAlgorithm",type:e.COMPOSITE},RecceSearch:{title:"侦查搜索",algorithm:"RecceSearchAlgorithm",type:e.POLYLINE},Patroller:{title:"流动哨",algorithm:"PatrolLeralAlgorithm",type:e.POLYLINE},TankAttack:{title:"坦克营进攻队形",algorithm:"TankAttackAlgorithm",type:e.COMPOSITE},Musketry:{title:"步兵战斗车连",algorithm:"MusketryAlgorithm",type:e.POLYLINE},NavalShips:{title:"水上救援舰艇",algorithm:"NavalShipsAlgorithm",type:e.COMPOSITE},PedrailColumn:{title:"救援车辆纵队",algorithm:"PedrailColumnAlgorithm",type:e.COMPOSITE},PipeLaying:{title:"输油管线",algorithm:"PipeLayingAlgorithm",type:e.POLYLINE},PolygonText:{title:"警戒区域",algorithm:"PolygonTextAlgorithm",type:e.COMPOSITE},Railage:{title:"铁路输送",algorithm:"RailAgeAlgorithm",type:e.COMPOSITE},RoundsLine:{title:"海上搜救队形",algorithm:"RoundsLineAlgorithm",type:e.POLYLINE},CommunicateLine:{title:"通信光缆线路",algorithm:"CommunicateLineAlgorithm",type:e.COMPOSITE},PatrolLine:{title:"隔离线1",algorithm:"PatrolLineAlgorithm",type:e.POLYLINE},WarBoundary:{title:"隔离线2",algorithm:"WarBoundaryAlgorithm",type:e.POLYLINE},FinderLine:{title:"海上封锁线",algorithm:"FinderLineAlgorithm",type:e.POLYLINE},FixedPipeLaying:{title:"固定输油管线",algorithm:"FixedPipeLayingAlgorithm",type:e.COMPOSITE},LandMobile:{title:"陆地机动技术",algorithm:"LandMobileAlgorithm",type:e.COMPOSITE},ForbidFlyLine:{title:"警戒线",algorithm:"ForbidFlyLineAlgorithm",type:e.COMPOSITE},LineAbatis3:{title:"大型输电线路",algorithm:"LineAbatis3Algorithm",type:e.POLYLINE},LineAbatis2:{title:"中型输电线路",algorithm:"LineAbatis2Algorithm",type:e.POLYLINE},LineAbatis1:{title:"小型输电线路",algorithm:"LineAbatis1Algorithm",type:e.POLYLINE},LaighStake:{title:"生态隔离线",algorithm:"LaighstakeAlgorithm",type:e.POLYLINE},HelicopterTransport:{title:"直升机输送",algorithm:"HelicopterTransportAlgorithm",type:e.COMPOSITE},MissileMarch:{title:"事故车辆行进路线",algorithm:"MissileMarchAlgorithm",type:e.COMPOSITE},HighWay:{title:"公路运输",algorithm:"HighwayAlgorithm",type:e.COMPOSITE},MusketerByTank:{title:"灾民撤离",algorithm:"MusketerByTankAlgorithm",type:e.COMPOSITE},TankMusColumn:{title:"专业救援队形2",algorithm:"TankMusColumnAlgorithm",type:e.COMPOSITE},Trench:{title:"危险路段",algorithm:"TrenchAlgorithm",type:e.POLYLINE},Waterage:{title:"水路运输",algorithm:"WaterAgeAlgorithm",type:e.COMPOSITE},RendezvousArea1:{title:"集结区域",algorithm:"RendezvousArea1Algorithm",type:e.POLYLINE},RendezvousArea2:{title:"事故区域蔓延",algorithm:"RendezvousArea2Algorithm",type:e.POLYLINE},RendezvousArea3:{title:"事故区域控制",algorithm:"RendezvousArea3Algorithm",type:e.POLYLINE},RendezvousArea4:{title:"物质集散地",algorithm:"RendezvousArea4Algorithm",type:e.POLYLINE},OriginalBirth:{title:"空中救援队伍",algorithm:"OriginalBirthAlgorithm",type:e.POLYLINE},SeaMobile:{title:"海上机动技术",algorithm:"SeaMobileAlgorithm",type:e.COMPOSITE},Stake:{title:"在建铁路",algorithm:"StakeAlgorithm",type:e.POLYLINE},UnderProp2:{title:"支撑点2",algorithm:"UnderProp2Algorithm",type:e.POLYLINE},UnderProp3:{title:"支撑点3",algorithm:"UnderProp3Algorithm",type:e.POLYLINE},ImportantPlace:{title:"要点",algorithm:"ImportantPlaceAlgorithm",type:e.COMPOSITE},CurrentTaskLine:{title:"遭破坏的线路",algorithm:"CurrentTaskLineAlgorithm",type:e.POLYLINE},LatterTaskLine:{title:"遭破坏的道路",algorithm:"LatterTaskLineAlgorithm",type:e.POLYLINE}},r={};for(var o in i)r[o]=o;return{PATTERNS:e,TYPES:i,TYPES_KEYS:r,COMMANDNAMES:{NoopTool:"NoopTool",PlotEdit:"PlotEdit"}}}.apply(t,[]))||(e.exports=r)},function(e,t,i){"use strict";var r,o;r=[i(13),i(0),i(4)],void 0===(o=function(e,t,i){var r=function(e){i.setOptions(this,e)};return r.prototype={options:{},addTo:function(e){this.remove(),this.options.gmap=e;var t=this._fcontainer=this.onAdd(e),i=this.getPosition();if("[object String]"===Object.prototype.toString.call(i)){var r=e._controlCorners[i];$(r).append($(t))}else{r=e._controlCorners.drift;$(r).append($(t)),i&&"[object Object]"===Object.prototype.toString.call(i)&&!$.isEmptyObject(i)&&($(t).css(i),$(t).css({position:"absolute"})),$(t).css({"pointer-events":"auto"}),$(t).addClass("gs-container-subdrift")}return this.created&&this.created(),this},remove:function(){return this.options.gmap?(jQuery(this._fcontainer).remove(),this.onRemove&&this.onRemove(this.options.gmap),this.options.gmap=null,this):this},constructor:r,getPosition:function(){return this.options.position},setPosition:function(e){jQuery(this._fcontainer).remove(),this.onRemove&&this.onRemove(this.options.gmap),this.options.position=e,this.addTo(this.options.gmap)},onAdd:function(){var e=document.createElement("div");return this.options.id&&(e.id=this.options.id),this.options.className&&(e.className=this.options.className),this.container=e,this.container},getFontainer:function(){return this._fcontainer},getID:function(){var e=this.options?this.options:this.options.id;return(e=e||ctrl.id)||(e="ctr"+t.stamp(this)),e}},e.include({addControl:function(e){if(this._controls.push(e),!(e.getID?e.getID():"ctr"+t.stamp(e)))throw new Error("参数类型错误！");return e.addTo?e.addTo(this):e.onAdd(),this},removeControl:function(e){for(var t=!1,i=this._controls.length-1;i>=0;i--){var r=this._controls[i];if(r===e||r.id===e){r.remove?r.remove():r.onRemove(),this._controls.splice(i,1),t=!0;break}}return t},getControlById:function(e){for(var t=this._controls.length,i=null,r=0;r<t;r++){var o=this._controls[r];if(o.id===e){i=o;break}}return i},_initControlPos:function(){var e=this._controlCorners={},t=jQuery("#"+this.id),i=t;i.append('<div class="Corners"></div>');var r=i.find(".Corners").last();r.css({position:"absolute",width:"100%",height:"100%"}),this._setContainerParentStyles(r[0],t[0]);function o(t,i){var o="gs-container-"+t+i;r.append('<div class="'+o+'"></div>'),e[t+i]=r.find("."+o)[0]}o("top","left"),o("top","right"),o("bottom","left"),o("bottom","right"),function(){r.append('<div class="gs-container-drift"></div>');var t=i.find(".gs-container-drift");e.drift=t[0]}()},_clearPos:function(){jQuery("#"+this.id+" .Corners").remove(),jQuery("#"+this.id+" .Drift").remove()},_setContainerParentStyles:function(e,t){console.log(e),e.style.top="0px",e.style.left="0px"}}),e.addInitHook(function(){this._controls=[],this.options.initControlContainer}),r}.apply(t,r))||(e.exports=o)},function(e,t,i){"use strict";var r,o;r=[i(0),i(9),i(2)],void 0===(o=function(e,t,i){var r="class",o="plugin",n={_mergeAndCheckBeans:function(r,o){var n={};if(e.isArray(r))for(var a=0,s=r.length;a<s;a++){(p=r[a])&&(n[p.id]=p)}if(e.isArray(o)){var l=0;for(s=o.length;l<s;l++){(p=o[l])&&(n[p.id]&&i.info("override bean :"+p.id),n[p.id]=p)}}var c=[];if(this._isPackMode())for(var h in n){(p=n[h])&&(p.path?this._isGlobalVar(p.path)||(p.path=f.call(this,p.path)):delete p.path,c.push(p))}else for(var h in n){var p;if(p=n[h]){if(!e.isString(p.path)){var u=this._getBeanTypeById(p.id);p.path=this.getResourcePath()+"/js/"+u+"/"+p.id+".js"}this._isGlobalVar(p.path)||(p.path=f.call(this,p.path)),c.push(p)}}function f(i){var r={base:t.getBasePath(),resource:this.getResourcePath()};return e.replacePlaceHolder(r,i)}this.options.beans=c},_isPackMode:function(){return e.isObject(this.BEANS)},_extractBeanPath:function(){for(var t=this.options.beans,i=[],r=0,o=t.length;r<o;r++){var n=t[r];e.isString(n.path)&&(this._isGlobalVar(n.path)||i.push(n.path))}return i},_isGlobalVar:function(t){return e.isString(t)&&/^var\:.*$/.test(t)},getBean:function(e){return this._beans[e]||null},_initializeBean:function(i,n){var a=this._beans[i],s=!1,l=this.options.beans;if(null==a)for(var c=0,h=l.length;c<h;c++){var p=l[c],u=p.properties||[];if(p&&p.id==i){try{if(p.type==r){if(a=n[c],this._beans[p.id]=a,e.isArray(u)&&u.length>0&&e.isObject(a.prototype)){var f=a.prototype.options||{},y=m.call(this,u,n,l);for(var d in y=g.call(this,p,y))f[d]=y[d];a.prototype.options=f}}else if(p.type==o)s=!0,a=n[c],this._beans[p.id]=a;else{y=m.call(this,u,n,l);y=g.call(this,p,y),e.isFunction(n[c])?a=new n[c](y):e.isObject(n[c])&&(a=n[c]),this._beans[p.id]=a}}catch(e){throw new Error("failed to construct bean ["+i+"]\r\n message: "+e.message)}break}}
//!isPlugin 处理第三方库无返回值的情况
if(!s&&null==a)throw new Error("bean ["+i+"] cannot be initialized !");return a;function m(t,i,r){for(var o={},n={},a=0,s=r.length;a<s;a++){var l=r[a];if(l&&l.id)n["${"+l.id+"}"]=l.id}for(a=0,s=t.length;a<s;a++){var c=t[a],h=c.name,p=c.value;if(e.isString(p))if(n.hasOwnProperty(p)){var u=n[p];o[h]=this._initializeBean(u,i)}else{var f=/([\w\_\-\d]+)/g,y=p.match(/(\$\{[\w\.\_\-\d]{0,}\})/g);if(e.isArray(y))for(var d=0,m=y.length;d<m;d++){var g=y[d],v=g.match(f);if(e.isArray(v)&&v.length>0){var _=v.join("."),b=e.getValByVarPath(_);p=p==="${"+_+"}"?b:p.replace(g,b)}}o[h]=p}else o[h]=p}return o}function g(e,i){return i.appEvent=this.appEvent,i.locale=t.getLocaleValue(this.options.name)||{},i.parentOpts=this.options,function(e,t){var i={component:function(e){e.map=this.map},dispatcher:function(e){},view:function(e){e.imgPath=this._imgPath,e.cssPath=this._cssPath,e.htmlPath=this._htmlPath,e.configPath=this._configPath},service:function(e){e.configPath=this._configPath}},r=this._getBeanTypeById(e);r&&i[r]&&i[r].call(this,t)}.call(this,e.id,i),i}},_getBeanTypeById:function(e){var t={"^.*component$":"component","^.*dispatcher$":"dispatcher","^.*view$":"view","^.*service$":"service"},i="misc";for(var r in e&&(e=e.toLowerCase()),t)if(new RegExp(r,"i").test(e)){i=t[r];break}return i},_initializeBeans:function(){for(var t=[],i=this.options.beans,r=this.BEANS,o=0,n=0,a=i.length;n<a;n++){var s=i[n];if(e.isString(s.path))this._isGlobalVar(s.path)?t.push(e.getValByVarPath(s.path.replace(/var:/g,""))):t.push(arguments[o++]);else{var l=r[s.id];if(!l)throw new Error("bean :"+s.id+" clazz not defined!");t.push(l)}}for(n=0,a=i.length;n<a;n++){s=i[n];this._initializeBean(s.id,t)}},_activateDispatchers:function(){for(var e in this._beans){this._beans[e]&&"dispatcher"===this._getBeanTypeById(e)&&this.getBean(e).dispatch()}},_destroyBeans:function(){for(var e in this._beans){var t=this._beans[e];if(t.destroy)try{t.destroy()}catch(e){}this._beans[e]=null,delete this._beans[e]}}};function a(){var t=this,i=this._extractBeanPath();function r(){this._initializeBeans.apply(this,arguments),this._activateDispatchers(),this.fire("BEAN_INITIALIZED",{})}window.hasOwnProperty("requireNoConflict")?window.requireNoConflict(i,function(){r.apply(t,arguments)}):e.isFunction(window.require)&&e.isFunction(window.define)?window.require(i,function(){r.apply(t,arguments)}):r.apply(t,[])}function s(){this._destroyBeans()}return{enable:function(i){if(i&&i.prototype){if(i.prototype.initialize){var r=i.prototype.initialize;i.prototype.initialize=function(i){r.apply(this,arguments),function(i){var r=i.beans;delete i.beans,i.hasOwnProperty("resourcePath")&&(this.BEANS=null,this.setResourcePath(i.resourcePath));var o=this.getResourcePath();this._staticPath=i.staticPath||t.getStaticPath(),this._cssPath=i.cssPath||o+"css/",this._configPath=i.configPath||o+"config/",this._imgPath=i.imgPath||o+"img/",this._htmlPath=i.htmlPath||o+"html/";var n={};e.isString(this.options.config)&&(n=e.getConfig({url:this._configPath+this.options.config,async:!1}));var a=null;if(e.isObject(n))for(var s in a=n.beans,delete n.beans,n)this.options.hasOwnProperty(s)||(this.options[s]=n[s]);this._beans={},this._mergeAndCheckBeans(a,r)}.apply(this,arguments)}}if("Control"==i.prototype.TYPE){var o=i.prototype.onAdd;i.prototype.onAdd=function(){o.call(this),a.call(this)};var l=i.prototype.onRemove;i.prototype.onRemove=function(){l.call(this),s.call(this)}}else if("Module"==i.prototype.TYPE){var c=i.prototype.onOpen;i.prototype.onOpen=function(){c.call(this),a.call(this)};var h=i.prototype.onClose;i.prototype.onClose=function(){h.call(this),s.call(this)}}for(var p in n)i.prototype[p]=n[p]}}}}.apply(t,r))||(e.exports=o)},function(e,t,i){"use strict";var r,o;r=[i(4),i(6),i(13)],void 0===(o=function(e,t,i){function r(e){g2.carto.ElementLayer.call(this,e)}return r.prototype={options:{hasEvent:!1},constructor:r,addTo:function(e){e instanceof i?this.map=this.options.g2map=e.getMap():e instanceof g2.carto.Map&&(this.map=this.options.g2map=e),this.options.g2map&&(this.onAdd&&this.onAdd(),this.options.hasEvent&&this.addhitTest&&this.addhitTest(),this.options.g2map.addLayer(this))},remove:function(){this.options.g2map&&(this.onRemove&&this.onRemove(),this.options.hasEvent&&this.removehitTest&&this.removehitTest(),this.options.g2map.removeLayer(this))}},e.defaults(r,e,!0),e.mixin(r,t.prototype),e.mixin(r,g2.carto.ElementLayer),r}.apply(t,r))||(e.exports=o)},function(e,t,i){var r;void 0===(r=function(){var e={};function t(e,t){for(var i=[],r=e.split(";"),o=0;o<r.length;o++){var n=r[o];if(""!=n)if(t){var a=G.utils.CRSTransformUtil.bd09togcj02(n),s=G.utils.CRSTransformUtil.gcj02towgs84(a).split(",");i.push([parseFloat(s[0]),parseFloat(s[1])])}else{var l=n.split(",");i.push([parseFloat(l[0]),parseFloat(l[1])])}}return i}return e.convertResponse=function(){},e.convertTsgisResponse=function(e){var t={};if(!e.road||!e.road.road||!e.road.road)return t.code=0,t.msg="服务分析失败",t;t={code:1,msg:"服务分析成功",road:{type:"FeatureCollection",features:[]},route:{type:"Feature",geometry:{type:"LineString",coordinates:[]},properties:{info:""}}};var i=new g2.core.Deserializer,r=i.createJsInstance(JSON.stringify(e.route)).asGeoJson();r.coordinates=r.coordinates[0],t.route.geometry=r;for(var o=[],n=e.road.road.paths,a=0;a<n.length;a++){var s=n[a],l={type:"Feature",geometry:{type:"LineString",coordinates:[]},properties:{info:""}},c=new g2.sfs.Polyline,h=i.createJsInstance(JSON.stringify(s));c.addGeometry(h);var p=i.createJsInstance(JSON.stringify(c)).asGeoJson();l.geometry=p,o.push(l)}return t.road.features=o,t},e.convertBaiduResponse=function(e){var i={};if(0!=e.status)return i.code=0,i.msg="服务分析失败",i;i={code:1,msg:"服务分析成功",road:{type:"FeatureCollection",features:[]},route:{type:"Feature",geometry:{type:"LineString",coordinates:[]},properties:{info:""}}};for(var r=[],o=e.result.routes[0].steps,n=0;n<o.length;n++){var a=o[n],s={type:"Feature",geometry:{type:"LineString",coordinates:[]},properties:{info:""}};s.properties.info=a.instructions;var l=t(a.path,!0);s.geometry.coordinates=l,r=r.concat(l),i.road.features.push(s)}return i.route.geometry.coordinates=r,i},e.convertTdtResponse=function(e){var i={};if(!e.simple||!e.simple.item||!e.routelatlon)return i={code:0,msg:"服务分析失败"};i={code:1,msg:"服务分析成功",road:{type:"FeatureCollection",features:[]},route:{type:"Feature",geometry:{type:"LineString",coordinates:[]},properties:{info:""}}};var r=t(e.routelatlon);i.route.geometry.coordinates=r;for(var o=0;o<e.simple.item.length;o++){var n={type:"Feature",geometry:{type:"LineString",coordinates:[]},properties:{info:""}},a=e.simple.item[o];n.geometry.coordinates=t(a.streetLatLon),n.properties.info=a.strguide,i.road.features.push(n)}return i},e._template_result=function(){},e}.apply(t,[]))||(e.exports=r)},function(e,t,i){"use strict";var r,o,n=window.G||{};window.G=n,r=[i(25),i(32),i(34),i(37),i(51),i(61),i(65),i(77),i(13)],void 0===(o=function(e,t,i,r,o,a,s,l,c){n.Map=c,n.version="2.1"}.apply(t,r))||(e.exports=o)},function(e,t,i){"use strict";var r,o;r=[i(4),i(8),i(26),i(1),i(28),i(29),i(14),i(20),i(31)],void 0===(o=function(e,t,i,r,o,n,a,s,l){G.base={Class:e,ComponentBase:t,UiComponent:i,PureComponent:r,ControlBase:o,ModuleBase:n,ServiceBase:a,ContainerManager:s,subUiComponent:l}}.apply(t,r))||(e.exports=o)},function(e,t,i){"use strict";var r,o;r=[i(8),i(0),i(9),i(20)],void 0===(o=function(e,t,i,r){var o=e.extend({options:{map:null,htmlPath:"",cssPath:"",cssName:""},includes:r.prototype,initialize:function(r){e.prototype.initialize.call(this,r),this._cssPath=r.cssPath,this._htmlPath=r.htmlPath;var o=this.options.cssName;if(o){var n=[];if(t.isArray(o))for(var a=0,s=o.length;a<s;a++)n.push(this._cssPath+o[a]);else t.isString(o)&&n.push(this._cssPath+this.options.cssName);i.loadCss(n)}},destroy:function(){try{this.remove()}catch(e){}e.prototype.destroy.call(this)}});return o.include({loadHtml:function(e,i,r){var o=this;jQuery(e).load(i,function(){t.isFunction(r)&&r.call(o)})}}),o}.apply(t,r))||(e.exports=o)},function(e,t,i){var r,o;r=[i(4),i(6),i(10)],void 0===(o=function(e,t,i){var r=e.extend({options:{},includes:t.prototype,initialize:function(t){e.setOptions(this,t),this._obj={}},get:function(e){return this._obj.hasOwnProperty(e)?this._obj[e]:void 0},set:function(e,t,i){if(i=i||{},this._obj.hasOwnProperty(e)){if(0==Object.getOwnPropertyDescriptor(this._obj,"name").writable)throw new Error("值不能修改！");var r=!(!0===i.static);delete this._obj[e],Object.defineProperty(this._obj,e,{value:t,writable:r,configurable:!0})}else{r=!(!0===i.static);Object.defineProperty(this._obj,e,{value:t,writable:r,configurable:!0})}return!0},destroy:function(){for(var e in this._obj){try{this._obj[e]=null}catch(e){}try{delete this._obj[e]}catch(e){}}this._obj=null}});return{enable:function(e){e.include({getGlobal:function(e){var t=this._getCacher();return t.get.apply(t,arguments)},setGlobal:function(e,t,r){var o=this._getCacher(),n=!1;try{n=o.set.apply(o,arguments)}catch(e){}return 1==n&&this.fire(i.GLOBAL_VALUE_SETTED,{key:e}),n},_getCacher:function(){return null==this._cacher&&(this._cacher=new r({id:this.id})),this._cacher}})}}}.apply(t,r))||(e.exports=o)},function(e,t,i){"use strict";var r,o;r=[i(8),i(21),i(0),i(9),i(2)],void 0===(o=function(e,t,i,r,o){var n=e.extend({options:{style:{},dragable:!1,staticPath:"",cssPath:"",configPath:"",imgPath:"",htmlPath:"",resourcePath:""},TYPE:"Control",initialize:function(t){e.prototype.initialize.call(this,t)},onAdd:function(){try{this.onRemove()}catch(e){}},onRemove:function(){},destroy:function(){this.onRemove(),e.prototype.destroy.call(this)}});return n.include({getResourcePath:function(){if(!this._resourcePath){var e=this.options.name||"Anonymous";e.endsWith("Ctrl")||(e+="Ctrl"),this._resourcePath=r.getControlPath(e)}return this._resourcePath},setResourcePath:function(e){e?(this._resourcePath=(e+"").replace(/([\/\\]+)/g,"/"),this._resourcePath.endsWith("/")||(this._resourcePath=this._resourcePath+"/")):this._resourcePath=null}}),t.enable(n),n}.apply(t,r))||(e.exports=o)},function(e,t,i){"use strict";(function(e){var r,o;r=[i(8),i(21),i(9),i(0)],void 0===(o=function(e,t,i,r){var o=e.extend({options:{staticPath:"",cssPath:"",configPath:"",imgPath:"",htmlPath:"",resourcePath:""},TYPE:"Module",initialize:function(t){e.prototype.initialize.call(this,t)},onOpen:function(){},onClose:function(){},destroy:function(){this.onClose()},getResourcePath:function(){if(!this._resourcePath){var e=this.options.name||"Anonymous";e.endsWith("Module")||(e+="Module"),this._resourcePath=i.getModulePath(e)}return this._resourcePath},setResourcePath:function(e){e?(this._resourcePath=(e+"").replace(/([\/\\]+)/g,"/"),this._resourcePath.endsWith("/")||(this._resourcePath=this._resourcePath+"/")):this._resourcePath=null}});return t.enable(o),o}.apply(t,r))||(e.exports=o)}).call(this,i(30)(e))},function(e,t){e.exports=function(e){return e.webpackPolyfill||(e.deprecate=function(){},e.paths=[],e.children||(e.children=[]),Object.defineProperty(e,"loaded",{enumerable:!0,get:function(){return e.l}}),Object.defineProperty(e,"id",{enumerable:!0,get:function(){return e.i}}),e.webpackPolyfill=1),e}},function(e,t,i){"use strict";var r,o;r=[i(4)],void 0===(o=function(e){return e.extend({options:{el:void 0},addTo:function(e){this.options.el=e,this._container1=this.onAdd(map),$(this.options.el).append($(this._container1))},remove:function(){this.onRemove(),$(this._container1).remove()}})}.apply(t,r))||(e.exports=o)},function(e,t,i){"use strict";var r,o;r=[i(2),i(0),i(33),i(3),i(7),i(9),i(11),i(5)],void 0===(o=function(e,t,i,r,o,n,a,s){G.utils={},G.utils.LoggerUtil=e,G.utils.CommonUtil=t,G.utils.CRSTransformUtil=i,G.utils.GeometryUtil=r,G.utils.LayerUtil=o,G.utils.ResourceUtil=n,G.utils.SpatialOPUtil=a,G.utils.RenderUtil=s}.apply(t,r))||(e.exports=o)},function(e,t,i){"use strict";var r,o;r=[i(2)],void 0===(o=function(e){var t=window.G||{};window.G=t,t.import=t.import||{};var i={x_PI:52.35987755982988,PI:3.141592653589793,a:6378245,ee:.006693421622965943,bd09togcj02:function(e){var t=+e.split(",")[0]-.0065,r=+e.split(",")[1]-.006,o=Math.sqrt(t*t+r*r)-2e-5*Math.sin(r*i.x_PI),n=Math.atan2(r,t)-3e-6*Math.cos(t*i.x_PI);return o*Math.cos(n)+","+o*Math.sin(n)},gcj02tobd09:function(e){var t=+e.split(",")[0],r=+e.split(",")[1],o=Math.sqrt(r*r+t*t)+2e-5*Math.sin(t*i.x_PI),n=Math.atan2(t,r)+3e-6*Math.cos(r*i.x_PI);return o*Math.cos(n)+.0065+","+(o*Math.sin(n)+.006)},wgs84togcj02:function(t){var r=+t.split(",")[0],o=+t.split(",")[1];if(i.out_of_china(o,r))return e.info("超出国界范围!"),o+","+r;var n=i.transformlat(o-105,r-35),a=i.transformlng(o-105,r-35),s=r/180*i.PI,l=Math.sin(s);l=1-i.ee*l*l;var c=Math.sqrt(l);return n=180*n/(i.a*(1-i.ee)/(l*c)*i.PI),o+(a=180*a/(i.a/c*Math.cos(s)*i.PI))+","+(r+n)},gcj02towgs84:function(t){var r=+t.split(",")[0],o=+t.split(",")[1];if(i.out_of_china(r,o))return e.info("超出国界范围!"),r+","+o;var n=i.transformlat(r-105,o-35),a=i.transformlng(r-105,o-35),s=o/180*i.PI,l=Math.sin(s);l=1-i.ee*l*l;var c=Math.sqrt(l);return n=180*n/(i.a*(1-i.ee)/(l*c)*i.PI),2*r-(r+(a=180*a/(i.a/c*Math.cos(s)*i.PI)))+","+(2*o-(o+n))},transformlat:function(e,t){var r=2*(e=+e)-100+3*(t=+t)+.2*t*t+.1*e*t+.2*Math.sqrt(Math.abs(e));return r+=2*(20*Math.sin(6*e*i.PI)+20*Math.sin(2*e*i.PI))/3,r+=2*(20*Math.sin(t*i.PI)+40*Math.sin(t/3*i.PI))/3,r+=2*(160*Math.sin(t/12*i.PI)+320*Math.sin(t*i.PI/30))/3},transformlng:function(e,t){var r=300+(e=+e)+2*(t=+t)+.1*e*e+.1*e*t+.1*Math.sqrt(Math.abs(e));return r+=2*(20*Math.sin(6*e*i.PI)+20*Math.sin(2*e*i.PI))/3,r+=2*(20*Math.sin(e*i.PI)+40*Math.sin(e/3*i.PI))/3,r+=2*(150*Math.sin(e/12*i.PI)+300*Math.sin(e/30*i.PI))/3},out_of_china:function(e,t){t=+t;return!((e=+e)>73.66&&e<135.05&&t>3.86&&t<53.55)}};return i}.apply(t,r))||(e.exports=o)},function(e,t,i){"use strict";var r,o;r=[i(6),i(10),i(35),i(36)],void 0===(o=function(e,t,i,r){G.misc={AppEvent:e,AppEvents:t,Draggable:r}}.apply(t,r))||(e.exports=o)},function(e,t,i){"use strict";!function(e){function t(e){return"[object Function]"==Object.prototype.toString.call(e)}function i(e){return e instanceof Promise}e.prototype.before=function(e){var i=this;return function(){return(!t(e)||!1!==e.apply(this,arguments))&&i.apply(this,arguments)}},e.prototype.after=function(e){var r=this;return function(){var o=r.apply(this,arguments);if(!1===o)return!1;if(t(e))if(i(o)){var n=this,a=arguments;o.then(function(){var t=[];for(var i in arguments)t.push(arguments[i]);t.push(a),e.apply(n,t)})}else e.apply(this,arguments);return o}},e.prototype.around=function(e,r){var o=this;return function(){if(t(e)&&!1===e.apply(this,arguments))return!1;var n=o.apply(this,arguments);if(!1===n)return!1;if(t(r))if(i(n)){var a=this,s=arguments;n.then(function(){var e=[];for(var t in arguments)e.push(arguments[t]);e.push(s),r.apply(a,e)})}else r.apply(this,arguments);return n}}}(Function)},function(e,t,i){"use strict";var r,o;r=[i(4),i(0)],void 0===(o=function(e,t){var i=window.G||{};i.Position={TRANSFORM:function(){return this.testProp(["transform","WebkitTransform","OTransform","MozTransform","msTransform"])},testProp:function(e){for(var t=document.documentElement.style,i=0;i<e.length;i++)if(e[i]in t)return e[i];return!1},setPosition:function(e,i){e._pos=i,t.Browser().any3d?this.setTransform(e,i):(e.style.left=i[0]+"px",e.style.top=i[1]+"px")},getPosition:function(e){return e._pos||[0,0]},setTransform:function(e,i,r){var o=i||new Point(0,0);e.style[this.TRANSFORM()]=(t.Browser().ie3d?"translate("+o[0]+"px,"+o[1]+"px)":"translate3d("+o[0]+"px,"+o[1]+"px,0)")+(r?" scale("+r+")":"")}};var r=i.lang={extend:function(e){var t,i,r,o;for(i=1,r=arguments.length;i<r;i++)for(t in o=arguments[i])e[t]=o[t];return e},create:Object.create||function(){function e(){}return function(t){return e.prototype=t,new e}}()};!function(){function e(e){return window["webkit"+e]||window["moz"+e]||window["ms"+e]}var t=0;function i(e){var i=+new Date,r=Math.max(0,16-(i-t));return t=i+r,window.setTimeout(e,r)}var o=window.requestAnimationFrame||e("RequestAnimationFrame")||i,n=window.cancelAnimationFrame||e("CancelAnimationFrame")||e("CancelRequestAnimationFrame")||function(e){window.clearTimeout(e)};r.requestAnimFrame=function(e,t,r){if(!r||o!==i)return o.call(window,function(e,t){var i=Array.prototype.slice;if(e.bind)return e.bind.apply(e,i.call(arguments,1));var r=i.call(arguments,2);return function(){return e.apply(t,r.length?r.concat(i.call(arguments)):arguments)}}(e,t));e.call(t)},r.cancelAnimFrame=function(e){e&&n.call(window,e)}}(),i.bind=function(e,t){var i=Array.prototype.slice;if(e.bind)return e.bind.apply(e,i.call(arguments,1));var r=i.call(arguments,2);return function(){return e.apply(t,r.length?r.concat(i.call(arguments)):arguments)}};var o=e.extend({option:{clickTolerance:3},draggableStyle:{dragging:{cursor:"move"},defaults:{cursor:"default"}},initialize:function(i,r,o,n){e.setOptions(this,n),this._element=i,this._dragStartTarget=r||i,this.START=t.Browser().touch?"touchstart mousedown":"mousedown",this.END={mousedown:"mouseup",touchstart:"touchend",pointerdown:"touchend",MSPointerDown:"touchend"},this.MOVE={mousedown:"mousemove",touchstart:"touchmove",pointerdown:"touchmove",MSPointerDown:"touchmove"}},enable:function(){this._enabled||($(this._dragStartTarget).bind(this.START,{self:this},this._onDown),this._enabled=!0)},disable:function(){this._enabled&&(o._dragging===this&&this.finishDrag(),$(this._dragStartTarget).unbind(this.START,this._onDown),this._enabled=!1,this._moved=!1)},_onDown:function(e){var t=e.originalEvent,i=e.data.self;if(!t._simulated&&i._enabled&&(i._moved=!1,!(o._dragging||t.shiftKey||1!==t.which&&1!==t.button&&!t.touches||(o._dragging=i,i._moving)))){var r=t.touches?t.touches[0]:t;i._startPoint=[r.clientX,r.clientY],$(document).bind(i.MOVE[t.type],{self:i},i._onMove),$(document).bind(i.END[t.type],{self:i},i._onUp),i._dragStartTarget&&i._dragStartTarget.style&&(i._dragStartTarget.style.cursor=i.draggableStyle.dragging.cursor)}},_onMove:function(e){var t=e.originalEvent,r=e.data.self;if(!t._simulated&&r._enabled)if(t.touches&&t.touches.length>1)r._moved=!0;else{var o=t.touches&&1===t.touches.length?t.touches[0]:t,n=[o.clientX,o.clientY],a=r._startPoint,s=[n[0]-a[0],n[1]-a[1]];if((s[0]||s[1])&&!(Math.abs(s[0])+Math.abs(s[1])<r.options.clickTolerance)){if(t.preventDefault&&t.preventDefault(),!r._moved){r._moved=!0;var l=i.Position.getPosition(r._element);r._startPos=[l[0]-s[0],l[1]-s[1]],r._lastTarget=t.target||t.srcElement,window.SVGElementInstance&&r._lastTarget instanceof SVGElementInstance&&(r._lastTarget=r._lastTarget.correspondingUseElement)}r._newPos=[r._startPos[0]+s[0],r._startPos[1]+s[1]],r._moving=!0,i.lang.cancelAnimFrame(r._animRequest),r._lastEvent=t,r._updatePosition()}}},_onUp:function(e){var t=e.originalEvent,i=e.data.self;console.log("up"),!t._simulated&&i._enabled&&(i.finishDrag(),i._dragStartTarget.style.cursor=i.draggableStyle.defaults.cursor)},_updatePosition:function(){i.Position.setPosition(this._element,this._newPos)},setDragTarget:function(e){e&&(this._dragStartTarget=e)},getDragTarget:function(){return this._dragStartTarget},finishDrag:function(){for(var e in console.log("finishDrag"),this._lastTarget&&(this._lastTarget=null),this.MOVE)$(document).unbind(this.MOVE[e],this._onMove),$(document).unbind(this.END[e],this._onUp);this._moved&&this._moving&&i.lang.cancelAnimFrame(this._animRequest),this._moving=!1,o._dragging=!1}});return o}.apply(t,r))||(e.exports=o)},function(e,t,i){"use strict";var r,o;r=[i(15),i(12),i(16),i(39),i(40),i(41),i(43),i(44),i(18),i(45),i(46),i(47),i(22),i(48),i(49),i(50)],void 0===(o=function(e,t,i,r,o,n,a,s,l,c,h,p,u,f,y,d){G.lys={LayerFactory:p,BaseLayer:e,DistributeLayer:t,PointLayer:i,LineLayer:a,PolygonLayer:s,PointClusterLayer:o,FeaturePointLayer:r,PointDuplicateLayer:n,StatisticsLayer:l,PieStatisticsLayer:c,RingStatisticsLayer:h,ElementLayerProxy:u,ele:{PointElement:f,PolygonElement:y}},G.lys.DistributeLayer=l,G.lys.DistrictRingStaLayer=c,G.lys.DistrictPieStaLayer=h,G.lys.TYPES={ELEMENT_POINT_LAYER:G.lys.PointLayer.type,FEATURE_POINT_LAYER:G.lys.FeaturePointLayer.type,ELEMENT_POINT_PIXEL_CLUSTER:G.lys.PointClusterLayer.type,ELEMENT_POINT_DUPLICATE:G.lys.PointDuplicateLayer.type,ELEMENT_POLYLINE_LAYER:G.lys.LineLayer.type,ELEMENT_POLYGON_LAYER:G.lys.PolygonLayer.type,PIE_STATISTICS_LAYER:G.lys.PieStatisticsLayer.type,RING_STATISTICS_LAYER:G.lys.RingStatisticsLayer.type,BASE_LAYER_TAG:"_base_layer_tag"}}.apply(t,r))||(e.exports=o)},function(module,exports,__webpack_require__){"use strict";var __WEBPACK_AMD_DEFINE_ARRAY__,__WEBPACK_AMD_DEFINE_RESULT__;__WEBPACK_AMD_DEFINE_ARRAY__=[__webpack_require__(0),__webpack_require__(2)],__WEBPACK_AMD_DEFINE_RESULT__=function(CommonUtil,LoggerUtil){var extend={includeGetSymbol:function includeGetSymbol(component){component.include({_getSymbol_Zoom:function(e){return isNaN(e)&&(e=this.map.getZoomLevel()),e},_getSymbol_DataObj:function(e,t){if(t)return e[this.options.attributeField]},_getDataOrData2:function(e,t){return null==e?t:e},_getSymbol_symKeyLookstr:function(e,t){return e.endsWith(t)&&(e=e.substr(0,e.length-3)),e},_getSymbol_symKeyObj:function(e,t){for(var i,r,o=0,n=e.length,a="",s=0;o<n;o++){var l=e[o];if(l){var c=t[l.field],h=l.values;if(h){for(i=h.length,s=0,r=null;s<i&&(r=h[s],!CommonUtil.assertWithin(c,r));s++);r&&(a+=l.field+"$=$"+h[s]+"$_$")}}}return{symKey:a,rangeStr:r}},_getSymbolObjByKey:function(e){for(var t=0,i=this.allSymbols.length;t<i;t++){var r=this.allSymbols[t];if(r&&r.symbolKey==e)return r}return null},_doGetSymbol:function(e,t,i){var r=t.label,o=t.symbol||i;if(r&&r.enable){var n=r.options||{};n.text=this._getLabelText(e,r.textFormat);var a={textSymbol:this._createSymbol("TextSymbol",n)};return o instanceof g2.sfs.SimpleMarkerSymbol||o instanceof g2.sfs.PictureMarkerSymbol?a.markerSymbol=o:o instanceof g2.sfs.SimpleLineSymbol?a.lineSymbol=o:o instanceof g2.sfs.SimpleFillSymbol&&(a.fillSymbol=o),new g2.sfs.CurrencySymbol(a)}return o},_onSymbolsUpdated:function(){if(this._invokeSymbolUpdateCallback){for(var e,t=0,i=(e=this.layer.elements).length,r=[];t<i;t++){var o=e[t]._symbolKey;if(o){if(this._getSymbolObj(o,r))continue;var n=this._getSymbolObj(o,this.allSymbols);r.push(n)}}this.currentSymbols=null,this.currentSymbols=r,this.invokeCallback("symbolUpdateCallback",{layerId:this.options.layerId,symbols:r})}},_onElementChanged:function(){var e=this.elements||this.features,t=[];if(0==e.length)this._currentExtent=[NaN,NaN,NaN,NaN];else{for(var i=0,r=e.length;i<r;i++){var o=e[i];o&&o.geometry&&t.push(o.geometry)}var n=G.utils.GeometryUtil.getGeometryEnvlop(t);this._currentExtent=this._envelopeFromGeom(n)}},_fetchSymbolConfig:function _fetchSymbolConfig(data,renderer){if(!renderer)return null;if("zoomLevel"==renderer.type)return renderer;var valueCfg=renderer.values,key,value=eval("data."+renderer.field);for(key in valueCfg)if(CommonUtil.assertWithin(value,key)){var cfg=valueCfg[key];return cfg.renderer?this._fetchSymbolConfig(data,cfg.renderer):cfg}return null},_getLabelText:function(e,t){if(!t)return"";var i=/([\w\_\-\d]+)/g,r=t.match(/(\$\{[\w\_\-\d]{0,}\})/g),o=t;if(r&&r.length>0)for(var n=0,a=r.length;n<a;n++){var s=r[n],l="",c=s.match(i);c&&1==c.length&&(l=e[c[0]]||""),o=o.replace(s,l)}return o}})},includeFindElementById:function(e){e.include({_getElementLayerById:function(e,t){var i=e.find(t),r=void 0;return null!=i&&(r={element:i,layer:e}),r},_getGroupLayerLayerById:function(e,t){var i=e.groupLayers;for(var r in i){var o=this._getLayerElementById(i[r],t);if(o)return o}return o},_getFeatureLayerById:function(e,t){for(var i=e.features,r=0,o=i.length;r<o;r++){var n=i[r];if(n&&n.objectId==t)return{element:n,layer:e}}},_getLayerElementById:function(e,t){var i=void 0;return e instanceof g2.carto.ElementLayer||e instanceof g2.carto.ClusterLayer?i=this._getElementLayerById(e,t):e instanceof g2.carto.GroupLayer?i=this._getGroupLayerLayerById(e,t):e instanceof g2.carto.FeatureLayer?i=this._getFeatureLayerById(e,t):(LoggerUtil.error("Unkown Type layer!!!"),LoggerUtil.error(e,t)),i}})},includeParseSymbolCfg:function includeParseSymbolCfg(component){component.include({_getSymbolObj:function(e,t){for(var i=t||this.allSymbols,r=0,o=i.length;r<o;r++){var n=i[r];if(n&&n.symbolKey==e)return n}return null},_getSymbolCfg:function(e,t){this.symbolConfig?(this._parseSymbolCfg(this.symbolConfig),CommonUtil.isFunction(e)&&e.call(t||window,this.symbolConfig)):CommonUtil.ajaxGet({url:this.options.symbolConfigUrl,dataType:"json",async:!1},function(i){this._parseSymbolCfg(i),CommonUtil.isFunction(e)&&e.call(t||window,i)},this)},_setValid_SymOptsSource:function(e){e&&e.sourceKey&&!e.source&&(e.source="")},_getValidObj:function(e){return null==e?{}:e},_parseSymbolCfg:function _parseSymbolCfg(cfg){var selfObj=this;if(cfg){this.symbolConfig=null,delete this.symbolConfig,this.symbolConfig_=null,delete this.symbolConfig_,this.symbolConfig_=jQuery.extend(!0,{},cfg);var defaultSym=this._getValidObj(cfg.default);defaultSym.type&&defaultSym.options&&(cfg.defaultSymbol=this._createSymbol(defaultSym.type,defaultSym.options));var tmpLabel=this._getValidObj(cfg.label);cfg.label=jQuery.extend(!0,{enable:!1,options:{},textFormat:""},tmpLabel),this.renderFields=[];var allSymbols=[{symbolKey:this.options.defaultSymbolKey,title:cfg.title,symbol:cfg.defaultSymbol,label:cfg.label}];this.allSymbols=allSymbols,_handlerRenderer(cfg,cfg,"",this._createSymbol,this.renderFields,this),this.symbolConfig=cfg}function _handlerRenderer(e,t,i,r,o,n){var a,s=e.renderer;if(!s)return!1;if("zoomLevel"==s.type)t.renderZoom=!0,i+="zoomLevel$=$";else{var l=s.field;ensureFieldUnique(o,s),i+=l+"$=$"}var c=s.values;for(a in c){var h=c[a],p=i;if(p+=a+"$_$",h.renderer)_handlerRenderer(h,t,p,r,o,n);else{var u=jQuery.extend(!0,{},t.default);h.symbol=selfObj._getValidObj(h.symbol);var f=h.symbol.options;if(selfObj._setValid_SymOptsSource(f),u=jQuery.extend(!0,u,h.symbol),h.symbol=r.call(n,u.type,u.options),h.title=h.title||e.title,h.symbolKey=p.substr(0,p.length-3),t.label.enable)if(!1===h.label);else{var y=jQuery.extend(!0,{},t.label);h.label=selfObj._getValidObj(h.label),y=jQuery.extend(!0,y,h.label),h.label=y}else h.label=!1;allSymbols.push({symbolKey:h.symbolKey,title:h.title,symbol:h.symbol,label:h.label})}}return!0}function ensureFieldUnique(fields,cfg){for(var k=0,len=fields.length;k<len;k++){var field=fields[k];if(field&&field.field==cfg.field)return}var values=[],vals=cfg.values||{};for(var k in vals){var regVal=null;try{var reg=eval(k);reg instanceof RegExp&&(regVal=reg)}catch(e){}values.push(regVal||k)}var field={field:cfg.field,values:values};fields.push(field)}}})},includeGenerateNewSymbol:function(e){e.include({_getIconSource:function(e){if(e)return e.indexOf(".")<0?G.icons[e]:G.utils.CommonUtil.getValByVarPath(e)},_generateNewSymbol:function(e,t){var i=null,r={},o=e.$type.split(",")[0],n=this;function a(e,t){var i;return e&&(i=n._generateNewSymbol(e,t)),i}var s=function(e,t){var i=null;if(CommonUtil.isObject(t))e==t.type&&(i=t);else if(CommonUtil.isArray(t))for(var r=0,o=t.length;r<o;r++){var n=t[r];if(n&&n.type==e){i=n;break}}return i||{}}(o,t);jQuery.extend(!0,r,s.options||{});var l={PictureMarkerSymbol:function(){var t=e.sourceKey+"_hl";return r.source=n._getIconSource(t),n._createSymbol(o,r)},SimpleMarkerSymbol:function(){return n._createSymbol(o,r)},SimpleLineSymbol:function(){return n._createSymbol(o,r)},SimpleFillSymbol:function(){return n._createSymbol(o,r)},CurrencySymbol:function(){var i,r,o,n=e.fillSymbol||null,s=e.markerSymbol||null,l=e.textSymbol||null;return i=a(n,t),r=a(s,t),o=a(l,t),new g2.sfs.CurrencySymbol({fillSymbol:i,markerSymbol:r,textSymbol:o})}};return"function"==typeof l[o]&&(i=l[o]()),i}})}};return extend}.apply(exports,__WEBPACK_AMD_DEFINE_ARRAY__),void 0===__WEBPACK_AMD_DEFINE_RESULT__||(module.exports=__WEBPACK_AMD_DEFINE_RESULT__)},function(e,t,i){"use strict";var r,o;r=[i(12),i(0),i(2)],void 0===(o=function(e,t,i){var r=e.extend({options:{symbolConfig:!1,xField:"longitude",yField:"latitude",metaData:{}},initialize:function(t){this.noneSpatialArr=[],this.features=[],e.prototype.initialize.call(this,t),this.metaData=this.options.metaData||{},delete this.options.metaData,this.currentZoom=this.map.getZoomLevel(),this.layer=new g2.carto.GroupLayer({id:this.options.layerId,name:this.options.layerName||"",map:this.map,layers:[]}),this.featureLayersHolder={}},_addListeners:function(){e.prototype._addListeners.call(this),this.map.on("extentchanged",this._getExtentChangeListener())},_removeListeners:function(){this.map.off("extentchanged",this._getExtentChangeListener()),e.prototype._removeListeners.call(this)},_getExtentChangeListener:function(){if(!this._extentChangeListener){var e=this;this._extentChangeListener=function(t){var i=e.map.getZoomLevel();e.updateSymbol(i),e.currentZoom=i}}return this._extentChangeListener},_getMapClickListener:function(){if(!this._mapClickListener){this._mapClickListener=function(){}}return this._mapClickListener},addElements:function(e,t){if(e){t=t||{};var r=this._getFields(this.metaData);this.metaFields=r;var o,n,a,s=0;n=(new Date).getTime();for(var l=e.length,c=r.getCount(),h=this.map.getZoomLevel(),p=this.options.attributeField,u=this.options.spatialReference,f=t.dataSpatialReference||this.options.dataSpatialReference,y=0;y<e.length;y++){var d=e[y],m=this._getGeometry(d,f,u);if(this.validateGeometry(m)){var g,v=[];g=p?d[p]||{}:d;for(var _=0;_<c;_++){var b=r.fields[_],w=new g2.sfs.Value;w.setValue(g[b.name]||null),v.push(w)}var S=this._getRecordId(d),L=new g2.sfs.Feature({fields:r,values:v,geometry:m,objectId:S});L._data=d,this.features.push(L),o=(new Date).getTime();var P=this._getSymbol(g,h);s+=(new Date).getTime()-o,this._addFeature(L,P)}else this.noneSpatialArr.push(d)}i.info("feature count :"+l),i.info("fetch symbol costs :"+s),this._addFeatures2Layer(),this._updateFeatureLayers({visible:!0}),this._onSymbolsUpdated(),this._onElementChanged(),a=(new Date).getTime(),i.info("total costs :"+(a-n))}},_addFeature:function(e,t){if(t&&t.symbol){var i=t.symbolKey||this.options.defaultSymbolKey,r=this.featureLayersHolder[i]||{},o=r.layer;if(!o)o=new g2.carto.FeatureLayer({map:this.map,visible:!1,cache:!0}),this.layer.addLayer(o),r={renderer:new g2.render.SimpleRenderer({symbol:t.symbol}),layer:o,zoomRanges:t.zoomRanges},this.featureLayersHolder[i]=r;r.featureSet||(r.featureSet=new g2.sfs.FeatureSet({fields:this.metaFields})),r.featureSet.add(e)}},_addFeatures2Layer:function(){for(var e in this.featureLayersHolder){var t=this.featureLayersHolder[e],i=t.featureSet,r=t.layer;t.featureSet=null,i&&r.addFeatures(i)}},_updateFeatureLayers:function(e){var t,i=(e=e||{}).visible||!1;for(t in this.featureLayersHolder){var r=this.featureLayersHolder[t];i?r&&(r.layer.setVisible(!0),r.layer.render(r.renderer)):r.layer.setVisible(!1)}this.layer.setVisible(i)},_getFields:function(e){var t=new g2.sfs.Fields;if(e)for(var i=e.model||[],r=i.length,o=0;o<r;o++){var n=i[o];if(n){var a=new g2.sfs.Field({name:n.fieldName,alias:n.fieldNote,dataType:n.fieldType,isShape:!1});t.add(a)}}return t},getElementSymbol:function(e){var t,i=this.featureLayersHolder;for(t in i){var r=i[t];if(r){var o=r.layer,n=r.renderer;if(o&&n)for(var a=o.features,s=0,l=a.length;s<l;s++){var c=a[s];if(c&&c.objectId==e)return n.symbol}}}return null},updateSymbol:function(e){var i,r=this.featureLayersHolder,o=0;for(i in r)if(!(i.indexOf("zoomLevel$=$")<0)){for(var n,a=r[i],s=i.split("$_$"),l=s[s.length-1].split("$=$")[1],c=a.zoomRanges,h=s.slice(0,s.length-1),p=0,u=c.length;p<u;p++){var f=c[p];if(t.assertWithin(e,f)){n=f,h.push("zoomLevel$=$"+f);break}}if(n!=l){var y=h.join("$_$"),d=this._getSymbolObjByKey(y),m=new g2.render.SimpleRenderer({symbol:d.symbol});a.renderer=m,a.layer.render(a.renderer),delete r[i],r[d.symbolKey]=a,o++}}o>0&&this._onSymbolsUpdated()},_createSymbol:function(t,i){return e.prototype._createSymbol.call(this,t,i)},removeElements:function(e){if(t.isArray(e)){for(var r=e.length-1;r>=0;r--){var o,n=e[r];o="string"==typeof n?n:n.objectId;var a=this._getLayerElementById(this.layer,o);if(a&&a.layer&&a.element)try{a.layer.remove(a.element)}catch(e){i.warn("fail to delete feature with objectId:"+o+"!")}}this._onSymbolsUpdated(),this._onElementChanged()}},_onSymbolsUpdated:function(){var e,t=this.featureLayersHolder,i=[];for(e in t){var r=t[e];if(r){var o=r.layer;if(o&&o.visible&&o.features.length>0){var n=this._getSymbolObj(e);n&&i.push(n)}}}this.currentSymbols=null,this.currentSymbols=i,this.invokeCallback("symbolUpdateCallback",{layerId:this.options.layerId,symbols:i})},hitTest:function(e,t){var i=this.getLayer(),r=[];if(i&&i.visible)if(i instanceof g2.carto.GroupLayer)for(var o=i.groupLayers,n=o.length-1;n>=0;n--){a(o[n],e,t,r)}else a(i,e,t,r);function a(e,t,i,r){var o=e.hitTest(t,i);o&&r.push(o)}return r[0]||void 0},getElements:function(){return this.features},clear:function(){this.features=[];for(var t=this.layer.groupLayers,i=0,r=t.length;i<r;i++){var o=t[i];o&&o.clear&&o.clear()}e.prototype.clear.call(this)},destroy:function(){e.prototype.destroy.call(this)}});return Object.defineProperty(r,"type",{value:12,configurable:!1,writable:!1}),r}.apply(t,r))||(e.exports=o)},function(e,t,i){"use strict";var r,o;r=[i(16),i(0),i(2)],void 0===(o=function(e,t,i){var r=e.extend({options:{},initialize:function(t){e.prototype.initialize.call(this,t),this._defaultClusterStyle={textFillColor:{alpha:255,r:255,g:255,b:255},fillColor:{alpha:200,r:0,g:0,b:255},fillStrokeColor:{alpha:100,r:0,g:0,b:255},fillStrokeWidth:10,distance:10,clusterLevel:10};var i=this.symbolConfig.cluster||this._defaultClusterStyle;this._clusterSymbol=jQuery.extend(!0,{$type:"pixelcluster"},i),this._clusterSymbol.fillStrokeColor=this._getColor(this._clusterSymbol.fillStrokeColor),this._clusterSymbol.fillColor=this._getColor(this._clusterSymbol.fillColor),this._clusterSymbol.textFillColor=this._getColor(this._clusterSymbol.textFillColor);var r=["textFillColor","fillColor","fillStrokeColor"];for(var o in r){var n=i[r[o]];n&&(i[r[o]]=this._getColor(n).toArray())}var a={id:this.options.layerId,name:this.options.layerName,map:this.map},s=jQuery.extend(a,i);this.layer=new g2.carto.ClusterLayer(s),isNaN(s.clusterLevel)||this.layer.setClusterLevel(s.clusterLevel)},_addListeners:function(){e.prototype._addListeners.call(this)},_removeListeners:function(){e.prototype._removeListeners.call(this)},_zoomChangeListener:function(e){this.updateSymbol(this.map.getZoomLevel())},addElements:function(e,r){if(t.isArray(e)){r=r||{};for(var o=this.map.getZoomLevel(),n=this.options.spatialReference,a=r.dataSpatialReference||this.options.dataSpatialReference,s=0,l=e.length;s<l;s++){var c=e[s],h=this._getGeometry(c,a,n);if(h){var p=this._getSymbol(c,o),u=this._getRecordId(c),f=new g2.sfs.Element({id:u,geometry:h,symbol:p.symbol});f._data=c,f._zoomRange=p.zoomRange,f._symbolKey=p.symbolKey,this.elements.push(f)}else this.noneSpatialArr.push(c)}this.layer.addElements(this.elements),this._onSymbolsUpdated(),this._onElementChanged()}else i.error("dataArr is not an array")},removeElements:function(e){if(t.isArray(e)){for(var i=e.length-1;i>=0;i--){var r=e[i];this.layer.remove(r)}this._onSymbolsUpdated(),this._onElementChanged()}},_onSymbolsUpdated:function(){for(var e=this.layer.elements,t=0,i=e.length,r=[];t<i;t++){var o=e[t]._symbolKey;if(o){if(this._getSymbolObj(o,r))continue;var n=this._getSymbolObj(o,this.allSymbols);r.push(n)}}r.length>0&&r.push({symbolKey:"pixel-cluster",symbol:this._clusterSymbol,title:this.options.layerName+"像素聚合"}),this.currentSymbols=null,this.currentSymbols=r,this.invokeCallback("symbolUpdateCallback",{layerId:this.options.layerId,symbols:r})},clear:function(){e.prototype.clear.call(this)},destroy:function(){e.prototype.destroy.call(this)}});return Object.defineProperty(r,"type",{value:13,configurable:!1,writable:!1}),r}.apply(t,r))||(e.exports=o)},function(e,t,i){"use strict";var r,o;r=[i(16),i(42),i(0),i(3),i(17),i(2)],void 0===(o=function(e,t,i,r,o,n){var a=e.extend({options:{spiderfyDistance:1,spiderfyLevel:10,enableCoincidenceClusterLevel:"[0,10000]",coincidenceClusterHoverThreshold:15,coincidenceClusterWeight:1.2,coincidenceClusterMarkerSym:{borderColor:{alpha:150,r:150,g:120,b:226},fillColor:{alpha:220,r:106,g:63,b:214}},coincidenceClusterTextSym:{fontSize:12,foreground:{alpha:255,r:255,g:255,b:255},borderColor:{alpha:1,r:255,g:255,b:255}},showSpiderLeg:!0,spiderfyThreshold:5,circleRadius:30,spiderfyLegSym:{style:0,width:2,color:{alpha:"150",r:0,g:0,b:255}}},initialize:function(i){e.prototype.initialize.call(this,i),this.options.enalbeSpiderfy=!0,this.options.enableCoincidenceCluster=!0,t.init.call(this)},destroy:function(){this._clearSpiderfy(!0),e.prototype.destroy.call(this)},addElements:function(e,t){if(i.isArray(e)){t=t||{};var r=this.map.getZoomLevel(),o=this.options.spatialReference,a=t.dataSpatialReference||this.options.dataSpatialReference,s=!1;this.options.enalbeSpiderfy&&(r>=this.options.spiderfyLevel?s="spiderfy":this.options.enableCoincidenceCluster&&i.assertWithin(this.map.getZoomLevel(),this.options.enableCoincidenceClusterLevel)&&(s="cluster"));for(var l=0,c=e.length;l<c;l++){var h=e[l],p=this._getGeometry(h,a,o);if(this.validateGeometry(p)){var u=this._getSymbol(h,r),f=this._getRecordId(h),y=new g2.sfs.Element({id:f,geometry:p,symbol:u.symbol});y._data=h,y._zoomRange=u.zoomRange,y._symbolKey=u.symbolKey,this.elements.push(y),s||this.layer.add(y)}else this.noneSpatialArr.push(h)}s&&this._updateSpiderfy(s),this._onSymbolsUpdated(),this._onElementChanged()}else n.error("dataArr is not an array")},hitTest:function(e,t){var i,r=[];((i=this.layer.hitTest(e,t))&&r.push(i),this.coincidenceHoverLayer)&&((i=this.coincidenceHoverLayer.hitTest(e,t))&&r.push(i));return r[0]||null},clear:function(){this._clearSpiderfy(),this.elements=[],e.prototype.clear.call(this)},setVisible:function(e){this.layer.setVisible(e||!1),this.options.enalbeSpiderfy&&(this.spiderfyAttachLayer&&this.spiderfyAttachLayer.setVisible(e||!1),this.coincidenceClusterLayer&&this.coincidenceClusterLayer.setVisible(e||!1),this.coincidenceHoverLayer&&this.coincidenceHoverLayer.setVisible(e||!1)),e?this.invokeCallback("symbolUpdateCallback",{layerId:this.options.layerId,symbols:this.currentSymbols}):this.invokeCallback("symbolUpdateCallback",{layerId:this.options.layerId,symbols:[]})}});return a.include({_extentChangeListener:function(){var e=this.map.getZoomLevel();if(e!==this.currentZoom){if(this.updateSymbol(e),this._applySpiderfy(this.currentZoom,e)){if(null!=this.currentClusterObj){var t=this._getCurrentClusterElementIdOnUpdate();if(null!=t){this.coincidenceHoverLayer.clear();var i=this.coincidenceClusterLayer.find(t);i&&(this._addHoverSpiderfy(i),this.currentClusterObj=this._extractClusterElement(i),this._toggleCurrentClusterElement(!1))}}this.fire("clusterChange",jQuery.extend(!0,{},this.currentClusterObj))}this.currentZoom=e}},_mapClickListener:function(e){var t=this.hitTest(e.screenX,e.screenY),i=!1,r=!0;if(t&&(this.fire("click",{element:t.element,layer:t.layer}),i=!0,r=this._applyToggleCurrentClusterElement(t.element)),r&&(this._toggleCurrentClusterElement(!0),this.coincidenceHoverLayer.clear()),!i&&this.coincidenceClusterLayer){var o=this.coincidenceClusterLayer.hitTest(e.screenX,e.screenY);if(o){var n=o.element;if(n)return void(this._addHoverSpiderfy(n)&&(this.currentClusterObj=this._extractClusterElement(n),this._toggleCurrentClusterElement(!1)))}}},_getLayerElementById:function(e,t){var i=this.elements;for(var r in i){var o=i[r];if(o.id==t)return{element:o,layer:e}}},_getElementsCenter:function(e){for(var t=0,i=0,r=e.length,o=0;o<r;o++){var n=e[o];t+=n.geometry.x,i+=n.geometry.y}return[t/r,i/r]}}),t.include(a),Object.defineProperty(a,"type",{value:14,configurable:!1,writable:!1}),a}.apply(t,r))||(e.exports=o)},function(e,t,i){"use strict";var r,o;r=[i(0),i(3),i(17)],void 0===(o=function(e,t,i){var r={init:function(){this.distanceGrid=new i(this.options.spiderfyDistance),this.options.showSpiderLeg&&(this.spiderfyAttachLayer=new g2.carto.ElementLayer({id:this.options.layerId+"-spiderfyattach",name:this.options.layerName+"重复点自动排列的辅助图层",map:this.map}),this.map.addLayer(this.spiderfyAttachLayer)),this.options.enableCoincidenceCluster&&(this.coincidenceClusterLayer=new g2.carto.ElementLayer({id:this.options.layerId+"-coincidence-cluster",name:this.options.layerName+"重复点聚合图层",map:this.map}),this.map.addLayer(this.coincidenceClusterLayer),this.coincidenceHoverLayer=new g2.carto.ElementLayer({id:this.options.layerId+"-coincidence-hover",name:this.options.layerName+"重复点滑过展开",map:this.map}),this.map.addLayer(this.coincidenceHoverLayer)),this.options.spiderfyLegSym&&(this.options.spiderfyLegSym=new g2.sfs.SimpleLineSymbol({style:this.options.spiderfyLegSym.style,width:this.options.spiderfyLegSym.width,color:this._getColor(this.options.spiderfyLegSym.color)})),this.currentClusterObj=null},include:function(i){var r=i.prototype,o={_applySpiderfy:function(t,i){if(t===i)return!1;if(!this.options.enalbeSpiderfy)return!1;if(!this.getVisible())return!1;var r=this.options.spiderfyLevel,o=(this.options.spiderfyDistance,!1);return this.options.enableCoincidenceCluster?i>=r?o="spiderfy":e.assertWithin(i,this.options.enableCoincidenceClusterLevel)?o="cluster":this._disableSpiderfy():i>=r?o="spiderfy":t>=r&&i<r&&this._disableSpiderfy(),console.log(o),o&&this._updateSpiderfy(o),!0},_updateSpiderfy:function(e){if("spiderfy"===e||"cluster"===e){this._clearSpiderfy(!1),this.layer.clear();for(var i=this,r=this.options.spatialReference,o=this.options.spiderfyThreshold||5,n=0,a=this.elements.length;n<a;n++){var s=this.elements[n],l=s.geometry,c=this.map.getPixelFromCoordinate([l.x,l.y]);this.distanceGrid.addObject(s,{x:c[0],y:c[1]})}switch(e){case"spiderfy":this.distanceGrid.eachCell(function(e,n,a){if(e.length<2)i.layer.addElements(e);else{var s,l=i._getElementsCenter(e),c=new g2.sfs.Point({x:l[0],y:l[1],spatialReference:r}),h=e.length,p=i.options.showSpiderLeg,u=i.map.getPixelFromCoordinate(l);if(h<=o){var f=i.options.circleRadius||20;s=t.getCirclePonits({center:u,radius:f,count:h})}else s=t.getSpiderfy(u,h,11,5,28);for(var y=0;y<h;y++)try{var d=e[y],m=i.map.getCoordinateFromPixel(s[y]),g=new g2.sfs.Point({x:m[0],y:m[1],spatialReference:r}),v=new g2.sfs.Element({id:d.id,geometry:g,symbol:d.symbol});if(v._data=d._data,i.layer.add(v),p){var _=new g2.sfs.Polyline({spatialReference:r}),b=new g2.sfs.Path({spatialReference:r});b.addPoint(c),b.addPoint(g),_.addGeometry(b);var w=i.options.spiderfyLegSym,S=new g2.sfs.Element({geometry:_,symbol:w});i.spiderfyAttachLayer.add(S)}}catch(e){}}});break;case"cluster":this.distanceGrid.eachCell(function(e,t,o){if(e.length<2)i.layer.addElements(e);else{var n=i._getElementsCenter(e),a=new g2.sfs.Point({x:n[0],y:n[1],spatialReference:r}),s=i.getCoincidenceClusterSym(e),l=t+"_"+o,c=new g2.sfs.Element({id:l,geometry:a,symbol:s});c._indexs=[t,o],i.coincidenceClusterLayer.add(c)}})}}},_addHoverSpiderfy:function(e){var i=e._indexs;if(!i||2!=i.length)return!1;var r=this.distanceGrid.getObjects(i[0],i[1]),o=this.options.spatialReference;if(r.length>this.options.coincidenceClusterHoverThreshold)return!1;var n,a=this._getElementsCenter(r),s=new g2.sfs.Point({x:a[0],y:a[1],spatialReference:o}),l=r.length,c=this.options.showSpiderLeg,h=this.options.spiderfyLegSym,p=this.map.getPixelFromCoordinate(a);if(l<=(this.options.spiderfyThreshold||5)){var u=this.options.circleRadius||20;n=t.getCirclePonits({center:p,radius:u,count:l})}else n=t.getSpiderfy(p,l,11,5,28);for(var f=0;f<l;f++){var y=r[f],d=this.map.getCoordinateFromPixel(n[f]),m=new g2.sfs.Point({x:d[0],y:d[1],spatialReference:o}),g=new g2.sfs.Polyline({spatialReference:o}),v=new g2.sfs.Path({spatialReference:o});if(v.addPoint(s),v.addPoint(m),c){g.addGeometry(v);h=this.options.spiderfyLegSym;var _=new g2.sfs.Element({geometry:g,symbol:h});this.coincidenceHoverLayer.add(_)}var b=new g2.sfs.Element({id:y.id,geometry:m,symbol:y.symbol});this.coincidenceHoverLayer.add(b)}return!0},getCoincidenceClusterSym:function(t){var i=(t=t||[]).length,r=this.options.coincidenceClusterMarkerSym||{},o=this.options.coincidenceClusterTextSym||{},n=i+"";r.borderColor&&(r.borderColor=this._getColor(r.borderColor)),r.fillColor&&(r.fillColor=this._getColor(r.fillColor)),o.foreground&&(o.foreground=this._getColor(o.foreground)),o.borderColor&&(o.borderColor=this._getColor(o.borderColor));var a=o.fontSize||15,s=a*this.options.coincidenceClusterWeight,l=e.getEquivalentNum(n,s,s),c={borderColor:new g2.sfs.Color({a:150,r:50,g:175,b:254}),fillColor:new g2.sfs.Color({a:220,r:4,g:131,b:232}),borderThickness:l,size:l},h={text:n,fontSize:a,fontWeight:1,offsetX:0,offsetY:0,foreground:new g2.sfs.Color({a:255,r:255,g:255,b:255}),borderColor:new g2.sfs.Color({a:1,r:255,g:255,b:255}),borderThickness:0};jQuery.extend(!0,c,r),jQuery.extend(!0,h,o);var p=new g2.sfs.SimpleMarkerSymbol(c),u=new g2.sfs.TextSymbol(h);return new g2.sfs.CurrencySymbol({markerSymbol:p,textSymbol:u})},_clearSpiderfy:function(e){if(this.options.enalbeSpiderfy){if(this.spiderfyAttachLayer&&(this.spiderfyAttachLayer.clear(),e&&this.map.removeLayer(this.spiderfyAttachLayer)),this.coincidenceClusterLayer){var t=this.coincidenceClusterLayer.elements;for(var i in t){var r=t[i];r&&(r._indexs=null,delete r._indexs)}this.coincidenceClusterLayer.clear(),e&&this.map.removeLayer(this.coincidenceClusterLayer)}this.coincidenceHoverLayer&&(this.coincidenceHoverLayer.clear(),e&&this.map.removeLayer(this.coincidenceHoverLayer)),this.distanceGrid&&(e?this.distanceGrid.destroy():this.distanceGrid.clear())}},_disableSpiderfy:function(){this.layer.clear(),this.layer.addElements(this.elements),this._clearSpiderfy()},_toggleCurrentClusterElement:function(e){if(null!=this.currentClusterObj){var t=this.coincidenceClusterLayer.find(this.currentClusterObj.id);!0===e?(this.coincidenceClusterLayer.showElement(t,!0),this.currentClusterObj=null):this.coincidenceClusterLayer.showElement(t,!1)}},_applyToggleCurrentClusterElement:function(e){var t=!0;if(null!=this.currentClusterObj)for(var i=this.coincidenceClusterLayer.find(this.currentClusterObj.id)._indexs,r=this.distanceGrid.getObjects(i[0],i[1]),o=0;o<r.length;o++)if(e.id===r[o].id){t=!1;break}return t},_extractClusterElement:function(e){if(e){var t={};t.id=e.id,t.elementSet={};for(var i=e._indexs,r=this.distanceGrid.getObjects(i[0],i[1]),o=0;o<r.length;o++){var n=r[o],a=this.coincidenceHoverLayer.find(n.id);t.elementSet[n.id]=a?{x:a.geometry.x,y:a.geometry.y}:{}}return t}return null},_getCurrentClusterElementIdOnUpdate:function(){var e=null;if(null!=this.currentClusterObj){var t=this.currentClusterObj.elementSet,i=null;this.distanceGrid.eachCell(function(e,r,o){var n=Object.keys(t).length,a=0,s=e.length;for(var l in t)for(var c=0;c<s;c++)if(e[c]&&e[c].id===l){a++;break}a>Math.round(n/2)&&(i=r+"_"+o)}),e=i||null}return e}};for(var n in o)r[n]=o[n]}};return r}.apply(t,r))||(e.exports=o)},function(e,t,i){"use strict";var r,o;r=[i(12),i(0),i(2)],void 0===(o=function(e,t,i){var r=e.extend({options:{symbolConfig:!1},initialize:function(t){this.noneSpatialArr=[],this.elements=[],e.prototype.initialize.call(this,t)},_addListeners:function(){e.prototype._addListeners.call(this),this.map.on("resolutionchanged",this._getZoomChangeLisener())},_removeListeners:function(){this.map.off("resolutionchanged",this._getZoomChangeLisener()),e.prototype._removeListeners.call(this)},_getZoomChangeLisener:function(){if(!this._zoomChangeLisener){var e=this;this._zoomChangeLisener=function(t){e.updateSymbol(t.level)}}return this._zoomChangeLisener},addElements:function(e,r){if(t.isArray(e)){r=r||{};for(var o=this.map.getZoomLevel(),n=this.options.spatialReference,a=r.dataSpatialReference||this.options.dataSpatialReference,s=0,l=e.length;s<l;s++){var c=e[s],h=this._getGeometry(c,a,n);if(h){var p=this._getSymbol(c,o),u=this._getRecordId(c),f=new g2.sfs.Element({id:u,geometry:h,symbol:p.symbol});f._data=c,f._zoomRange=p.zoomRange,f._symbolKey=p.symbolKey,this.elements.push(f),this.layer.add(f)}else this.noneSpatialArr.push(c)}this._onSymbolsUpdated(),this._onElementChanged()}else i.error("dataArr is not an array")},getGeometry:function(e,t,i){if(!e)return null;var r=e[this.options.geometryField],o=null;try{"string"==typeof r?(r=this.wktReader.read(r).toString(),o=g2.sfs.GeometryFactory.createGeometryFromWkt(r,t)):o=g2.sfs.GeometryFactory.createGeometryFromGeoJson(r,t)}catch(e){}return t&&i&&t!=i&&(o=this.projService.transform(o,i)),o}});return Object.defineProperty(r,"type",{value:21,configurable:!1,writable:!1}),r}.apply(t,r))||(e.exports=o)},function(e,t,i){"use strict";var r,o;r=[i(12),i(0),i(2)],void 0===(o=function(e,t,i){var r=e.extend({options:{symbolConfig:!1},initialize:function(t){this.noneSpatialArr=[],this.elements=[],e.prototype.initialize.call(this,t)},_addListeners:function(){e.prototype._addListeners.call(this),this.map.on("resolutionchanged",this._getZoomChangeLisener())},_removeListeners:function(){this.map.off("resolutionchanged",this._getZoomChangeLisener()),e.prototype._removeListeners.call(this)},_getZoomChangeLisener:function(){if(!this._zoomChangeLisener){var e=this;this._zoomChangeLisener=function(t){e.updateSymbol(t.level)}}return this._zoomChangeLisener},addElements:function(e,r){if(t.isArray(e)){r=r||{};for(var o=this.map.getZoomLevel(),n=this.options.spatialReference,a=r.dataSpatialReference||this.options.dataSpatialReference,s=0,l=e.length;s<l;s++){var c=e[s],h=this._getGeometry(c,a,n);if(h){var p=this._getSymbol(c,o),u=this._getRecordId(c),f=new g2.sfs.Element({id:u,geometry:h,symbol:p.symbol});f._data=c,f._zoomRange=p.zoomRange,f._symbolKey=p.symbolKey,this.elements.push(f),this.layer.add(f)}else this.noneSpatialArr.push(c)}this._onSymbolsUpdated(),this._onElementChanged()}else i.error("dataArr is not an array")},_getGeometry:function(e,t,i){if(!e)return null;var r=e[this.options.geometryField],o=null;try{"string"==typeof r?(r=this.wktReader.read(r).toString(),o=g2.sfs.GeometryFactory.createGeometryFromWkt(r,t)):o=g2.sfs.GeometryFactory.createGeometryFromGeoJson(r,t)}catch(e){}return t&&i&&t!=i&&(o=this.projService.transform(o,i)),o}});return Object.defineProperty(r,"type",{value:31,configurable:!1,writable:!1}),r}.apply(t,r))||(e.exports=o)},function(e,t,i){"use strict";var r,o;r=[i(18),i(0)],void 0===(o=function(e,t){var i=e.extend({options:{geometryField:""},initialize:function(t){e.prototype.initialize.call(this,t),this.layer=new g2.carto.ElementLayer({id:this.options.layerId,name:this.options.layerName,map:this.map}),this._addListeners()},_addListeners:function(){e.prototype._addListeners.call(this),this.map.on("click",this._getMapClickListener())},_removeListeners:function(){this.map.off("click",this._getMapClickListener()),e.prototype._removeListeners.call(this)},_getMapClickListener:function(){if(!this._mapClickListener){var e=this;this._mapClickListener=function(t){var i=e.layer.hitTest(t.screenX,t.screenY);i&&e.fire("click",{id:i.element.id,element:i.element,layer:i.layer})}}return this._mapClickListener},updateStatistics:function(e){e&&this._updateStatistics(e)},_updateStatistics:function(e){if(e){var t=jQuery.extend(!0,{},e.statisticsData),i=e.symbol;"string"==typeof i&&(i=this.symbolConfig[i]),i=jQuery.extend(!0,{},i),this.statisticsData=t,this.layer.clear(!0),this._updateLayer(i),this._onSymbolsUpdated(e),this._onElementChanged()}},setVisible:function(e){this.layer.setVisible(!!e),this._visible=!!e,e?this.invokeCallback("symbolUpdateCallback",{layerId:this.options.layerId,symbols:this.currentSymbols}):this.invokeCallback("symbolUpdateCallback",{layerId:this.options.layerId,symbols:[]})},clear:function(t){this.layer.clear(),this.statisticsData=null,e.prototype.clear.call(this),t||(this._onSymbolsUpdated(),this._onElementChanged())},_updateLayer:function(e){var t,i=e.symbol,r=e.label;for(t in this.statisticsData){var o=this.statisticsData[t],n=this._getGeometry(o,this.options),a=this.getRingTextSymbol(o.value,i,r),s=new g2.sfs.Element({id:t,geometry:n,symbol:a});s._data=o,this.layer.add(s)}},_onSymbolsUpdated:function(e){if(this.currentSymbols=null,e&&this.layer.elements.length>0){var t=this.layer.elements[0];this.currentSymbols=[{title:e.title,symbol:t.symbol,symbolKey:e.key}]}else this.currentSymbols=[];this.invokeCallback("symbolUpdateCallback",{layerId:this.options.layerId,symbols:this.currentSymbols})},getLayer:function(){return this.layer},getElements:function(){return this.layer.elements},_getGeometry:function(e,t){var i=null;if(this.options.geometryField){var r=e[this.options.geometryField];r&&(r instanceof String?(i=g2.sfs.GeometryFactory.createGeometryFromWkt(r)).setSpatialReference(t.spatialReference):(i=g2.sfs.GeometryFactory.createGeometryFromGeoJson(r)).setSpatialReference(t.spatialReference))}else i=new g2.sfs.Point({x:e[t.xField],y:e[t.yField],spatialReference:t.spatialReference});return t.spatialReference&&t.destSpatialReference&&t.spatialReference!=t.destSpatialReference&&(i=this.projService.transform(i,t.destSpatialReference)),i},getRingTextSymbol:function(e,i,r){e+="",r=r||{},(i=i||{}).borderColor&&(i.borderColor=this._getColor(i.borderColor)),i.fillColor&&(i.fillColor=this._getColor(i.fillColor)),r.foreground&&(r.foreground=this._getColor(r.foreground)),r.borderColor&&(r.borderColor=this._getColor(r.borderColor));var o=r.fontSize||15,n=2*o/3,a=t.getEquivalentNum(e,n,n),s={borderColor:new g2.sfs.Color({a:150,r:50,g:175,b:254}),fillColor:new g2.sfs.Color({a:220,r:4,g:131,b:232}),borderThickness:a/2,size:a},l={text:e,fontSize:o,fontWeight:1,offsetX:0,offsetY:0,foreground:new g2.sfs.Color({a:255,r:255,g:255,b:255}),borderColor:new g2.sfs.Color({a:1,r:255,g:255,b:255}),borderThickness:0};jQuery.extend(!0,s,i),jQuery.extend(!0,l,r);var c=new g2.sfs.SimpleMarkerSymbol(s),h=new g2.sfs.TextSymbol(l);return new g2.sfs.CurrencySymbol({markerSymbol:c,textSymbol:h})},destroy:function(){e.prototype.destroy.call(this)}});return Object.defineProperty(i,"type",{value:41,configurable:!1,writable:!1}),i}.apply(t,r))||(e.exports=o)},function(e,t,i){"use strict";var r,o;r=[i(18),i(0)],void 0===(o=function(e,t){var i=e.extend({options:{geometryField:"",onPieClick:"",clickContext:window},initialize:function(t){e.prototype.initialize.call(this,t),this.statisticsDataType={},this.layer=new g2.carto.FeatureLayer({id:this.options.layerId,map:this.map,visible:!1}),this._addListeners()},_addListeners:function(){e.prototype._addListeners.call(this)},_removeListeners:function(){e.prototype._removeListeners.call(this)},updateStatistics:function(e){e&&this._updateStatistics(e)},_updateStatistics:function(e){if(e){var t=jQuery.extend(!0,{},e.statisticsData),i=e.symbol;"string"==typeof i&&(i=this.symbolConfig[i]),i=jQuery.extend(!0,{},i);var r=0;for(var o in t){var n=t[o];if(n){0!=r||this.statisticsData?this._mergeStatisticsData(this.statisticsData,n):this.statisticsData=n;var a=o.split(",");for(var s in a)this.statisticsDataType[a[s]]=!0;r++}}this._updateLayer(i),this._onElementChanged()}},setVisible:function(e){this.renderer&&this.renderer.show(!!e),this._visible=!!e},clear:function(){this.layer.clear(),this.renderer=null,e.prototype.clear.call(this),this._onElementChanged()},_updateLayer:function(e){for(var i=e,r=this,o=new g2.sfs.Fields,n=[],a=[],s=i.fields,l=0,c=s.length;l<c;l++){var h=s[l];if(h&&this.statisticsDataType[h.name]){var p=new g2.sfs.Field({name:h.name,alias:h.alias});o.add(p),n.push(p),a.push(h.color)}}var u=new g2.sfs.Field({name:"districtCode",alias:"政区编码"});o.add(u),this.layer.clear();var f=o.fields.length;if(!(f<1)){var y=0;for(var d in this.statisticsData){var m=this.statisticsData[d];if(m&&m.items){for(var g=m.items,v=[],_=0;_<f-1;_++){var b=g[(o.getField(_)||{}).name];isNaN(b)&&(b=0);var w=new g2.sfs.Value;w.setValue(b),v.push(w)}var S=new g2.sfs.Value;S.setValue(d),v.push(S);var L=new g2.sfs.Feature({fields:o,values:v,geometry:this._getGeometry(m,this.options),objectId:y++});this.layer.add(L)}}if(!(y<1)){var P=new g2.render.PieChart({fields:n,options:{type:1,color:a,name:i.title,labelStyle:i.labelStyle||{color:"#000",fontSize:10}}});this.renderer=new g2.render.ChartRenderer({map:this.map,chartTemplate:P}),this.layer.render(this.renderer),this.setVisible(this._visible),P.onClick=function(e){var i=e.feature,o={id:i.values[i.values.length-1].getValue()};r.fire("click",o),t.isFunction(r.options.onPieClick)&&r.options.onPieClick.call(r.options.clickContext||window,o)}}}},getLayer:function(){return this.layer},getElements:function(){return this.layer.features},_getGeometry:function(e,t){var i=null;if(this.options.geometryField){var r=e[this.options.geometryField];r&&(r instanceof String?(i=g2.sfs.GeometryFactory.createGeometryFromWkt(r)).setSpatialReference(t.spatialReference):(i=g2.sfs.GeometryFactory.createGeometryFromGeoJson(r)).setSpatialReference(t.spatialReference))}else{var o=new g2.sfs.Point({x:parseFloat(e[t.xField]),y:parseFloat(e[t.yField]),spatialReference:t.spatialReference}),n=new g2.sfs.Envelope({minx:o.x-.1,maxx:o.x+.1,miny:o.y-.1,maxy:o.y+.1,spatialReference:t.spatialReference});i=g2.sfs.GeometryFactory.createGeometryFromWkt(n.asWkt())}return t.spatialReference&&t.destSpatialReference&&t.spatialReference!=t.destSpatialReference&&(i=this.projService.transform(i,t.destSpatialReference)),i},destroy:function(){e.prototype.destroy.call(this)}});return Object.defineProperty(i,"type",{value:42,configurable:!1,writable:!1}),i}.apply(t,r))||(e.exports=o)},function(e,t,i){"use strict";var r;void 0===(r=function(){var e=function(e){this.map=e};return e.prototype.createLayer=function(e,t){var i,r=this._getClazzObj()[e],o=t||{};if(o.hasOwnProperty("map")||(o.map=this.map),!r)throw new Error("未定义的图层类型！"+e);return(i=new r(o)).getLayer().layerGroups=o.layerGroups||"add",i},e.prototype.createLayerByClass=function(e,t){var i,r;if(-1!=e.indexOf("lys")?(i=/^((g2)|(G))\.lys\.(.*)$/,r=e+""):(i=/^((g2)|(G))\.carto\.(.*)$/,r=e+""),!i.test(r))throw new Error("错误的图层类名！");var o,n=r.match(i);o=-1!=e.indexOf("lys")?window[n[1]].lys[n[4]]:window[n[1]].carto[n[4]];var a=t||{};a.hasOwnProperty("map")||(a.map=this.map);var s=new o(a);a.attr&&(s.attr=a.attr);var l={opacity:"setOpacity",visible:"setVisible",zIndex:"setZIndex"},c=s instanceof G.lys.BaseLayer?s.getLayer():s;for(var h in l)t.hasOwnProperty(h)&&c[l[h]]&&c[l[h]](t[h]);return s},e.prototype._getClazzObj=function(){if(!this._classObj){var e={};e[G.lys.TYPES.ELEMENT_POINT_LAYER]=G.lys.PointLayer,e[G.lys.TYPES.FEATURE_POINT_LAYER]=G.lys.FeaturePointLayer,e[G.lys.TYPES.ELEMENT_POINT_PIXEL_CLUSTER]=G.lys.PointClusterLayer,e[G.lys.TYPES.ELEMENT_POINT_DUPLICATE]=G.lys.PointDuplicateLayer,e[G.lys.TYPES.ELEMENT_POLYLINE_LAYER]=G.lys.LineLayer,e[G.lys.TYPES.ELEMENT_POLYGON_LAYER]=G.lys.PolygonLayer,e[G.lys.TYPES.PIE_STATISTICS_LAYER]=G.lys.PieStatisticsLayer,e[G.lys.TYPES.RING_STATISTICS_LAYER]=G.lys.RingStatisticsLayer,this._classObj=e}return this._classObj},e}.apply(t,[]))||(e.exports=r)},function(e,t,i){"use strict";var r,o,n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};r=[i(4)],void 0===(o=function(e){function t(t,i){e.setOptions(this,i),this.coords=t,this.options.geometry=this.getGeometry(),g2.sfs.Element.call(this,this.options)}return t.prototype={options:{},constructor:t,getGeometry:function(){var e=Object.prototype.toString;return this.coords instanceof g2.sfs.Point?this.coords:"[object Array]"===e.call(this.coords)?new g2.sfs.Point({x:this.coords[0],y:this.coords[1],spatialReference:this.options.spatialReference}):"[object String]"===e.call(this.coords)&&this.coords.indexOf("point")>-1?g2.sfs.GeometryFactory.createGeometryFromWkt(this.coords):("function"==typeof this.coords||this.coords&&"object"==n(this.coords))&&"Point"==this.coords.type?g2.sfs.GeometryFactory.createGeometryFromGeoJson(this.coords):void console.error("数据类型错误，只支持数组坐标、g2.sfs.Point、geojson、wkt")},envelope:function(){return this.getGeometry().envelope()},toString:function(){return this.getGeometry().asWkt()}},e.inherits(t,g2.sfs.Element),t}.apply(t,r))||(e.exports=o)},function(e,t,i){"use strict";var r,o,n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};r=[i(4)],void 0===(o=function(e){function t(t,i){e.setOptions(this,i),this.coords=t,this.options.geometry=this.getGeometry(),g2.sfs.Element.call(this,this.options)}return t.prototype={options:{},constructor:t,getGeometry:function(){var e=Object.prototype.toString;return this.coords instanceof g2.sfs.Polygon?this.coords:"[object Array]"===e.call(this.coords)?this._areaPolygon(this.coords):"[object String]"===e.call(this.coords)&&this.coords.indexOf("polygon")>-1?g2.sfs.GeometryFactory.createGeometryFromWkt(this.coords):("function"==typeof this.coords||this.coords&&"object"==n(this.coords))&&"Polygon"==this.coords.type?g2.sfs.GeometryFactory.createGeometryFromGeoJson(this.coords):void console.error("数据类型错误，只支持数组坐标、g2.sfs.Polygon、geojson、wkt")},_ring:function(e){var t=new g2.sfs.Ring;return e.map(function(e){var i=e instanceof g2.sfs.Point?e:new g2.sfs.Point({x:e[0],y:e[1]});t.addPoint(i)}),t},_areaPolygon:function(e){var t=new g2.sfs.Polygon;return e&&e[0]&&e[0][0]&&2==e[0][0].length?e.map($.proxy(function(e){t.addGeometry(this._ring(e))},this)):t.addGeometry(this._ring(e)),t},envelope:function(){return this.getGeometry().envelope()},toString:function(){return this.getGeometry().asWkt()}},e.inherits(t,g2.sfs.Element),t}.apply(t,r))||(e.exports=o)},function(e,t,i){var r,o;r=[i(22)],void 0===(o=function(e){var t=function(){};return t.prototype={addhitTest:function(){this._EventHandler||(this._EventHandler=Object.create({}));for(var e=["mousedown","mouseup","mousemove","click","resolutionchanged","dblclick"],t=0;t<e.length;t++){var i=e[t],r=this._EventHandler[i]=$.proxy(this.map_handler(i),this);this.options.g2map.on(i,r)}},removehitTest:function(){for(var e=["mousedown","mouseup","mousemove","click","resolutionchanged","dblclick"],t=0;t<e.length;t++){var i=e[t];this.options.g2map.on(i,this._EventHandler[i])}},map_handler:function(e){return"mousemove"==e?this._map_move:"resolutionchanged"==e?this._map_resolutionchanged:"click"==e?this._map_click:"dblclick"==e?this._map_dblclick:"mousedown"==e||"mouseup"==e?$.proxy(this._map_other,this,e):void 0},_map_move:function(){var e=arguments[0],t=this.hitTest(e.screenX,e.screenY);t&&!this._currentEle&&(this.options.g2map.setCursor("pointer"),this.options.g2map.olddbClickFlag=this.options.g2map.dbClickFlag,this.options.g2map.stopDbClick(),this.fireEvent("mouseover",{element:t.element||t,mapEvent:e})),this._currentEle&&!t&&(this.options.g2map.setCursor("default"),this.options.g2map.resumeDbClick(),this.fireEvent("mouseout",{element:this._currentEle.element||this._currentEle,mapEvent:e})),this.fireEvent("mousemove",{mapEvent:e}),this._currentEle=t},_map_other:function(){var e=arguments[1],t=this.hitTest(e.screenX,e.screenY);if(t){var i=t.element?t.element:t;this.fireEvent(arguments[0],{element:i,mapEvent:e})}},_map_click:function(){clearTimeout(this.TimeFn);var e=arguments[0];this.TimeFn=setTimeout($.proxy(this._timefn_map_click,this,e),300)},_timefn_map_click:function(e){var t=this.hitTest(e.screenX,e.screenY);if(t){var i=t.element?t.element:t;this.fireEvent("click",{element:i,mapEvent:e})}},_map_dblclick:function(){clearTimeout(this.TimeFn);var e=arguments[0],t=this.hitTest(e.screenX,e.screenY);if(t){var i=t.element?t.element:t;this.fireEvent("dblclick",{element:i,mapEvent:e})}},_map_resolutionchanged:function(){var e={newResolution:arguments[0],oldResolution:arguments[1],level:arguments[2]};this.fireEvent("resolutionchanged",{mapEvent:e})}},e.include(t.prototype),t}.apply(t,r))||(e.exports=o)},function(e,t,i){"use strict";var r,o;r=[i(52),i(19),i(56),i(60)],void 0===(o=function(e,t,i,r){G.plot={PlotComponent:e,PlotSyncComponent:i,CollaborativePlotComponent:r},Object.defineProperty(G.plot,"TYPES",{value:t.TYPES_KEYS,configurable:!1,writable:!1})}.apply(t,r))||(e.exports=o)},function(e,t,i){"use strict";var r,o;r=[i(0),i(7),i(2),i(5),i(53),i(54),i(19),i(1),i(55),i(10)],void 0===(o=function(e,t,i,r,o,n,a,s,l,c){var h=a.PATTERNS,p=(a.TYPES,a.TYPES_KEYS),u=s.extend({options:{layerId:"plot-layer",symbols:{text:{type:"TextSymbol",options:{fontFamilyName:"宋体",fontSize:12,foreground:{alpha:255,r:0,g:0,b:255},borderColor:{alpha:1,r:255,g:255,b:255},borderThickness:0}},point:{type:"SimpleMarkerSymbol",options:{style:"circle",borderColor:{alpha:153,r:0,g:0,b:0},fillColor:{alpha:153,r:65,g:105,b:225},borderThickness:2,size:4}},line:{type:"SimpleLineSymbol",options:{color:{alpha:153,r:0,g:0,b:255},width:2,style:5}},polygon:{type:"SimpleFillSymbol",options:{borderColor:{alpha:153,r:0,g:0,b:255},fillColor:{alpha:150,r:19,g:181,b:177},borderThickness:0,opacity:1}},tailedtext:{type:"SimpleMarkerSymbol",options:{borderColor:{alpha:200,r:0,g:0,b:0},fillColor:{alpha:153,r:65,g:105,b:225},borderThickness:1,size:3}}}},initialize:function(e){s.prototype.initialize.call(this,e),this._plotLayer=this.getLayer(),this._initTools(),this._currentTool=null,this.map.on("click",this._mapClickHandler,this),this._freedrawtoolpolygon=new o,this._freedrawtoolpolyline=new n,this._addTailedComponent(this.map)},destroy:function(){this.map.off("click",this._mapClickHandler,this),this.options.tailedLabelComponent.destroy(),s.prototype.destroy.call(this)}});return u.include({plotText:function(e){e=e||{};var t=this._getAlgorithm(p.Point);if(null==t)throw new Error("参数类型错误！");this._plotEditTool.deactivate();var i=this.map.getMap(),r={};r.pattern=h.TEXT,r.type=p.Point,r.algorithm=t,r.symbol=e.symbol,r.text=e.text||"";var o=new g2.geom.Point({spatialReference:i.spatialReference});r.geometry=o,r.callback=e.callback,r.context=e.context,this._constructPlotTool(r).onClick()},plotTailedText:function(e){console.log("ploattailedText添加一次"),e=e||{};var t=this._getAlgorithm(p.TAILEDTEXT);if(null==t)throw new Error("参数类型错误！");this._plotEditTool.deactivate();var i=this.map.getMap(),r={};r.pattern=h.TAILEDTEXT,r.type=p.Point,r.algorithm=t,r.symbol=e.symbol,r.text=e.text||"";var o=new g2.geom.Point({spatialReference:i.spatialReference});r.geometry=o,r.callback=this.addTailedEle,r.context=e.context,this._constructPlotTool(r).onClick()},addTailedEle:function(e,t){t.options.tailedLabelComponent.layer;var i=e.id,r={},o={type:"Point",coordinates:[e.elements[0].geometry.x,e.elements[0].geometry.y]};r.geometry=o,r.label="自定义文本内容",r.id=i;t.options.tailedLabelComponent.add(r);console.log(e);var n=t.options.tailedLabelComponent._getTailedLabel(i);e.tailedLabelAttr=n.serialize(),n.on("updateTailedLabelAttr",function(){var e=this._id;t.getPlotElementById(e).tailedLabelAttr=this.serialize()}),n.on("tailedLabelClick",function(){var e=this._id;t.fire("openTailedLabelEdit",t.getPlotElementById(e))})},plotMarker:function(e){e=e||{};var t=this._getAlgorithm(p.Point);if(null==t)throw new Error("参数类型错误！");this._plotEditTool.deactivate();var i=this.map.getMap(),r={};r.pattern=h.POINT,r.type=p.Point,r.algorithm=t,r.symbol=e.symbol;var o=new g2.geom.Point({spatialReference:i.spatialReference});r.geometry=o,r.callback=e.callback,r.context=e.context,this._constructPlotTool(r).onClick()},plotPolyline:function(e){if((e=e||{}).type==p.FreePolyline){(i={}).symbol=e.symbol,i.callback=e.callback,this.plotFreeDrawPolyline(i)}else{(i={}).map=this.map.getMap(),i.size=e.size;var t=this._getAlgorithm(e.type||p.Polyline,i);if(null==t)throw new Error("参数类型错误！");this._plotEditTool.deactivate();var i,r=this.map.getMap();(i={}).pattern=h.POLYLINE,i.type=e.type||p.Polyline,i.algorithm=t,i.symbol=e.symbol;var o=new g2.geom.Path({spatialReference:r.spatialReference}),n=new g2.geom.Polyline({spatialReference:r.spatialReference});n.addGeometry(o),i.geometry=n,i.callback=e.callback,i.context=e.context,this._constructPlotTool(i).onClick()}},plotPolygon:function(e){if((e=e||{}).type==p.FreePolygon){(i={}).map=this.map.getMap(),i.drawLayer=this._plotLayer,i.pattern=h.POLYGON,i.appevent=c.PLOT_CREATED,i.type=p.Polygon,i.symbol=e.symbol,i.callback=e.callback,i.context=this,this.plotFreeDrawPolygon(i)}else{(i={}).map=this.map.getMap(),i.size=e.size;var t=this._getAlgorithm(e.type||p.Polygon,i);if(null==t)throw new Error("参数类型错误！");this._plotEditTool.deactivate();var i,r=this.map.getMap();(i={}).pattern=h.POLYGON,i.type=e.type||p.Polygon,i.algorithm=t,i.symbol=e.symbol;var o=new g2.sfs.Ring({spatialReference:r.spatialReference}),n=new g2.sfs.Polygon({spatialReference:r.spatialReference});n.addGeometry(o),i.geometry=n,i.callback=e.callback,i.context=e.context,this._constructPlotTool(i).onClick()}},plotComposite:function(t){t=t||{},(r={}).map=this.map.getMap(),r.size=t.size;var i=this._getAlgorithm(t.type,r);if(null==i)throw new Error("参数类型错误！");this._plotEditTool.deactivate();var r,o=this.map.getMap();(r={}).pattern=h.COMPOSITE,r.type=h.POLYGON,r._type=t.type,r.algorithm=i,e.isArray(t.symbol)?r.symbol=t.symbol:e.isObject(t.symbol)&&(r.symbol=[t.symbol,t.symbol]);var n=new g2.sfs.Ring({spatialReference:o.spatialReference}),a=new g2.sfs.Polygon({spatialReference:o.spatialReference});a.addGeometry(n);var s=new g2.sfs.Path({spatialReference:o.spatialReference}),l=new g2.sfs.Polyline({spatialReference:o.spatialReference});l.addGeometry(s),r.geometry=[a,l],r.callback=t.callback,r.context=t.context,this._constructPlotTool(r).onClick()},plotFreeDrawPolyline:function(e){var t=this.map.getMap(),i=this._plotLayer,r=e.callback,o=e.symbol||this.options.symbols.line,n=h.POLYLINE,a=p.Polyline,s=c.PLOT_CREATED,l=e.context,u=new g2.sfs.Path({spatialReference:t.spatialReference}),f=new g2.sfs.Polyline({spatialReference:t.spatialReference});f.addGeometry(u);var y=new g2.sfs.Element({geometry:f,symbol:this._getDefaultSymbol(n,o)});this._freedrawtoolpolyline.onCreate({map:t,spatialRef:t.spatialReference,callBack:r,drawLayer:i,templateElement:y,lineSymbol:o,pattern:n,type:a,appevent:s,context:this,contextx:l}),this._currentTool=this._freedrawtoolpolyline,this._freedrawtoolpolyline.onClick()},plotFreeDrawPolygon:function(e){var t=this.map.getMap(),i=this._plotLayer,r=e.callback,o=e.symbol||this.options.symbols.polygon,n=h.POLYGON,a=p.Polygon,s=c.PLOT_CREATED,l=e.context,u=new g2.geom.Path({spatialReference:t.spatialReference}),f=new g2.geom.Polyline({spatialReference:t.spatialReference});f.addGeometry(u);var y=new g2.ele.Element({geometry:f,symbol:this._getDefaultSymbol(n,o)});this._freedrawtoolpolygon.onCreate({map:t,spatialRef:t.spatialReference,callBack:r,drawLayer:i,templateElement:y,fillSymbol:o,pattern:n,type:a,appevent:s,context:this,contextx:l}),this._currentTool=this._freedrawtoolpolygon,this._freedrawtoolpolygon.onClick()},plot:function(t){var i={};i[h.TEXT]=this.plotText,i[h.TAILEDTEXT]=this.plotTailedText,i[h.POINT]=this.plotMarker,i[h.POLYLINE]=this.plotPolyline,i[h.POLYGON]=this.plotPolygon,i[h.COMPOSITE]=this.plotComposite,t=t||{};var r=this._getAlgorithm(t.type);if(null==r)throw new Error("参数类型错误！");var o=i[r._type];if(e.isFunction(o)){var n=jQuery.extend(!0,{},t);o.call(this,n)}}}),u.include({onPlotClick:function(e,t){this._plotClickObj={callback:e,context:t}},getLayer:function(){if(!this._plotLayer){var e=this.options.layerId,i=this.map.getMap(),r=t.getLayerById(this.map,e);r||(r=new g2.carto.ElementLayer({map:i,id:e}),i.addLayer(r)),this._plotLayer=r}return this._plotLayer},getPlotElements:function(){return this._plotLayer.elements},getPlotElementById:function(e){return this._plotLayer.find(e)||null},cancelPlot:function(){this._cancelPlot(),this._fireEvent(c.PLOT_CANCELED)},enableEdit:function(e){!0===e?(this._plotEditTool._enabled_=!0,this._resetToolState()):(this._plotEditTool._enabled_=!1,this._resetToolState())},finishPlot:function(){if(null==this._currentTool||1==this._currentTool.isEndDraw||null==this._lastControlPoint)throw new Error("当前无未完成的标绘！");this._currentTool.endDraw(this._lastControlPoint)},getSelectedElements:function(){return this._plotEditTool.selectionSet.graphiclist},selectPlotElement:function(e){var t=this.getPlotElementById(e);if(t)try{var r=t.elements[0].geometry.asWkt(),o=r.replace(/[^\d^\.^\,^\ ]/g,""),n=this.map.getMap(),a=o.split(",")[0].split(" "),s=parseFloat(a[0]),l=parseFloat(a[1]),c=n.getPixelFromCoordinate([s,l]);this._plotEditTool.onMouseDown(null,null,c[0],c[1])}catch(e){throw new Error(e)}else i.warn("标绘元素不存在！")},updatePlotElement:function(t){t=t||{};var o=[],n=null,a=this._plotLayer.find(t.id);if(a){if("composite"==a.kind){var s=a.elements[1],l=a.elements[0],h=t.symbol,p=t.plotProperty;if(n=new g2.sfs.Attribute({name:"data",value:p}),o.push(n),l.attributeSet.attributes=o,e.isObject(h)){var u=r.object2Symbol(h.type,h.options);return l.symbol=u,s.symbol.color=u.borderColor,s.symbol.width=u.borderThickness,this._plotLayer.update(a,!0),this._fireEvent(c.PLOT_UPDATED,{element:a}),!0}return!1}if("tailedtext"==a.kind){var f=a.elements[a.elements.length-1];h=t.symbol;if(n=new g2.sfs.Attribute({name:"data",value:p}),o.push(n),f.attributeSet.attributes=o,e.isObject(h)){var y=t.symbol.options;this.options.tailedLabelComponent.update(t.id,y.domHtml,y);var d=this.options.tailedLabelComponent._getTailedLabel(t.id);return a.tailedLabelAttr=d.serialize(),this._fireEvent(c.PLOT_UPDATED,{element:a}),!0}return!1}f=a.elements[a.elements.length-1],h=t.symbol,p=t.plotProperty;if(n=new g2.sfs.Attribute({name:"data",value:p}),o.push(n),f.attributeSet.attributes=o,e.isObject(h)){u=r.object2Symbol(h.type,h.options);return f.symbol=u,this._plotLayer.update(a,!0),this._fireEvent(c.PLOT_UPDATED,{element:a}),!0}return!1}i.warn("元素不存在，id="+t.id)},removePlotElement:function(e){var t=this._removePlotElement(e);return this._removeTailedText(e),null!=t&&this._fireEvent(c.PLOT_DELETE,{elements:[t]}),t},removePlotElements:function(e){for(var t=(e=e||"").split(","),i=[],r=0,o=t.length;r<o;r++){var n=t[r],a=this.removePlotElement(n);null!=a&&i.push(a)}return this._fireEvent(c.PLOT_DELETE,{elements:i}),i},clearPlotElements:function(){var e=this._plotLayer.elements;return this._plotLayer.clear(),this.options.tailedLabelComponent&&this.options.tailedLabelComponent.removeAll(),this._fireEvent(c.PLOT_DELETE,{elements:e}),e},getPlotSchema:function(t){for(var i=(t=t||{}).id||e.newUUID32(),r=new g2.plot.PlotSchema({id:i,name:t.name||"",userId:t.groupId}),o=[],n=0,a=(o=e.isArray(t.elements)?t.elements:this._plotLayer.elements).length;n<a;n++){var s=o[n];if(s){var l=s.copy();if(l.unReset(),!0===t.reserveId&&(l.id=s.id),l._belong_schema=i,"tailedtext"==l.kind){var c=this.options.tailedLabelComponent._getTailedLabel(s.id);c._id=l.id,c.options.id=l.id,l.tailedLabelAttr=c.serialize()}r.addElement(l)}}return JSON.stringify(r)},loadPlotSchema:function(t){var i;if(t=t||{},e.isString(t.schema))try{var r=JSON.parse(t.schema);i=(new g2.lang.Deserializer).createJsInstance(r)}catch(e){throw new Error("参数类型错误！")}else i=t.schema;for(var o=0;o<i.getCount();++o){var n=i.getElement(o);n.reset(),this._plotLayer.contains(n.id)||(this._plotLayer.add(n),"tailedtext"==n.kind&&this._loadTailedlabel(n),n._schemaId=i.id)}},toggleElement:function(e,t){this.options.tailedLabelComponent._getTailedLabel(e).toggleVisible(t);var i=this.options.tailedLabelComponent.layer,r=i.find(e);i.showElement(r,t)}}),l.extend(u),u}.apply(t,r))||(e.exports=o)},function(e,t,i){"use strict";var r;void 0===(r=function(){var e="NoopTool",t=function(e){var t=e||{};t.cursor=t.cursor||"crosshair",g2.interact.Tool.call(this,t||{}),this.drawElement=null,this.geoBuilder=new g2.draw.GeometryBuilder,this.isEndDraw=!0,this.geoLinePolygon=null};return g2.core.ClassUtil.extend2(t,g2.interact.Tool),t.prototype.onClick=function(e){t.prototype.uber.onClick.call(this,e),this.pushNum=0},t.prototype.onCreate=function(e){t.prototype.uber.onCreate(e),this.map=e.map,this.srid=e.spatialRef,this.callBack=e.callBack,this.templateElement=e.templateElement,this.drawLayer=e.drawLayer,this.fillSymbol=e.fillSymbol,this.pattern=e.pattern,this.type=e.type,this.appevent=e.appevent,this.context=e.context,this.contextx=e.contextx},t.prototype.onMouseClick=function(e,t,i,r,o,n,a){if(this.templateElement&&this.isEndDraw){this.map.stopDbClick(),this.isEndDraw=!1;var s=new g2.sfs.Point({x:o,y:n,spatialReference:this.srid});this.drawElement=this.templateElement.copy();var l=this.drawElement.geometry;this.geoBuilder.build(l,s,1,this.pushNum),this.drawLayer.add(this.drawElement)}},t.prototype.onMouseMove=function(e,t,i,r,o,n,a){if(!this.isEndDraw){var s=new g2.sfs.Point({x:o,y:n});this.context._lastControlPoint=s;var l=this.drawElement.geometry;this.geoBuilder.build(l,s,2,this.pushNum),this.drawLayer.update(this.drawElement)}},t.prototype.onDblclick=function(t){if(!this.isEndDraw){this.isEndDraw=!0;var i=this.drawElement.geometry;this.geoBuilder.build(i,null,4,this.pushNum),this.geoLinePolygon=null,this.lintToPolygon(this,i);var r={};r.geometry=this.geoLinePolygon,r.symbol=this.fillSymbol,r.name="freePlot";var o=this.context._constructPlotElement(this.pattern,r);this.drawLayer.remove(this.drawElement),this.drawLayer.add(o),this.pushNum=0,this.map.resumeDbClick(),this.drawElement=null;var n=new g2.gdm.CommandManager,a=new g2.gdm.CommandNotify({manager:n}),s=new g2.interact.NoopTool({id:e,cursor:"pointer"});n.add(s);var l=new g2.carto.GraphicSelectionSet;n.onCreate({map:this.map,commandNotify:a,graphicSelectionSet:l,spatialRef:{srid:this.srid}});var c=(new jsts.io.GeoJSONReader).read(this.geoLinePolygon.asGeoJson());G.utils.CommonUtil.isFunction(this.callBack)&&(c.isValid()?this.callBack.call(this.contextx,this.geoLinePolygon.asGeoJson()):this.callBack.call(this.contextx,null)),a.activeCommand(e),this.context._fireEvent(this.appevent,{type:this.type,element:o}),this.context._cancelPlot(),this.context._resetToolState()}},t.prototype.endDraw=function(){this.onDblclick()},t.prototype.lintToPolygon=function(e,t){var i="POLYGON((";if(1==t.paths.length){var r=t.paths[0].points;r.push(r[0]);var o=r.length,n=[];if(o>200){var a=o-200;if(o<=400)for(var s=Math.floor(o/a),l=1,c=0;c<o;c++)c==l*s?(l++,0!=c&&1!=c&&c!=o-1&&c!=o-2||n.push(r[c])):n.push(r[c]);else for(s=Math.ceil(o/200),l=1,c=0;c<o;c++)c==l*s?(l++,n.push(r[c])):0!=c&&1!=c&&c!=o-1&&c!=o-2||n.push(r[c]);o=(r=n).length}for(var h=0;h<r.length-1;h++)i=i+r[h].x.toFixed(5)+" "+r[h].y.toFixed(5)+",";i=i+r[o-1].x.toFixed(5)+" "+r[o-1].y.toFixed(5)}i+="))",e.geoLinePolygon=new g2.sfs.GeometryFormatter.fromWKT(i,e.srid)},t}.apply(t,[]))||(e.exports=r)},function(e,t,i){"use strict";var r;void 0===(r=function(){var e="NoopTool",t=function(e){var t=e||{};t.cursor=t.cursor||"crosshair",g2.interact.Tool.call(this,t||{}),this.drawElement=null,this.geoBuilder=new g2.draw.GeometryBuilder,this.isEndDraw=!0,this.geoLinePolyline=null};return g2.core.ClassUtil.extend2(t,g2.interact.Tool),t.prototype.onClick=function(e){t.prototype.uber.onClick.call(this,e),this.pushNum=0},t.prototype.onCreate=function(e){t.prototype.uber.onCreate(e),this.map=e.map,this.srid=e.spatialRef,this.callBack=e.callBack,this.templateElement=e.templateElement,this.drawLayer=e.drawLayer,this.lineSymbol=e.lineSymbol,this.pattern=e.pattern,this.type=e.type,this.appevent=e.appevent,this.context=e.context,this.contextx=e.contextx},t.prototype.onMouseClick=function(e,t,i,r,o,n,a){if(this.templateElement&&this.isEndDraw){this.map.stopDbClick(),this.isEndDraw=!1;var s=new g2.sfs.Point({x:o,y:n,spatialReference:this.srid});this.drawElement=this.templateElement.copy();var l=this.drawElement.geometry;this.geoBuilder.build(l,s,1,this.pushNum),this.drawLayer.add(this.drawElement)}},t.prototype.onMouseMove=function(e,t,i,r,o,n,a){if(!this.isEndDraw){var s=new g2.sfs.Point({x:o,y:n});this.context._lastControlPoint=s;var l=this.drawElement.geometry;this.geoBuilder.build(l,s,2,this.pushNum),this.drawLayer.update(this.drawElement)}},t.prototype.onDblclick=function(t){if(!this.isEndDraw){this.isEndDraw=!0;var i=this.drawElement.geometry;this.geoBuilder.build(i,null,4,this.pushNum),this.geoLinePolyline=null,this.lintToPolyline(this,i);var r={};r.geometry=this.geoLinePolyline,r.symbol=this.lineSymbol,r.name="freePlot";var o=this.context._constructPlotElement(this.pattern,r);this.drawLayer.remove(this.drawElement),this.drawLayer.add(o),this.pushNum=0,this.map.resumeDbClick(),this.drawElement=null;var n=new g2.gdm.CommandManager,a=new g2.gdm.CommandNotify({manager:n}),s=new g2.interact.NoopTool({id:e,cursor:"pointer"});n.add(s);var l=new g2.carto.GraphicSelectionSet;n.onCreate({map:this.map,commandNotify:a,graphicSelectionSet:l,spatialRef:{srid:this.srid}});var c=(new jsts.io.GeoJSONReader).read(this.geoLinePolyline.asGeoJson());G.utils.CommonUtil.isFunction(this.callBack)&&(c.isValid()?this.callBack.call(this.contextx,this.geoLinePolyline.asGeoJson()):this.callBack.call(this.contextx,null)),a.activeCommand(e),this.context._fireEvent(this.appevent,{type:this.type,element:o}),this.context._cancelPlot(),this.context._resetToolState()}},t.prototype.endDraw=function(){this.onDblclick()},t.prototype.lintToPolyline=function(e,t){var i="linestring(";if(1==t.paths.length){var r=t.paths[0].points,o=r.length,n=[];if(o>200){var a=o-200;if(o<=400)for(var s=Math.floor(o/a),l=1,c=0;c<o;c++)c==l*s?(l++,0!=c&&c!=o-1||n.push(r[c])):n.push(r[c]);else for(s=Math.ceil(o/200),l=1,c=0;c<o;c++)c==l*s?(l++,n.push(r[c])):0!=c&&c!=o-1||n.push(r[c]);o=(r=n).length}for(var h=0;h<r.length-1;h++)i=i+r[h].x.toFixed(5)+" "+r[h].y.toFixed(5)+",";i=i+r[o-1].x.toFixed(5)+" "+r[o-1].y.toFixed(5)}i+=")",e.geoLinePolyline=new g2.sfs.GeometryFormatter.fromWKT(i,e.srid)},t}.apply(t,[]))||(e.exports=r)},function(e,t,i){"use strict";var r,o;r=[i(0),i(7),i(2),i(5),i(19),i(10)],void 0===(o=function(e,t,i,r,o,n){return{extend:function(a){var s=o.PATTERNS,l=o.TYPES,c=o.TYPES_KEYS;a.include({drawMarker:function(e){if(!(e&&e.geometry instanceof g2.sfs.Point))throw new Error("参数错误！");var i=this._constructPlotElement(s.POINT,e),r=t.getLayerById(this.map,e.layerId);(r=r||this._plotLayer).add(i),this._fireEvent(n.PLOT_CREATED,{type:c.Point,element:i}),this._resetToolState()},drawLine:function(e){if(!e)throw new Error("参数错误！");var i=this._constructPlotElement(s.POLYLINE,e),r=t.getLayerById(this.map,e.layerId);(r=r||this._plotLayer).add(i),this._fireEvent(n.PLOT_CREATED,{type:c.Polyline,element:i}),this._resetToolState()},drawPolygon:function(e){if(!e||!(e.geometry instanceof g2.sfs.Polygon||e.geometry instanceof g2.sfs.MultiPolygon))throw new Error("参数错误！");var i=this._constructPlotElement(s.POLYGON,e),r=t.getLayerById(this.map,e.layerId);(r=r||this._plotLayer).add(i),this._fireEvent(n.PLOT_CREATED,{type:c.Polygon,element:i}),this._resetToolState()},_constructPlotElement:function(t,r){var o=this._getDefaultSymbol(t,r.symbol),n="",a={};a[s.POINT]=c.Point,a[s.POLYLINE]=c.Polyline,a[s.POLYGON]=c.Polygon;var l=this._getAlgorithm(a[t]),h=new g2.sfs.AttributeSet,p=e.newUUID();r.hasOwnProperty("name")&&(n=r.name+"_"+p.split("-")[0]);var u=new g2.sfs.PlotElement({id:r.id||p,kind:t,name:n,algorithm:l,attributeSet:h}),f=new g2.sfs.Element({id:r.id||p,kind:t,geometry:r.geometry,symbol:o,name:n,attributeSet:h});u.add(f),u.reset();try{this._handleControlPoint(u)}catch(e){i.error(e)}return u},_handleControlPoint:function(e){var t=e.elements[0].geometry,i=e.plot,r={point:{regex:/^(.*Point),http\:\/\/www.Gs.com$/,handler:function(e,t){t.controlPoints=[e],t.update([e])}},polyline:{regex:/^(.*Polyline),http\:\/\/www.Gs.com$/,handler:function(e,t){var i=e.paths||[];if(1==i.length){var r=i[0];t.controlPoints=t.controlPoints.concat(r.points),t.update([e])}}},polygon:{regex:/^(.*Polygon),http\:\/\/www.Gs.com$/,handler:function(e,t){var i=e.rings||[];if(1==i.length){var r=i[0];t.controlPoints=t.controlPoints.concat(r.points),t.update([e])}}}};for(var o in r)if(r[o].regex.test(t.$type)){r[o].handler(t,i);break}}}),a.include({_initTools:function(){var e=this.map.getMap(),t=new g2.gdm.CommandManager,i=new g2.gdm.CommandNotify({manager:t});this._commandMgr=t,this._commandNotify=i;var r=new g2.interact.NoopTool({id:"NoopTool",cursor:this.options.cursor}),o=new g2.plot.PlotEditTool({id:"PlotEdit",layer:this._plotLayer});t.add(r),t.add(o),this._plotEditTool=o;var a=this;this._plotEditTool.endEdit=this._plotEditTool.endEdit.before(function(){var e=a.getSelectedElements();e.length>0&&a._fireEvent(n.PLOT_UPDATED,{element:e[0].element})}),this._nooptool=r;var s=new g2.carto.GraphicSelectionSet;this._commandHook={map:e,commandNotify:i,graphicSelectionSet:s,spatialRef:{srid:e.spatialReference}},t.onCreate(this._commandHook)},_removePlotElement:function(e){var t=this._plotLayer.find(e);return t?(this._plotLayer.remove(t),t):(i.warn("移除的元素不存在，id="+e),null)},_getAlgorithm:function(t,i){if(e.isString(t)){t=t.replace("Algorithm","");var r=l[t]||null,o=null,n=g2.plot[r.algorithm];return r&&e.isFunction(n)&&((o=new n(i?{size:i.size,map:i.map}:{}))._type=r.type),o}return null},_getDefaultSymbol:function(t,i){return e.isObject(i)||(i=this.options.symbols[t]),r.object2Symbol(i.type,i.options)},_constructPlotTool:function(t){if(!t)throw new Error("参数类型错误！");this.map.getMap();var i=this,r=t.algorithm||this._getAlgorithm(t.pattern),o="";t.pattern==s.TEXT?o="text":t.pattern==s.POINT?o="point":t.pattern==s.POLYLINE?o="polyline":t.pattern==s.POLYGON?o="polygon":t.pattern==s.COMPOSITE?o="composite":t.pattern==s.TAILEDTEXT&&(o="tailedtext");var a=t.geometry,l=null,c=[];if(e.isArray(a)){var h=t.symbol||[];l=new g2.sfs.Element({geometry:a[1],symbol:this._getDefaultSymbol(s.POLYLINE,h[1])}),c=[new g2.sfs.Element({geometry:a[0],symbol:this._getDefaultSymbol(s.POLYGON,h[0])}),l]}else{var p=this._getDefaultSymbol(t.pattern,t.symbol);t.text&&(p.text=t.text),c=[l=new g2.sfs.Element({geometry:a,symbol:p})]}var u=new g2.plot.PlotTool({id:e.newUUID32(),drawTemplate:l,algorithm:r,elements:c,name:o,plotLayer:this._plotLayer});return u.onCreate(this._commandHook),u.onMouseUp=function(){(function(e,t,i,r,o,n,a){this._lastControlPoint=new g2.sfs.Point({x:o,y:n})}).apply(i,arguments)},u.onEndDraw=function(r){(function(t,i){this._cancelPlot(),e.isFunction(i.callback)&&i.callback.call(i.context,t,this),this._fireEvent(n.PLOT_CREATED,{type:i.type,element:t})}).call(i,r,t)},this._currentTool=u,u},_loadTailedlabel:function(e){var t=JSON.parse(e.tailedLabelAttr),i=this,r=this.options.tailedLabelComponent.layer,o={},n={type:"Point",coordinates:[e.elements[0].geometry.x,e.elements[0].geometry.y]};o.geometry=n,o.label=t.domHtml,o.id=e.id,o.symbol=t.symbol,o.domClassName=t.domClassName,o.tailLength=t.tailLength,o.tailAngle=t.tailAngle,o.showArrow=t.showArrow,o.arrowAngle=t.arrowAngle,o.arrowScale=t.arrowScale,o.domStyle=t.domStyle,o.lineColor,o.lineWidth,this.options.tailedLabelComponent.add(o),G.utils.RenderUtil.geoinfoToElement(n,e.elements[0].symbol,{id:e.id,layer:r}).labelId=e.id;var a=this.options.tailedLabelComponent._getTailedLabel(e.id);a.on("tailedLabelClick",function(){var t=e.id;i.fire("openTailedLabelEdit",i.getPlotElementById(t))}),e.tailedLabelAttr=a.serialize()},_cancelPlot:function(){this.map.getMap();try{this._resetToolState(),this._currentTool.deactivate(),this._currentTool=null}catch(e){}this._lastControlPoint=null},_mapClickHandler:function(t){if(!this._currentTool){var i=t.screenX,r=t.screenY,o=this._plotLayer.hitTestList(i,r).graphiclist,a=null;if(o.length>0&&(a=o[o.length-1].element.parent),this._plotClickObj){var s=this._plotClickObj.callback;e.isFunction(s)&&s.call(this._plotLayer.context,a)}this.fire(n.PLOT_CLICKED,{element:a})}},_removeTailedText:function(e){this.options.tailedLabelComponent.layer,this.options.tailedLabelComponent.remove(e)},_resetToolState:function(){this._plotEditTool._enabled_?this._plotEditTool.onClick():(this._plotEditTool.deactivate(),this._nooptool.onClick())},_fireEvent:function(e,t){this.fire(e,t),this.map.fire(e,t)},_addTailedComponent:function(e){var t=new G.components.TailedLabelComponent({map:e,layerId:"tailed-marker-layer",symbol:{type:"SimpleLineSymbol",options:{color:{alpha:250,r:183,g:79,b:79},style:5,width:1}},tailLength:80,tailAlign:"auto",domClassName:"emap-tail-label",domStyle:{background:"#b74f4f",padding:"10px","font-size":"20px",border:"1px solid #a61c00",color:"#ffffff",opacity:1},tailAngle:30,showArrow:!1});this.options.tailedLabelComponent=t;var i=new g2.carto.ElementLayer({id:"pointLayer",name:"选点图层",map:e});e.addLayer(i),this.options.tailedLabelComponent.layer=i}})}}}.apply(t,r))||(e.exports=o)},function(e,t,i){"use strict";var r,o;r=[i(57),i(58),i(1)],void 0===(o=function(e,t,i){var r=i.extend({options:{title:"标绘同步接口类"},initialize:function(r){i.prototype.initialize.call(this,r),this._getDifferentData=new e(r),this._analysisDifferentData=new t(r)},destroy:function(){try{this._getDifferentData.destroy()}catch(e){}try{this._analysisDifferentData.destroy()}catch(e){}i.prototype.destroy.call(this)}});return r.include({viewSyncGetData:function(){return this._getDifferentData.getMapView()},plotSyncGetData:function(){return this._getDifferentData.getPlotData()},dataSyncGetData:function(){return this._getDifferentData.getSyncData()}}),r.include({viewSyncShowData:function(e){var t=!1;if(e&&e.data){try{this._analysisDifferentData.analysisMapView(e.data),t=!0}catch(e){e.message,t=!1}}return t}}),r.include({dataSyncShowData:function(e){var t={};if(e)try{t=this._analysisDifferentData.analysisSyncData(e)}catch(e){t.msg=e.message}return t},dataSyncClearData:function(e){var t=!1;try{if(e){var i=e.memberId||e.userId;this._analysisDifferentData.clearSpecifyOrAllData(i)}else this._analysisDifferentData.clearSpecifyOrAllData();t=!0}catch(e){e.message,t=!1}return t},dataSyncSetVisiblity:function(e){var t=!1;try{if(e){var i=e.memberId||e.userId,r=e.visible||!0;this._analysisDifferentData.visibleSpecifyOrAllData(i,r),t=!0}}catch(e){e.message,t=!1}return t},querySyncDataById:function(e){var t=!1;try{e&&(this._analysisDifferentData.querySyncDataById(e),t=!0)}catch(e){t=!1}return t}}),r.include({plotSyncShowData:function(e){var t={};if(e)try{t=this._analysisDifferentData.analysisSyncPlot(e)}catch(e){t.msg=e.message}return t},plotSyncClearData:function(e){var t=!1;try{if(e){var i=e.memberId||e.userId;this._analysisDifferentData.clearSpecifyOrAllPlot(i)}else this._analysisDifferentData.clearSpecifyOrAllPlot();t=!0}catch(e){e.message,t=!1}return t},plotSyncSetVisiblity:function(e){var t=!1;try{if(e){var i=e.memberId||e.userId,r=e.visible||!0;this._analysisDifferentData.visibleSpecifyOrAllPlot(i,r),t=!0}}catch(e){e.message,t=!1}return t},queryPlotDataById:function(e){var t=!1;try{e&&(this._analysisDifferentData.queryPlotDataById(e),t=!0)}catch(e){t=!1}return t}}),r}.apply(t,r))||(e.exports=o)},function(e,t,i){"use strict";var r,o;r=[i(1)],void 0===(o=function(e){var t=e.extend({options:{title:"获取不同数据的类"},initialize:function(t){e.prototype.initialize.call(this,t),this.layreIds={dataLayer:[],plotLayer:[]},this._matchingLayer=t.matchingLayer},destroy:function(){e.prototype.destroy.call(this)},_initLayerId:function(e){var t=this.map.getMap().getLayers();if(t.length>0)for(var i=0;i<t.length;i++){for(var r=0;r<e.dataLayer.length;r++)e.dataLayer[r].test(t[i].id)&&this.layreIds.dataLayer.push(t[i].id);for(r=0;r<e.plotLayer.length;r++)e.plotLayer[r].test(t[i].id)&&this.layreIds.plotLayer.push(t[i].id)}}});return t.include({getMapView:function(){var e={};return e.center=this.map.getMap().getCenter(),e.zoomLevel=this.map.getMap().getZoomLevel(),e}}),t.include({getSyncData:function(){return this._initLayerId(this._matchingLayer),this._getAllLayerData()},_getAllLayerData:function(){var e=[];this.layreIds.dataLayer&&(e=this.layreIds.dataLayer);var t={};if(e&&e.length>0)for(var i=0;i<e.length;i++){var r=G.utils.LayerUtil.getLayerById(this.map.getMap(),e[i]);if(r){var o=[],n=this._getLayerElements(r);this._serializeElement(n,o),t[e[i]]=o}}return t}}),t.include({getPlotData:function(){return this._initLayerId(this._matchingLayer),this._getPoltData()},_getPoltData:function(){var e={},t=[];if(this.layreIds.plotLayer&&(t=this.layreIds.plotLayer),t&&t.length>0)for(var i=new g2.plot.PlotSchema({id:(new Date).toString(),name:"标绘数据"}),r=0;r<t.length;r++){var o=this.map.getMap().layers;if(o.length>0)for(var n=0;n<o.length;n++)if(t[r]==o[n].id){var a=this._getLayerElements(o[n]);this._serializeElement(a,i),e[t[r]]=i}}return e}}),t.include({_getLayerElements:function(e){var t=[];if(e instanceof g2.carto.GroupLayer)for(var i=e.groupLayers,r=0,o=i.length;r<o;r++){var n=i[r];util._getLayerElements(n,arr)}else e instanceof g2.carto.FeatureLayer||(e instanceof g2.carto.ElementLayer?t=e.elements:e instanceof g2.carto.ClusterLayer&&(t=e.elements));return t},_serializeElement:function(e,t){for(var i=0;i<e.length;i++)if(e[i]instanceof g2.sfs.Element){var r={},o=e[i].geometry;r.geom=o.asWkt(),r.srid=o.spatialReference,r.symbol=e[i].symbol,r.$type=e[i].$type,t.push(r)}else if(e[i]instanceof g2.sfs.PlotElement){var n=e[i];if(n){var a=n.copy();a.unReset(),a.id=n.id,t.addElement(a)}}return t}}),t}.apply(t,r))||(e.exports=o)},function(e,t,i){"use strict";var r,o;r=[i(59),i(1)],void 0===(o=function(e,t){var i=t.extend({options:{title:"解析不同数据的类"},initialize:function(i){t.prototype.initialize.call(this,i),this._dataDisplayOnMap=new e(i),this._deserializer=new g2.core.Deserializer,this.layreIds={dataLayer:[],plotLayer:[]},i.matchingLayer&&this._initLayerId(i.matchingLayer)},destroy:function(){this._dataDisplayOnMap.destroy(),t.prototype.destroy.call(this)},_initLayerId:function(e){var t=this.map.getMap().getLayers();if(t.length>0)for(var i=0;i<t.length;i++){for(var r=0;r<e.dataLayer.length;r++)e.dataLayer[r].test(t[i].id)&&this.layreIds.dataLayer.push(t[i].id);for(r=0;r<e.plotLayer.length;r++)e.plotLayer[r].test(t[i].id)&&this.layreIds.plotLayer.push(t[i].id)}}});return i.include({analysisMapView:function(e){var t="";if(e.center&&e.zoomLevel){var i=new g2.sfs.Point({x:e.center[0],y:e.center[1],spatialReference:this.map.spatialReference});this.map.getMap().setCenter(i),this.map.getMap().zoomTo(e.zoomLevel),t="视野同步成功!"}else t="视野同步失败!center="+e.center+",zoomLevel="+e.zoomLevel;return t}}),i.include({analysisSyncData:function(e){var t="",i="",r=e.data,o=e.memberId||e.userId,n=[],a={};if(o&&r){var s=[];for(var l in r)for(var c=0;c<r[l].length;c++){var h=this._deserializeElement(r[l][c]);s.push(h)}a={memberId:o,data:n=n.concat(s)};try{i=this._dataDisplayOnMap.showSyncData(a)}catch(e){}t="数据解析成功!"}else t="数据解析失败!成员标识或者数据不全";return{msg:t,dataId:i}},clearSpecifyOrAllData:function(e){return this._dataDisplayOnMap.clearSpecifyOrAllData(e),e?e+"清除数据成功":"全部数据清除成功"},visibleSpecifyOrAllData:function(e,t){return this._dataDisplayOnMap.visibleSpecifyOrAllData(e,t),e?e+"显隐成功":"全部显隐成功"},querySyncDataById:function(e){this._dataDisplayOnMap.querySyncDataById(e)}}),i.include({analysisSyncPlot:function(e){var t="",i="",r=[],o=e.memberId||e.userId,n=e.data,a={};if(o&&n){var s=[];for(var l in n){s=this._deserializePlotElement(n[l]);r=r.concat(s)}a={memberId:o,data:r};try{i=this._dataDisplayOnMap.showSyncPlot(a)}catch(e){}t="标绘数据解析成功!"}else t="标绘数据解析失败!+成员标识或者数据不全";return{msg:t,dataId:i}},clearSpecifyOrAllPlot:function(e){return this._dataDisplayOnMap.clearSpecifyOrAllPlot(e),e?e+"清除标绘成功":"全部标绘清除成功"},visibleSpecifyOrAllPlot:function(e,t){return this._dataDisplayOnMap.visibleSpecifyOrAllPlot(e,t),e?e+"显隐成功":"全部显隐成功"},queryPlotDataById:function(e){this._dataDisplayOnMap.queryPlotDataById(e)}}),i.include({_deserializePlotElement:function(e){var t=[],i=this._deserializer.createJsInstance(e);if(i)for(var r=0;r<i.getCount();r++){var o=i.getElement(r);o.reset(),t.push(o)}return t},_deserializeElement:function(e){var t=null;if(e){var i=e.geom;if(i){var r=g2.sfs.GeometryFactory.createGeometryFromWkt(i);r.spatialReference=e.srid;var o=this._deserializeSymbol(e.symbol);t=new g2.sfs.Element({geometry:r,symbol:o})}}return t},_deserializeSymbol:function(e){var t=this;if(!e)return null;var i=null;switch(/(.*),.*/.exec(e.$type)[1]){case"PictureMarkerSymbol":n("width,height,opacity,offsetX,offsetY,rotation",e,r={}),a("source",e,r),i=new g2.sfs.PictureMarkerSymbol(r);break;case"SimpleMarkerSymbol":s("fillColor,borderColor",e,r={}),n("size,offsetX,offsetY",e,r),a("style",e,r),i=new g2.sfs.SimpleMarkerSymbol(r);break;case"TextSymbol":n("fontSize,rotation,borderThickness,offsetX,offsetY",e,r={}),s("foreground,borderColor",e,r),a("text,fontFamilyName,fontWeight,textAlign",e,r),i=new g2.sfs.TextSymbol(r);break;case"SimpleLineSymbol":s("color",e,r={}),n("width,style",e,r),i=new g2.sfs.SimpleLineSymbol(r);break;case"SimpleFillSymbol":s("fillColor,borderColor",e,r={}),n("borderThickness,opacity",e,r),i=new g2.sfs.SimpleFillSymbol(r);break;case"CurrencySymbol":var r={},o={};o.fillSymbol=this.deserializeSymbol(e.fillSymbol),o.textSymbol=this.deserializeSymbol(e.textSymbol),o.markerSymbol=this.deserializeSymbol(e.markerSymbol),a("fillSymbol,textSymbol,markerSymbol",o,r),i=new g2.sfs.CurrencySymbol(r)}return i;function n(e,t,i){for(var r=e.split(","),o=0,n=r.length;o<n;o++){var a=r[o];a&&(isNaN(t[a])||(i[a]=parseFloat(t[a])))}}function a(e,t,i){for(var r=e.split(","),o=0,n=r.length;o<n;o++){var a=r[o];a&&t[a]&&(i[a]=t[a])}}function s(e,i,r){for(var o=e.split(","),n=0,a=o.length;n<a;n++){var s=o[n];if(s){var l=t._deserializeColor(i[s]);l&&(r[s]=l)}}}},_deserializeColor:function(e){var t=new g2.sfs.Color;return e&&(t.a=e.a,t.r=e.r,t.g=e.g,t.b=e.b),t}}),i}.apply(t,r))||(e.exports=o)},function(e,t,i){"use strict";var r,o;r=[i(1)],void 0===(o=function(e){var t=e.extend({options:{title:"把数据展示到地图上"},initialize:function(t){e.prototype.initialize.call(this,t),this._initLayersGroup(),this._plotAndDataObj={plotObj:{},dataObj:{}},this.commandManager=new g2.gdm.CommandManager,this.commandNotify=new g2.gdm.CommandNotify({manager:this.commandManager})},destroy:function(){this._plotAndDataObj.plotObj={},this._plotAndDataObj.dataObj={},this._syncPlotLayerGroup.clear(),this._syncPlotLayerGroup.removeAllLayers(),this._syncVisualizeLayerGroup.clear(),this._syncVisualizeLayerGroup.removeAllLayers(),this._groupLayer&&(this._groupLayer.clear(),this._groupLayer.removeAllLayers(),this.map.getMap().removeLayer(this._groupLayer)),e.prototype.destroy.call(this)}});return t.include({_initLayersGroup:function(){var e=new g2.carto.GroupLayer({id:"syncLayerGroup",name:"同步数据的图层组",layers:[]});this.map.getMap().addLayer(e),this._groupLayer=e,this._layers={};var t=new g2.carto.GroupLayer({layers:[]});e.addLayer(t),this._syncPlotLayerGroup=t;var i=new g2.carto.GroupLayer({layers:[]});e.addLayer(i),this._syncVisualizeLayerGroup=i},_getPlotSyncLayer:function(e){return e.type="_syncPlotLayerGroup",this._getSyncLayer(e)},_getVisualizeSyncLayer:function(e){return e.type="_syncVisualizeLayerGroup",this._getSyncLayer(e)},_getSyncLayer:function(e){var t=e.type,i=e.memberId||e.userId,r=t.toLowerCase()+"-"+i,o=null;return(o=this._layers[r])||(o=new g2.carto.ElementLayer({id:r,map:this.map.getMap()}),this[t].addLayer(o),this._layers[r]=o),o}}),t.include({showSyncData:function(e){var t="",i=e.memberId||e.userId,r=e.data;if(r&&r.length>0){for(var o=this._getVisualizeSyncLayer({memberId:i}),n=0;n<r.length;n++)o.add(r[n]);t=G.utils.CommonUtil.newUUID(),this._plotAndDataObj.dataObj[i]||(this._plotAndDataObj.dataObj[i]={}),this._plotAndDataObj.dataObj[i][t]=r}return t},clearSpecifyOrAllData:function(e){if(e){var t=e.split(",");if(t.length>0)for(var i=0;i<t.length;i++){this._getVisualizeSyncLayer({memberId:t[i]}).clear()}}else{for(var r in this._layers)r.indexOf("_syncvisualizelayergroup")>=0&&this._layers[r].clear();this._syncVisualizeLayerGroup.clear()}},visibleSpecifyOrAllData:function(e,t){if(null!=t)if(e){var i=e.split(",");if(i.length>0)for(var r=0;r<i.length;r++){this._getVisualizeSyncLayer({memberId:i[r]}).setVisible(t)}}else this._syncVisualizeLayerGroup.setVisible(t)},querySyncDataById:function(e){var t=e.dataId,i=e.memberId||e.userId;if(t&&i){var r=this._plotAndDataObj.dataObj[i][t];if(r){var o=this._getVisualizeSyncLayer({memberId:i});o.clear(),o.addElements(r)}}}}),t.include({showSyncPlot:function(e){var t,i=e.memberId||e.userId,r=e.data,o=this._getPlotSyncLayer({memberId:i});o.clear();for(var n=0;n<r.length;n++)o.add(r[n]);return this._fitBounds(r[r.length-1]),t=G.utils.CommonUtil.newUUID(),this._plotAndDataObj.plotObj[i]||(this._plotAndDataObj.plotObj[i]={}),this._plotAndDataObj.plotObj[i][t]=r,t},_fitBounds:function(e){var t=G.utils.GeometryUtil.getPlotEnvlop([e],this.map.getMap().spatialReference);if(t)if(t.$type.indexOf("Point")>=0)this.map.getMap().setCenter(t);else{this.map.getMap().pan(t,[100,100,100,100])}},clearSpecifyOrAllPlot:function(e){if(e){var t=e.split(",");if(t.length>0)for(var i=0;i<t.length;i++){this._getPlotSyncLayer({memberId:t[i]}).clear()}}else{for(var r in this._layers)r.indexOf("_syncplotlayergroup")>=0&&this._layers[r].clear();this._syncPlotLayerGroup.clear()}},visibleSpecifyOrAllPlot:function(e,t){if(null!=t)if(e){var i=e.split(",");if(i.length>0)for(var r=0;r<i.length;r++){this._getPlotSyncLayer({memberId:i[r]}).setVisible(t)}}else this._syncPlotLayerGroup.setVisible(t)},queryPlotDataById:function(e){var t=e.dataId,i=e.memberId||e.userId;if(t&&i){var r=this._plotAndDataObj.plotObj[i][t];if(r){var o=this._getPlotSyncLayer({memberId:i});o.clear(),o.addElements(r)}}}}),t}.apply(t,r))||(e.exports=o)},function(e,t,i){"use strict";var r,o;r=[i(1),i(10),i(6)],void 0===(o=function(e,t,i){var r=e.extend({options:{title:"协同标绘组件"},includes:i.prototype,initialize:function(t){e.prototype.initialize.call(this,t),this._initLayersGroup(),this._deserializer=new g2.core.Deserializer},destroy:function(){e.prototype.destroy.call(this)}});return r.include({_initLayersGroup:function(){var e=new g2.carto.GroupLayer({id:"syncLayerGroup",name:"同步数据的图层组",layers:[]});this.map.getMap().addLayer(e),this._groupLayer=e,this._layers={};var t=new g2.carto.GroupLayer({layers:[]});e.addLayer(t),this._collaborativePlotLayerGroup=t},_getPlotSyncLayer:function(e){return e.type="_collaborativePlotLayerGroup",this._getSyncLayer(e)},_getSyncLayer:function(e){var t=e.type,i=t.toLowerCase()+"-"+e.memberId,r=null;return(r=this._layers[i])||(r=new g2.carto.ElementLayer({id:i,map:this.map.getMap()}),this[t].addLayer(r),this._layers[i]=r),r}}),r.include({startCollaborativePlot:function(){console.log("开始协同标绘");var e=this;this.plotCreatedCallback=function(t){var i=t.element;t.type;e._addPlot(i)},this.plotUpdateCallback=function(t){var i=t.element;e._updatePlot(i)},this.plotDeleteCallback=function(t){var i=t.elements;e._deletePlot(i)},this.map.on(G.misc.AppEvents.PLOT_CREATED,this.plotCreatedCallback),this.map.on(G.misc.AppEvents.PLOT_UPDATED,this.plotUpdateCallback),this.map.on(G.misc.AppEvents.PLOT_DELETE,this.plotDeleteCallback)},endCollaborativePlot:function(){console.log("结束协同标绘");this.map.off(G.misc.AppEvents.PLOT_CREATED,this.plotCreatedCallback),this.map.off(G.misc.AppEvents.PLOT_UPDATED,this.plotUpdateCallback),this.map.off(G.misc.AppEvents.PLOT_DELETE,this.plotDeleteCallback)},analysisSyncPlot:function(e){var t="",i=e.data,r=e.memberId;if(r&&i){var o=this._getPlotSyncLayer({memberId:r}),n=this._deserializePlotElement(i);n&&this["_"+i.name+"OnLayer"](n,o),t="数据解析成功!"}else t="数据解析失败!成员标识或者数据不全";return{msg:t,dataId:""}},clearSpecifyOrAllPlot:function(e){if(e){var t=e.split(",");if(t.length>0)for(var i=0;i<t.length;i++){this._getPlotSyncLayer({memberId:t[i]}).clear()}}else{for(var r in this._layers)r.indexOf("_collaborativePlotLayerGroup")>=0&&this._layers[r].clear();this._syncPlotLayerGroup.clear()}},visibleSpecifyOrAllPlot:function(e,t){if(null!=t)if(e){var i=e.split(",");if(i.length>0)for(var r=0;r<i.length;r++){this._getPlotSyncLayer({memberId:i[r]}).setVisible(t)}}else this._syncPlotLayerGroup.setVisible(t)}}),r.include({_addPlot:function(e){var i=new g2.plot.PlotSchema({id:(new Date).toString(),name:"addPlot"}),r=e.copy();r.unReset(),r.id=e.id,i.addElement(r),this.fire(t.COLLABORATIVE_PLOT_CREATED,{data:i})},_updatePlot:function(e){var i=new g2.plot.PlotSchema({id:(new Date).toString(),name:"updatePlot"}),r=e.copy();r.unReset(),r.id=e.id,i.addElement(r),this.fire(t.COLLABORATIVE_PLOT_UPDTAED,{data:i})},_deletePlot:function(e){for(var i=new g2.plot.PlotSchema({id:(new Date).toString(),name:"deletePlot"}),r=0;r<e.length;r++){var o=e[r].copy();o.unReset(),o.id=e[r].id,i.addElement(o)}this.fire(t.COLLABORATIVE_PLOT_DELETE,{data:i})}}),r.include({_addPlotOnLayer:function(e,t){t&&e[0]&&t.add(e[0])},_updatePlotOnLayer:function(e,t){if(t&&e[0]&&t.contains(e[0].id)){var i=t.find(e[0].id);t.remove(i),t.add(e[0])}},_deletePlotOnLayer:function(e,t){if(e.length>0&&t)for(var i=0;i<e.length;i++)if(t.contains(e[i].id)){var r=t.find(e[i].id);t.remove(r)}},_deserializePlotElement:function(e){var t=[],i=this._deserializer.createJsInstance(e);if(i)for(var r=0;r<i.getCount();r++){var o=i.getElement(r);o.reset(),t.push(o)}return t}}),r}.apply(t,r))||(e.exports=o)},function(e,t,i){"use strict";var r,o;r=[i(62),i(64)],void 0===(o=function(e,t){G.services=G.services||{},G.services.NetworkService=e,G.services.WfsService=t}.apply(t,r))||(e.exports=o)},function(e,t,i){var r,o;r=[i(14),i(63),i(23)],void 0===(o=function(e,t,i){return e.extend({options:{serviceType:"tsgis/baidu/tdt",url:"服务的url地址",srid:"4490/4326/3857",origin:[116.259899,40.012012],dest:"终点",stops:[],cost:"time/length"},initialize:function(t){e.prototype.initialize.call(this,t)},destroy:function(){e.prototype.destroy.call(this)},route:function(e,i,r){var o=jQuery.extend(!0,{},this.options);o=jQuery.extend(!0,o,e);var n=this._fnValidOpts(o);if(n)return{code:0,msg:"参数传递错误："+n};var a=t.convertRequestParam(o);switch(a.serviceType){case"tsgis":t.requestTsgis(a,i,r);break;case"baidu":t.requestBaidu(a,i,r);break;case"tdt":t.requestTdt(a,i,r)}},_fnValidOpts:function(e){var t="";return e.serviceType?e.srid?e.origin?e.dest?e.cost?t:t="请传入导航策略（cost）":t="终点参数（dest）为必填":t="起点参数（origin）为必填":t="请传入坐标系类型（srid）":t="请传入服务类型（seriveType）"}})}.apply(t,r))||(e.exports=o)},function(module,exports,__webpack_require__){var __WEBPACK_AMD_DEFINE_ARRAY__,__WEBPACK_AMD_DEFINE_RESULT__;__WEBPACK_AMD_DEFINE_ARRAY__=[__webpack_require__(23)],__WEBPACK_AMD_DEFINE_RESULT__=function(adapterRes){var temp={convertRequestParam:function(e){var t=null;switch(e.serviceType){case"tsgis":t=this.convertTsgisRequestParam(e);break;case"baidu":t=this.convertBaiduRequestParam(e);break;case"tdt":t=this.convertTdtRequestParam(e)}return t.serviceType=e.serviceType,t.url=e.url,t},convertTsgisRequestParam:function(e){var t={$type:"RouteParameters,http://www.Gs.com",barriers:[],impedanceAttribute:"Length",useHierarchy:!1,ignoreInvalidLocations:!0,stops:[]};"length"==e.cost?t.impedanceAttribute="Length":"time"==e.cost&&(t.impedanceAttribute="Time");var i={$type:"Point,http://www.Gs.com",spatialReference:e.srid,x:e.origin[0],y:e.origin[1],z:0};t.stops.push(i);for(var r=0;r<e.stops;r++){var o=e.stops[r],n={$type:"Point,http://www.Gs.com",spatialReference:e.srid,x:o[0],y:o[1],z:0};t.stops.push(n)}var a={$type:"Point,http://www.Gs.com",spatialReference:e.srid,x:e.dest[0],y:e.dest[1],z:0};return t.stops.push(a),t},convertBaiduRequestParam:function(e){var t={mode:"driving",origin:e.origin.reverse().toString(),destination:e.dest.reverse().toString(),origin_region:e.origin_region,destination_region:e.dest_region,output:"json",ak:e.baiduak};switch(e.cost){case"time":t.tactics=13;break;case"length":t.tactics=12}if(e.stops&&0!=e.stops.length){for(var i=[],r=0;r<e.stops.length;r++){var o=e.stops[r];i.push(o.reverse())}t.waypoints=i.join("|")}return"4326"==e.srid?t.coord_type="wgs84":t.coord_type=e.srid,t},convertTdtRequestParam:function(e){var t={};t.orig=e.origin.toString(),t.dest=e.dest.toString(),e.stops&&(t.mid=e.stops.join(";"));var i="";switch(e.cost){case"time":i=0;break;case"length":i=1}return t.style=i,t},requestTsgis:function(e,t,i){$.ajax({url:e.url,type:"post",data:JSON.stringify(e),dataType:"json",beforeSend:function(e){e.setRequestHeader("Authorization","Bearer d277145"),e.setRequestHeader("Content-Type","application/json")},success:function(e){t(adapterRes.convertTsgisResponse(e))},error:function(e){i(e)}})},requestBaidu:function(e,t,i){var r=e.url;delete e.url,delete e.serviceType,$.ajax({url:r,type:"get",dataType:"jsonp",data:e,success:function(e){t(adapterRes.convertBaiduResponse(e))},error:function(e){i(e)}})},requestTdt:function(param,_success3,_error3){var proxyUrl="http://api.tianditu.gov.cn/apiserver/ajaxproxy",originalUrl_templae='http://api.tianditu.gov.cn/drive?postStr={"orig":"116.26762,39.8001","dest":"116.60889,40.02656","style":"0"}&type=search&tk=4f62e1d82bd46e2ff470b291c2260156',url=param.url;delete param.url,delete param.serviceType;var originalUrl=url+"?postStr="+JSON.stringify(param)+"&type=search";$.ajax({url:proxyUrl,type:"get",data:{proxyReqUrl:originalUrl},success:function success(result){eval(result),_success3(adapterRes.convertTdtResponse(tdt_loadResult.result))},error:function(e){_error3(e)}})},_tsgis_template:function(){}};return temp}.apply(exports,__WEBPACK_AMD_DEFINE_ARRAY__),void 0===__WEBPACK_AMD_DEFINE_RESULT__||(module.exports=__WEBPACK_AMD_DEFINE_RESULT__)},function(e,t,i){var r,o;r=[i(14),i(0)],void 0===(o=function(e,t){return e.extend({options:{},initialize:function(t){e.prototype.initialize.call(this,t)},destroy:function(){e.prototype.destroy.call(this)},requestWfsData:function(e){if(!e.typeNames&&!e.url&&!e.request)throw new Error("传入参数错误！");var i=[],r=[],o=e.url+"?request="+e.request+"&service=WFS&version=1.0.0&typeNames="+e.typeNames;e.searchType&&(o=o+"&searchType="+e.searchType),e.MAPSERVICE&&(o=o+"&MAPSERVICE="+e.MAPSERVICE),e.bbox&&(o=o+"&bbox="+e.bbox),e.maxFeatures&&(o=o+"&maxFeatures="+e.maxFeatures),e.propertyName&&(o=o+"&propertyName="+e.propertyName),e.srsName&&(o=o+"&srsName="+e.srsName),e.featureID&&(o=o+"&featureID="+e.featureID),e.count&&(o=o+"&count="+e.count),i.push($.ajax({url:o,type:"get",contentType:"text/html"})),$.when.apply(null,i).done(function(){if(1==i.length)return(n=arguments[0])?e.isConcat?r.concat(n):r.push(n):console.log("出现空数据"),void(e.callback&&t.isFunction(e.callback)&&e.callback.call(e.context,r));for(var o=0;o<arguments.length;o++){var n;(n=arguments[o][0])?e.isConcat?r.concat(n):r.push(n):console.log("出现空数据")}e.callback&&t.isFunction(e.callback)&&e.callback.call(e.context,r)})},selectWfsData:function(e){if(!e.request&&!e.field&&!e.keyword)throw new Error("传入参数错误！");var t=[],i=e.url+"?request="+e.request+"&service=WFS&version=1.0.0&field="+e.field+"&keyword="+e.keyword;e.MAPSERVICE&&(i=i+"&MAPSERVICE="+e.MAPSERVICE),$.ajax({url:i,type:"get",contentType:"text/html",success:function(e){t.push(e[0])},error:function(){throw new Error("查询失败！")}})}})}.apply(t,r))||(e.exports=o)},function(e,t,i){"use strict";var r,o;r=[i(66),i(67),i(68),i(69),i(70),i(72),i(76)],void 0===(o=function(e,t,i,r,o,n,a){G.components={},G.components.ScreenShotComponent=e,G.components.VisualComponent=t,G.components.SelectionComponent=r,G.components.AnimateComponent=i,G.components.MeasureComponent=o,G.components.TailedLabelComponent=n,G.components.BufferDrawComponent=a}.apply(t,r))||(e.exports=o)},function(e,t,i){"use strict";var r,o;r=[i(1),i(0)],void 0===(o=function(e,t){return e.extend({initialize:function(t){e.prototype.initialize.call(this,t)},shotMap:function(e){var i=document.getElementById(this.map.id);html2canvas(i,{onrendered:function(i){t.isFunction(e)&&e(i.toDataURL())},useCORS:!0})},screen:function(e){html2canvas.download(document.getElementById(this.map.options.targetId))},destroy:function(){e.prototype.destroy.call(this)}})}.apply(t,r))||(e.exports=o)},function(e,t,i){"use strict";var r,o;r=[i(1)],void 0===(o=function(e){var t=window.G||{};window.G=t;var i={PointNaturalDistribution:"PointNaturalDistribution",PointClusterDistribution:"PointClusterDistribution",PointClusterDistributionReduplicative:"PointClusterDistributionReduplicative",Statistics_Ratio_Ring:"Statistics_Ratio_Ring",Statistics_Total_Circle:"Statistics_Total_Circle",PointQuantityNaturalDistribution:"PointQuantityNaturalDistribution"},r=e.extend({options:{},initialize:function(e){t.base.PureComponent.prototype.initialize.call(this,e),this.changeVisualStyle(e)},addDispalyElements:function(e){this._layer.addElements(e)},updateData:function(e){this._layer.clear(),this._layer.addElements(e)},updateStatistics:function(e){t.components.VisualComponent.DisplayMode.Statistics_Ratio_Ring!=this.options.displayMode&&t.components.VisualComponent.DisplayMode.Statistics_Total_Circle!=this.options.displayMode||this._layer.updateStatistics(e)},setVisible:function(e){this._layer.setVisible(e)},getVisible:function(){return this._layer.getVisible()},changeVisualStyle:function(e){null!=this._layer&&(this.map.getMap().removeLayer(this._layer),this._layer.destroy()),this.options.displayMode=e.displayMode;var i=this,r={PointNaturalDistribution:function(e){var r=(new t.lys.LayerFactory).createLayer(t.lys.TYPES.ELEMENT_POINT_LAYER,{layerId:e.id,layerName:e.layerName,layerGroups:e.layerGroups,map:i.map.getMap(),idKey:e.fieldsParam.idKey,xField:e.fieldsParam.xField,yField:e.fieldsParam.yField,symbolConfig:jQuery.extend(!0,{},e.symbolConfig)});i.map.getMap().addLayer(r),i._layer=r},PointClusterDistribution:function(e){var r=(new t.lys.LayerFactory).createLayer(t.lys.TYPES.ELEMENT_POINT_PIXEL_CLUSTER,{layerId:e.id,layerName:e.layerName,layerGroups:e.layerGroups,map:i.map.getMap(),idKey:e.fieldsParam.idKey,xField:e.fieldsParam.xField,yField:e.fieldsParam.yField,symbolConfig:jQuery.extend(!0,{},e.symbolConfig)});i.map.getMap().addLayer(r),i._layer=r},PointClusterDistributionReduplicative:function(e){var r=new t.lys.LayerFactory,o=jQuery.extend(!0,{},e.reduplicativeParam),n=r.createLayer(t.lys.TYPES.ELEMENT_POINT_DUPLICATE,{layerId:e.id,layerName:e.layerName,layerGroups:e.layerGroups,map:i.map.getMap(),idKey:e.fieldsParam.idKey,xField:e.fieldsParam.xField,yField:e.fieldsParam.yField,symbolConfig:jQuery.extend(!0,{},e.symbolConfig),spiderfyDistance:o.spiderfyDistance,spiderfyLevel:o.spiderfyLevel,coincidenceClusterHoverThreshold:o.coincidenceClusterHoverThreshold,coincidenceClusterWeight:o.coincidenceClusterWeight,coincidenceClusterMarkerSym:o.coincidenceClusterMarkerSym,coincidenceClusterTextSym:o.coincidenceClusterTextSym,showSpiderLeg:o.showSpiderLeg,spiderfyThreshold:o.spiderfyThreshold,circleRadius:o.circleRadius,spiderfyLegSym:o.spiderfyLegSym});i.map.getMap().addLayer(n),i._layer=n},Statistics_Ratio_Ring:function(e){var r=(new t.lys.LayerFactory).createLayer(t.lys.TYPES.RING_STATISTICS_LAYER,{layerId:e.id,layerName:e.layerName,layerGroups:e.layerGroups,map:i.map.getMap(),xField:e.fieldsParam.xField,yField:e.fieldsParam.yField,showZero:e.showZero});i.map.getMap().addLayer(r),i._layer=r},Statistics_Total_Circle:function(e){var r=(new t.lys.LayerFactory).createLayer(t.lys.TYPES.PIE_STATISTICS_LAYER,{layerId:e.id,layerName:e.layerName,layerGroups:e.layerGroups,map:i.map.getMap(),xField:e.fieldsParam.xField,yField:e.fieldsParam.yField,showZero:e.showZero});i.map.getMap().addLayer(r),i._layer=r},PointQuantityNaturalDistribution:function(e){var r=(new t.lys.LayerFactory).createLayer(t.lys.TYPES.FEATURE_POINT_LAYER,{layerId:e.id,layerName:e.layerName,layerGroups:e.layerGroups,map:i.map.getMap(),idKey:e.fieldsParam.idKey,xField:e.fieldsParam.xField,yField:e.fieldsParam.yField,symbolConfig:jQuery.extend(!0,{},e.symbolConfig)});i.map.getMap().addLayer(r),i._layer=r}};null!=r[e.displayMode]?r[e.displayMode](e):console.error(e.displayMode+"没有对应的处理方法！")},getLayer:function(){return this._layer},clear:function(){this._layer.clear()},hitTest:function(e,t){return this._layer.hitTest(e,t)},adjustExtent:function(){var e=this._layer.getLayerExtent(),t=new g2.sfs.Envelope({minx:e[0],miny:e[1],maxx:e[2],maxy:e[3],spatialReference:this.map.spatialReference});this.map.getMap().pan(t,[5,5,5,5])},fullExtent:function(){this.adjustExtent()},destroy:function(){this._layer.clear(),this._layer.destroy(),t.base.PureComponent.prototype.destroy.call(this)}});return r.DisplayMode=i,t.DisplayMode=i,r}.apply(t,r))||(e.exports=o)},function(e,t,i){"use strict";var r,o;r=[i(1),i(0),i(7),i(5),i(11),i(3)],void 0===(o=function(e,t,i,r,o,n){var a={timers:{},timerMethod:{},getTimer:function(e){var t=this;return this.timers[e]||(this.timerMethod[e]={},this.timers[e]=setInterval(function(){t.play(e)},e)),this.timers.addTimerMothed=function(e,i,r,o,n){if(!t.timerMethod[e])throw new Error("指定的定时器方法不存在！");t.timerMethod[e][i]={fn:r,ctx:n,param:o}},this.timers.deleteTimerMethod=function(e,i){var r=!1;if(!t.timerMethod[e])throw new Error("指定的定时器方法不存在！");return t.timerMethod[e][i]&&(delete t.timerMethod[e][i],r=!0),r},this.timers.timerMethodsIsEmpty=function(e){return!!t.timerMethod&&(!!t.timerMethod[e]&&0==Object.keys(t.timerMethod[e]).length)},this.timers},clearTimer:function(e,t){if(!e[t])throw new Error("指定的定时器不存在！");window.clearInterval(e[t]),delete e[t]},play:function(e){if(Object.keys(this.timerMethod[e]).length>0){var t=this.timerMethod[e];for(var i in t)t[i].fn.call(t[i].ctx,t[i].param,t[i].fn)}}},s=e.extend({options:{},initialize:function(r){e.prototype.initialize.call(this,r);var o=this.map.getMap();this.options.layerId=this.options.layerId||t.newUUID32();var n=i.getLayerById(this.map,this.options.layerId);n||(n=new g2.carto.ElementLayer({id:this.options.layerId,map:o}),o.addLayer(n)),this._layer=n,this._timerMap={},this._toolTipWare=new g2.widget.TooltipWare({map:o}),this._differenceTimer={}},destroy:function(){for(var t in this._timerMap)this.clear(t);var i=this.map.getMap();this._layer.clear(),i.removeLayer(this._layer),e.prototype.destroy.call(this)}});return s.include({blinkIconMaker:function(e){if(e=e||{},!t.isArray(e.point)||2!=e.point.length)throw new Error("point参数错误！");if(e.process.length<1)throw new Error("process参数错误！");for(var i=this.map.getMap(),r=new g2.sfs.Point({x:e.point[0],y:e.point[1],spatialReference:i.spatialReference}),o=e.process,n=isNaN(e.interval)?200:parseFloat(e.interval),a=isNaN(e.cost)?3e3:parseFloat(e.cost),s=[],l=0,c=o.length;l<c;l++){var h=o[l],p=new g2.sfs.PictureMarkerSymbol({source:h.source,width:h.width,height:h.height,offsetX:h.width/2,offsetY:h.height/2,opacity:1});s.push(p)}var u=0,f=t.newUUID(),y=new g2.sfs.Element({id:f,geometry:r,symbol:s[u]});if(this._layer.add(y),e.tooltip){var d=jQuery.extend(!0,{},e.tooltip),m=d.html||"<div>test</div>";d.id=f,d.offset=d.offset||[10,-10],d.className=d.className||"g2-tooltip",d.layerId=this._layer.getLayerId();var g=new g2.widget.Tooltip({id:d.id,anchor:r,content:m,layerId:d.layerId,offset:d.offset,className:d.className});this._toolTipWare.add(g)}var v=this,_=0,b=setInterval(function(){++u>=s.length&&(u%=s.length),y.symbol=s[u],v._layer.update(y,!0),(_+=n)>=a&&v.clear(f)},n);return this._timerMap[f]=b,f},blinkVectorMarker:function(e){if(e=e||{},!t.isArray(e.point)||2!=e.point.length)throw new Error("参数错误！");var i=this.map.getMap(),o=new g2.sfs.Point({x:e.point[0],y:e.point[1],spatialReference:i.spatialReference}),n=e.style||"circle",a=isNaN(e.startSize)?3:parseFloat(e.startSize),s=isNaN(e.endSize)?20:parseFloat(e.endSize),l=isNaN(e.interval)?80:parseFloat(e.interval),c=isNaN(e.cost)?3e3:parseFloat(e.cost),h=s>a?1:-1,p=e.borderColor||{alpha:100,r:0,g:0,b:250},u=isNaN(e.borderWidth)?1:parseFloat(e.borderWidth),f=e.fillColor||{alpha:200,r:0,g:0,b:250},y=r.object2Color(p),d=r.object2Color(f),m=new g2.sfs.SimpleMarkerSymbol({style:n,fillColor:d,borderColor:y,size:a,borderThickness:u}),g=t.newUUID(),v=new g2.sfs.Element({id:g,geometry:o,symbol:m});if(this._layer.add(v),e.tooltip){var _=jQuery.extend(!0,{},e.tooltip),b=_.html||"<div>test</div>";_.id=g,_.offset=_.offset||[10,-10],_.className=_.className||"g2-tooltip",_.layerId=this._layer.getLayerId();var w=new g2.widget.Tooltip({id:_.id,anchor:o,content:b,layerId:_.layerId,offset:_.offset,className:_.className});this._toolTipWare.add(w)}var S=this,L=0,P=setInterval(function(){v.symbol;var e=v.symbol.size;e+=h,v.symbol.size=e,S._layer.update(v,!0),(e-a)*(e-s)>=0&&(h*=-1),(L+=l)>=c&&S.clear(g)},l);return this._timerMap[g]=P,g},rotationIconMaker:function(e){if(e){if(!t.isArray(e.point)||2!=e.point.length||!e.source)throw new Error("参数错误！");isNaN(e.width)||parseFloat(e.width),isNaN(e.height)||parseFloat(e.height);var i=isNaN(e.speed)?200:parseFloat(e.speed),r=360,o=this.map.getMap(),n=new g2.sfs.Point({x:e.point[0],y:e.point[1],spatialReference:o.spatialReference}),a=new g2.sfs.PictureMarkerSymbol({source:e.source,rotation:r,width:e.width,height:e.height,opacity:1,offsetX:e.width/2,offsetY:e.height/2}),s=t.newUUID(),l=new g2.sfs.Element({id:s,geometry:n,symbol:a});if(this._layer.add(l),e.tooltip){var c=jQuery.extend(!0,{},e.tooltip),h=c.html||"<div>test</div>";c.id=s,c.offset=c.offset||[10,-10],c.className=c.className||"g2-tooltip",c.layerId=this._layer.getLayerId();var p=new g2.widget.Tooltip({id:c.id,anchor:n,content:h,layerId:c.layerId,offset:c.offset,className:c.className});this._toolTipWare.add(p)}var u=this,f=setInterval(function(){var e=u._layer.find(s);r-=20,e.symbol.rotation=r,u._layer.update(e,!0),0==r&&(r=360)},i);return this._timerMap[s]=f,s}},iconMoveOnLine:function(e,i,r){if(!(e.pathGeojson&&e.source&&e.width&&e.height))throw new Error("参数错误！");var s=isNaN(e.speed)?2:parseFloat(e.speed),l=isNaN(e.lineStyle)?5:parseFloat(e.lineStyle),c=isNaN(e.lineWidth)?3:parseFloat(e.lineWidth),h=e.lineColor||{a:153,r:0,g:0,b:255},p=isNaN(e.interval)?80:parseFloat(e.interval),u=e.isRotate||!1,f=e.textIsRotate||!1,y=e.isShowLine,d={},m=e.tooltip||!1;null==y&&(y=!0),d="string"==typeof e.pathGeojson?n.getWktReader().read(e.pathGeojson):n.getGeoJSONReader().read(e.pathGeojson);for(var g=n.getGeoJSONWriter().write(d),v=new g2.sfs.SimpleLineSymbol({style:l,width:c,color:new g2.sfs.Color(h)}),_=new g2.sfs.Polyline({spatialReference:this.map.getMap().spatialReference}),b=new g2.sfs.Path({spatialReference:this.map.getMap().spatialReference}),w=0;w<g.coordinates.length;w++){var S=new g2.sfs.Point({x:g.coordinates[w][0],y:g.coordinates[w][1],spatialReference:this.map.getMap().spatialReference});b.addPoint(S)}if(_.addGeometry(b),0==n.measureLength(_))throw new Error("线起点终点不能重合！");var L=t.newUUID(),P=new g2.sfs.Element({id:L,geometry:_,symbol:v});y&&this._layer.add(P);var E=o.getPointOnPath({pathGeometry:g,pathSrid:this.map.getMap().spatialReference,distance:0}),C=t.newUUID(),x=new g2.sfs.Point({x:E.point[0],y:E.point[1],spatialReference:this.map.getMap().spatialReference}),T=new g2.sfs.PictureMarkerSymbol({source:e.source,width:e.width,height:e.height,offsetX:e.width/2,offsetY:e.height/2,opacity:1}),M=new g2.sfs.TextSymbol({text:e.text||"",fontSize:e.size||15,offsetX:e.offsetX||0,offsetY:e.offsetY||-21,foreground:new g2.sfs.Color(e.foreground)||new g2.sfs.Color({a:255,r:255,g:0,b:0}),borderColor:new g2.sfs.Color(e.borderColor)||new g2.sfs.Color({a:255,r:255,g:0,b:0}),borderThickness:e.borderThickness||.1,fontFamilyName:e.fontFamilyName,fontWeight:e.fontWeight||1,textAlign:e.textAlign}),A=new g2.sfs.CurrencySymbol({markerSymbol:T,textSymbol:M}),R=new g2.sfs.Element({id:C,geometry:x,symbol:A});if(u&&(A.markerSymbol.rotation=E.point[2]),f&&(A.textSymbol.rotation=E.point[2]),this._layer.add(R),m){var k=(m=jQuery.extend(!0,{},m)).html||"<div>test</div>";m.id=C,m.offset=m.offset||[10,-10],m.className=m.className||"g2-tooltip",m.layerId=this._layer.getLayerId();var I=new g2.widget.Tooltip({id:m.id,anchor:x,content:k,layerId:m.layerId,offset:m.offset,className:m.className});this._toolTipWare.add(I);var O=jQuery("[animateId="+C+"]").eq(0).parent().parent().parent();m.container=O,m.startPoint=x}var N=this,D={geomtry:g,pointId:C,lineId:L,interval:p,step:1,speed:s,rotation:0,tooltip:m,callback:i,context:r},F=a.getTimer(p);return this[L+"draw"]=function(e){var i=o.getPointOnPath({pathGeometry:e.geomtry,pathSrid:N.map.getMap().spatialReference,distance:e.interval*e.step/1e3*e.speed});function r(r){var o,n=N._layer.find(e.pointId);if(G.utils.CommonUtil.isEmptyObject(n)){console.log("地图点已被清除");var s=a.getTimer(e.interval);s.deleteTimerMethod(e.interval,e.lineId+"draw");s.timerMethodsIsEmpty(e.interval)&&a.clearTimer(s,p)}else{if(r)o=new g2.sfs.Point({x:i.point[0],y:i.point[1],spatialReference:N.map.getMap().spatialReference});else{var l=e.geomtry.coordinates;o=new g2.sfs.Point({x:l[l.length-1][0],y:l[l.length-1][1],spatialReference:N.map.getMap().spatialReference})}if(n.geometry=o,i.point&&(e.rotation=i.point[2]),u&&(n.symbol.markerSymbol.rotation=e.rotation),f&&(n.symbol.textSymbol.rotation=e.rotation),N._layer.remove(n),N._layer.add(n),e.tooltip)if(t.isFunction(N._toolTipWare.update)){var c={};c.id=e.tooltip.id,c.anchor=o,N._toolTipWare.update(c)}else{var h=N._toolTipWare.IdContainer[e.tooltip.id];h&&h.setPosition([o.x,o.y])}e.step+=1}}i.arrival?(r(!1),t.isFunction(e.callback)&&e.callback.call(e.context,e.lineId+","+e.pointId,p)):r(!0)},F.addTimerMothed(p,L+"draw",this[L+"draw"],D),L+","+C},lineGradient:function(e){if(!e.pathGeojson)throw new Error("参数错误！");var i=isNaN(e.lineStyle)?5:parseFloat(e.lineStyle),r=isNaN(e.lineWidth)?3:parseFloat(e.lineWidth),s=e.lineColor||{a:153,r:0,g:0,b:255},l=isNaN(e.interval)?50:parseFloat(e.interval),c=isNaN(e.coverPointNum)?4:e.coverPointNum,h={};h="string"==typeof e.pathGeojson?n.getWktReader().read(e.pathGeojson):n.getGeoJSONReader().read(e.pathGeojson);for(var p=n.getGeoJSONWriter().write(h),u=new g2.sfs.SimpleLinesymbol({style:i,width:r,color:new g2.sfs.Color(s)}),f=new g2.sfs.Polyline({spatialReference:this.map.getMap().spatialReference}),y=new g2.sfs.Path({spatialReference:this.map.getMap().spatialReference}),d=0;d<p.coordinates.length;d++){var m=new g2.sfs.Point({x:p.coordinates[d][0],y:p.coordinates[d][1],spatialReference:this.map.getMap().spatialReference});y.addPoint(m)}f.addGeometry(y);var g=t.newUUID(),v=new g2.ele.Element({id:g,geometry:f,symbol:u});this._layer.add(v);var _=this,b=new g2.carto.ElementLayer({id:g,map:this.map.getMap()});this.map.getMap().addLayer(b);var w=a.getTimer(l),S={lineArr:[],step:1,layer:b,geomtry:p,interval:l,coverPointNum:c,speed:1e5,lineId:g,polylineElement:v,_layer:this._layer,lineStyle:i,lineWidth:r};function L(){return"#ff"+Math.floor(180*Math.random()+10)+Math.floor(100*Math.random()+10)}return this[g+"draw"]=function(e){if(e.lineArr.length>0){for(var i=0;i<e.lineArr.length;i++)b.remove(e.lineArr[i]);e.lineArr.length=0}var r=e.interval/1e3*e.step;e.step=e.step+1;for(var n=[],a=!1,s=e.geomtry.coordinates,l=1;l<e.coverPointNum;l++){if(r-(h=e.interval*l/1e3)>=0){var c=o.getPointOnPath({pathGeometry:e.geomtry,pathSrid:_.map.getMap().spatialReference,distance:r*e.speed-h*e.speed});if(c.arrival&&!a){e._layer.find(e.lineId)&&e._layer.remove(e.polylineElement),c.point=[s[s.length-1][0],s[s.length-1][1],0],c.color=g2.sfs.Color.fromHex(L()),c.point&&n.push(c),a=!0;continue}c.color=g2.sfs.Color.fromHex(L()),c.point&&n.push(c)}}for(var h=n.length-1;h>0;h--)if(n[h-1]){var p=new g2.sfs.Polyline({spatialReference:_.map.getMap().spatialReference}),u=new g2.sfs.Path({spatialReference:_.map.getMap().spatialReference}),f=new g2.sfs.SimpleLineSymbol({style:e.lineStyle,width:e.lineWidth,color:n[h].color}),y=new g2.sfs.Point({x:n[h].point[0],y:n[h].point[1],spatialReference:_.map.getMap().spatialReference});if(!n[h-1].point)break;var d=new g2.sfs.Point({x:n[h-1].point[0],y:n[h-1].point[1],spatialReference:_.map.getMap().spatialReference});u.addPoint(y),u.addPoint(d),p.addGeometry(u);var m=new g2.sfs.Element({id:t.newUUID(),geometry:p,symbol:f});e.lineArr.push(m),e.layer.add(m)}try{n[n.length-1].point[0]==s[s.length-1][0]&&n[n.length-1].point[1]==s[s.length-1][1]&&(e.step=0)}catch(e){}},w.addTimerMothed(l,g+"draw",this[g+"draw"],S),g},loadGifPicture:function(e){if(!e.source||!e.point)throw new Error("参数错误！");var i=t.newUUID(),r=e.offset||[-32,-32],o='<img id="'+i+'" src="'+e.source+'"/>',n=new g2.sfs.Point({x:e.point[0],y:e.point[1],spatialReference:this.map.getMap().spatialReference}),a=new g2.widget.Tooltip({id:i,anchor:n,content:o,layerId:this._layer.id,offset:r});return this._toolTipWare.add(a),i},updateGifPicture:function(e){if(!e.id||!e.source)throw new Error("参数错误！");$("#"+e.id).attr("src",e.source)},clear:function(e,t){if((e=e.split(",")||[]).length<1)throw new Error("参数错误！");for(var r=0;r<e.length;r++){var o=i.getLayerById(this.map,e[r]);if(o&&this.map.removeLayer(o),t){var n=a.getTimer(t);n.deleteTimerMethod(t,e[r]+"draw");n.timerMethodsIsEmpty(t)&&a.clearTimer(n,t)}try{clearInterval(this._timerMap[e[r]])&&delete this._timerMap[e[r]]}catch(e){}var s=this._layer.find(e[r]);s&&(this._layer.remove(s),this._toolTipWare.remove(e[r]))}}}),s.include({pointFlowOnLine:function(e){if(!e.data)throw new Error("传入参数错误");this.allCanvas||(this.allCanvas={});var t=this._initParam(e,this.map.getMap()),i=this._createBaseCanvas()+","+this._createAnimationCanvas();return this.allCanvas[i]=t,this._drawCanvas(i),this._initMapEvents(i),i},_initParam:function(e,t){var i={};return i.markerRadius=isNaN(e.markerRadius)?2:parseFloat(e.markerRadius),i.markerColor=e.markerColor,i.lineType=e.lineType||"solid",i.lineWidth=isNaN(e.lineWidth)?2:parseFloat(e.lineWidth),i.colors=e.colors||["red","popup","#EDCC72","#E2F194","#94E08A","#4ECDA5","#F8AB60","green"],i.moveRadius=isNaN(e.moveRadius)?3:parseFloat(e.moveRadius),i.fillColor=e.fillColor||["red"],i.shadowBlur=isNaN(e.shadowBlur)?10:parseFloat(e.shadowBlur),i.data=e.data,i.deltaAngle=isNaN(e.deltaAngle)?0:parseFloat(e.deltaAngle),i.interval=isNaN(e.interval)?50:parseFloat(e.interval),this.canvasMap=t,this.mapViewWidth=t.getViewSize()[0],this.mapViewHeight=t.getViewSize()[1],i},_createBaseCanvas:function(){var e=document.createElement("canvas");e.id="canvas-"+G.utils.CommonUtil.newUUID(),this[e.id]=e,$(".ol-overlaycontainer-stopevent").prepend(e);var t=e.getContext("2d");return e.style.cssText="pointer-events:none;position:absolute;left:0;top:0;z-index:0;",e.width=this.mapViewWidth,e.height=this.mapViewHeight,e.style.width=e.width+"px",e.style.height=e.height+"px",this._adjustRatio(t),e.id},_createAnimationCanvas:function(){var e=document.createElement("canvas");e.id="canvas-"+G.utils.CommonUtil.newUUID(),this[e.id]=e,$(".ol-overlaycontainer-stopevent").prepend(e);var t=e.getContext("2d");return e.style.cssText="pointer-events:none;position:absolute;left:0;top:0;z-index:1;",e.width=this.mapViewWidth,e.height=this.mapViewHeight,e.style.width=e.width+"px",e.style.height=e.height+"px",this._adjustRatio(t),e.id},_adjustRatio:function(e){var t=e.backingStorePixelRatio||e.webkitBackingStorePixelRatio||e.mozBackingStorePixelRatio||e.msBackingStorePixelRatio||e.oBackingStorePixelRatio||e.backingStorePixelRatio||1,i=(window.devicePixelRatio||1)/t,r=e.canvas.width,o=e.canvas.height;e.canvas.width=r*i,e.canvas.height=o*i,e.canvas.style.width=r+"px",e.canvas.style.height=o+"px",e.scale(i,i)},_drawCanvas:function(e){var t=this;this._clearCanvasContent(e),setTimeout(function(){t._drawBaseLine(e)},1),this.allCanvas[e].canvasInterval=setInterval(function(){t._drawAnimationLine(e)},t.allCanvas[e].interval)},_drawAnimationLine:function(e){var t=this[e.split(",")[1]].getContext("2d");if(t){t.fillStyle="rgba(0,0,0,0.9)";var i=t.globalCompositeOperation;t.globalCompositeOperation="destination-in",t.fillRect(0,0,this.mapViewWidth,this.mapViewHeight),t.globalCompositeOperation=i;for(var r=0;r<this.allCanvas[e].markLines.length;r++){this.allCanvas[e].markLines[r].drawMoveCircle(t,e,r)}}},_drawBaseLine:function(e){var t=this[e.split(",")[0]].getContext("2d");t&&(this._addMarkLine(e),t.clearRect(0,0,this.mapViewWidth,this.mapViewHeight),this.allCanvas[e].markLines.forEach(function(i){i.drawMarker(t,e),i.drawLinePath(t,e)}))},_initMapEvents:function(e){var t=this,i=function(i,r,o,n,a,s,l){t.allCanvas[e].canvasInterval&&t._drawCanvas(e)};t.map.on("mousedown",function(e,r,o,n,a,s,l){t.map.on("mousemove",i)});t.map.on("mouseup",function(e,r,o,n,a,s,l){t.map.off("mousemove",i)});t.map.on("resolutionchanged",function(i,r,o){t.allCanvas[e].canvasInterval&&t._drawCanvas(e)});t.map.on("extentchanged",function(i,r,o,n){t.allCanvas[e].canvasInterval&&t._drawCanvas(e)})},_addMarkLine:function(e){var t=this;function i(e){this.city=e.city,this.location=e.location,this.color=e.color}function r(e){this.from=e.from,this.to=e.to,this.id=e.id}this.allCanvas[e].markLines=[],this.allCanvas[e].data.forEach(function(o,n){t.allCanvas[e].markLines.push(new r({id:n,from:new i({city:o.from.city,location:new g2.sfs.Point({x:o.from.lnglat[0],y:o.from.lnglat[1],spatialReference:t.map.getMap().spatialReference}),color:t.allCanvas[e].colors[n]}),to:new i({city:o.to.city,location:new g2.sfs.Point({x:o.to.lnglat[0],y:o.to.lnglat[1],spatialReference:t.map.getMap().spatialReference}),color:t.allCanvas[e].colors[n]})}))}),i.prototype.draw=function(e,i){var r=t.canvasMap.getPixelFromCoordinate([this.location.x,this.location.y]);r&&(e.save(),e.beginPath(),e.fillStyle=this.color||"red",e.arc(r[0],r[1],t.allCanvas[i].markerRadius,0,2*Math.PI,!0),e.closePath(),e.fill(),e.textAlign="center",e.textBaseline="middle",e.font="12px Microsoft YaHei",e.fillStyle=this.color||"red",e.fillText(this.city,r[0],r[1]-10),e.restore())},r.prototype.getPointList=function(e,t,i){var r=[[e[0],e[1]],[t[0],t[1]]],o=r[1][0],n=r[1][1];return r[3]=[o,n],r[1]=this.getOffsetPoint(r[0],r[3],i),r[2]=this.getOffsetPoint(r[3],r[0],i),(r=this.smoothSpline(r,!1))[r.length-1]=[o,n],r},r.prototype.getOffsetPoint=function(e,i,r){var o,n,a,s=this.getDistance(e,i)/3,l=[e[0],e[1]],c=t.allCanvas[r].deltaAngle;if(e[0]!=i[0]&&e[1]!=i[1]){var h=(i[1]-e[1])/(i[0]-e[0]);o=Math.atan(h)}else o=e[0]==i[0]?(e[1]<=i[1]?1:-1)*Math.PI/2:0;return e[0]<=i[0]?(o-=c,n=Math.round(Math.cos(o)*s),a=Math.round(Math.sin(o)*s),l[0]+=n,l[1]+=a):(o+=c,n=Math.round(Math.cos(o)*s),a=Math.round(Math.sin(o)*s),l[0]-=n,l[1]-=a),l},r.prototype.smoothSpline=function(e,t){for(var i=e.length,r=[],o=0,n=1;n<i;n++)o+=this.getDistance(e[n-1],e[n]);var a=o/2;a=a<i?i:a;for(n=0;n<a;n++){var s,l,c,h=n/(a-1)*(t?i:i-1),p=Math.floor(h),u=h-p,f=e[p%i];t?(s=e[(p-1+i)%i],l=e[(p+1)%i],c=e[(p+2)%i]):(s=e[0===p?p:p-1],l=e[p>i-2?i-1:p+1],c=e[p>i-3?i-1:p+2]);var y=u*u,d=u*y;r.push([this.interpolate(s[0],f[0],l[0],c[0],u,y,d),this.interpolate(s[1],f[1],l[1],c[1],u,y,d)])}return r},r.prototype.interpolate=function(e,t,i,r,o,n,a){var s=.5*(i-e),l=.5*(r-t);return(2*(t-i)+s+l)*a+(-3*(t-i)-2*s-l)*n+s*o+t},r.prototype.getDistance=function(e,t){return Math.sqrt((e[0]-t[0])*(e[0]-t[0])+(e[1]-t[1])*(e[1]-t[1]))},r.prototype.drawMarker=function(e,t){this.from.draw(e,t),this.to.draw(e,t)},r.prototype.drawLinePath=function(e,i){var r=t.canvasMap.getPixelFromCoordinate([this.from.location.x,this.from.location.y]),o=t.canvasMap.getPixelFromCoordinate([this.to.location.x,this.to.location.y]);if(r&&o){var n=this.path=this.getPointList(r,o,i),a=n.length;if(e.save(),e.beginPath(),e.lineWidth=t.allCanvas[i].lineWidth,e.strokeStyle=t.allCanvas[i].markerColor||t.allCanvas[i].colors[this.id],e.shadowBlur=t.allCanvas[i].shadowBlur,t.allCanvas[i].lineType&&"solid"!=t.allCanvas[i].lineType){if("dashed"==t.allCanvas[i].lineType||"dotted"==t.allCanvas[i].lineType)for(s=1;s<a;s+=2)e.moveTo(n[s-1][0],n[s-1][1]),e.lineTo(n[s][0],n[s][1])}else{e.moveTo(n[0][0],n[0][1]);for(var s=0;s<a;s++)e.lineTo(n[s][0],n[s][1])}e.stroke(),e.restore(),this.step=0}},r.prototype.drawMoveCircle=function(e,i,r){var o=t.canvasMap.getPixelFromCoordinate([this.from.location.x,this.from.location.y]),n=t.canvasMap.getPixelFromCoordinate([this.to.location.x,this.to.location.y]);if(o&&n){var a=this.path||this.getPointList(o,n,i);e.save(),e.fillStyle=t.allCanvas[i].fillColor[r]||"red",e.shadowColor=t.allCanvas[i].fillColor[r]||"red",e.shadowBlur=t.allCanvas[i].shadowBlur,e.beginPath(),this.step+=1,a[this.step]||(this.step=0),e.arc(a[this.step][0],a[this.step][1],t.allCanvas[i].moveRadius,0,2*Math.PI,!0),e.fill(),e.closePath(),e.restore(),this.step+=1}}},_clearCanvasContent:function(e){clearInterval(this.allCanvas[e].canvasInterval),this.allCanvas[e].canvasInterval=null;var t=e.split(",");this[t[0]].getContext("2d").clearRect(0,0,this.mapViewWidth,this.mapViewHeight),this[t[1]].getContext("2d").clearRect(0,0,this.mapViewWidth,this.mapViewHeight)},clearFlowAnimation:function(e){var t=this;if(e)r(e);else if(!G.utils.CommonUtil.isEmptyObject(this.allCanvas))for(var i in this.allCanvas)r(i);function r(e){clearInterval(t.allCanvas[e].canvasInterval),t.allCanvas[e].canvasInterval=null;var i=e.split(",");t[i[0]].remove(),t[i[1]].remove(),delete t.allCanvas[e]}}}),s}.apply(t,r))||(e.exports=o)},function(e,t,i){"use strict";var r,o;r=[i(1),i(7),i(0)],void 0===(o=function(e,t,i){var r=e.extend({options:{},initialize:function(r){e.prototype.initialize.call(this,r);var o=this.map.getMap();this.options.selectionLayer=this.options.selectionLayer||i.newUUID32();var n=t.getLayerById(this.map,this.options.selectionLayer);n||(n=new g2.carto.ElementLayer({id:this.options.selectionLayer,map:o}),o.addLayer(n)),this._layer=n,this._matchingLayer=this.options.matchingLayer},destroy:function(){this.map.getMap().removeLayer(this._layer),e.prototype.destroy.call(this)}});return r.include({pointMatchingElement:function(){var e=this,t=this._matchingLayer;t.length>0&&this.map.on("click",function(i){for(var r=0;r<t.length;r++){var o=t[r].hitTest(i.screenX,i.screenY);if(o){o.layer=t[r];var n=o.element;e.fire("pointMatchingElement",n)}}})},squareMatchingElement:function(e){var i,r,o,n,a,s=this;this.map.getMap().stopDragPan(),this.map.getMap().stopMouseWheelZoom(),this._mapMousemove=function(e){o=e.mapX,n=e.mapY;e={startX:i,startY:r,endX:o,endY:n};a=s._drawSquare(e)},this._mapMousedown=function(e){i=e.mapX,r=e.mapY,s.map.on("mousemove",s._mapMousemove)},this._mapMouseup=function(i){s.map.off("mousedown",s._mapMousedown),s.map.off("mousemove",s._mapMousemove),s.map.off("mouseup",s._mapMouseup),s.map.resumeDragPan(),s.map.resumeMouseWheelZoom();var r=t.selectElementOnMap(a.geometry,s._matchingLayer,e);s.fire("squareMatchingElement",r)},this.map.on("mouseup",this._mapMouseup),this.map.on("mousedown",this._mapMousedown)},cancelSelection:function(){this.map.off("mousedown",self._mapMousedown),this.map.off("mousemove",self._mapMousemove),this.map.off("mouseup",self._mapMouseup),this.map.resumeDragpan(),this.map.resumeMouseWheelZoom()},clearSelection:function(){this._layer.clear()}}),r.include({_drawSquare:function(e){var t,i=new g2.sfs.Point({x:e.startX,y:e.startY,spatialReference:this.map.spatialReference}),r=new g2.sfs.Point({x:e.endX,y:e.startY,spatialReference:this.map.spatialReference}),o=new g2.sfs.Point({x:e.endX,y:e.endY,spatialReference:this.map.spatialReference}),n=new g2.sfs.Point({x:e.startX,y:e.endY,spatialReference:this.map.spatialReference}),a=new g2.sfs.SimpleFillSymbol({fillColor:g2.sfs.Color.fromHex("#44ffffff"),borderColor:g2.sfs.Color.fromHex("#000"),borderThickness:1,style:5}),s=new g2.sfs.Ring({spatialReference:this.map.spatialReference}),l=new g2.sfs.Polygon({spatialReference:this.map.spatialReference});return s.addPoint(i),s.addPoint(r),s.addPoint(o),s.addPoint(n),s.addPoint(i),l.addGeometry(s),this._layer.find("selectSquare")?((t=this._layer.find("selectSquare")).geometry=l,this._layer.remove(t),this._layer.add(t)):(t=new g2.sfs.Element({id:"selectSquare",geometry:l,symbol:a}),this._layer.add(t)),t}}),r}.apply(t,r))||(e.exports=o)},function(e,t,i){"use strict";var r,o;r=[i(1),i(71),i(0),i(5),i(3)],void 0===(o=function(e,t,i,r,o){var n=e.extend({options:{layerId:"measure-layer",showTipLink:!0,symbols:{line:{type:"SimpleFillSymbol",options:{borderColor:{alpha:120,r:255,g:0,b:0},borderThickness:2,opacity:1}},polygon:{type:"SimpleFillSymbol",options:{borderColor:{alpha:120,r:255,g:0,b:0},fillColor:{alpha:50,r:200,g:0,b:0},borderThickness:2,opacity:1}},node:{type:"SimpleMarkerSymbol",options:{style:"circle",borderColor:{alpha:200,r:200,g:0,b:0},fillColor:{alpha:250,r:255,g:255,b:255},borderThickness:2,size:4}},delete:{type:"PictureMarkerSymbol",options:{source:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAA4AAAAOCAIAAACQKrqGAAAACXBIWXMAAA7EAAAOxAGVKw4bAAAAb0lEQVR42mNYfuABHB28sxOIjtzds+bwQ2RxCGKAUP8ZGPAghFIQHz8Aq0ZSCjEDVQVcCptSuGpkLrpSZGkMbdjciqmOYqXEOoAEbxEMLGBMEhMFQGUMkHjHH7EQNQxfP38AojMPjx6+uxsihAsBAMBJhSJg1b4KAAAAAElFTkSuQmCC",width:14,height:14,opacity:1}}},styleName:["emap-measure-node-tooltip","emap-measure-tooltip"],lengthTipFn:function(e,t){isNaN(t)||(t=(t/1e3).toFixed(2));var i={start:function(){return"起点"},node:function(e){return e+"公里"},end:function(e){return"总长:"+e+"公里"}},r=i[e];if("[object Function]"==Object.prototype.toString.call(r))return i[e](t)},areaTipFn:function(e,t){return"周长:"+(e=(e/1e3).toFixed(2))+"公里 <br/>面积:"+(t=(t/1e6).toFixed(2))+"平方公里"}},initialize:function(t){e.prototype.initialize.call(this,t),this._measuringTool=null,this._measuringObj=null,this._measures={},this._initialize(),this.map.on("click",this._clickHandler,this)},destroy:function(){this.clear(),this.map.removeLayer(this._drawLayer),this.map.removeLayer(this._measureLayer),this.map.off("click",this._clickHandler),e.prototype.destroy.call(this)}});return n.include({_initialize:function(){var e=this.map.getLayerById(this.options.layerId+"-draw");e||(e=new g2.carto.ElementLayer({id:this.options.layerId+"-draw"}),this.map.addLayer(e));var t=this.map.getLayerById(this.options.layerId);t||(t=new g2.carto.ElementLayer({id:this.options.layerId}),this.map.addLayer(t)),this._drawLayer=e,this._measureLayer=t,this._toolTipWare=new g2.widget.TooltipWare({map:this.map}),this._nodeSymbol=r.object2Symbol(this.options.symbols.node.type,this.options.symbols.node.options),this._deleteSymbol=r.object2Symbol(this.options.symbols.delete.type,this.options.symbols.delete.options),this._createTools()},_clickHandler:function(e){var t=e.screenX,i=e.screenY,r=this._measureLayer.hitTest(t,i);if(r&&"_measure_id"in r.element){var o=this._measures[r.element._measure_id];this._clearMeasure(o)}},_clearMeasuring:function(){this._drawLayer.clear(),this._measuringTool&&delete this._measuringTool._measure_id,this._measuringTool=null,this._measuringObj&&this._clearMeasure(this._measuringObj),this._measuringObj=null,this._ellipseElement=null,delete this._ellipseElement},_clearMeasure:function(e){if(i.isObject(e)){var t=e.element,r=e.nodes,o=e.tooltips,n=e.deleteEle,a=e.linkEle;t&&this._measureLayer.remove(t),n&&this._measureLayer.remove(n),a&&this._measureLayer.remove(a);for(var s=0,l=r.length;s<l;s++)r[s]&&this._measureLayer.remove(r[s]);for(s=0,l=o.length;s<l;s++)this._toolTipWare.remove(o[s].id)}}}),n.include({measureLength:function(){this.cancel(),this._measuringTool=this._lineTool,this._measuringTool.onClick(),this._measuringTool._measure_id=i.newUUID32()},measureArea:function(){this.cancel(),this._measuringTool=this._polygonTool,this._measuringTool.onClick(),this._measuringTool._measure_id=i.newUUID32()},measureCircle:function(){this.cancel(),this._measuringTool=this._circleTool,this._measuringTool.onClick(),this._measuringTool._measure_id=i.newUUID32()},measureEllipse:function(){this.cancel(),this._measuringTool=this._ellipseTool,this._measuringTool.onClick(),this._measuringTool._measure_id=i.newUUID32()},finish:function(){if(!this._measuringTool)throw new Error("当前无测量！");try{this._measuringTool.onEndDraw()}catch(e){throw new Error("结束异常！error="+e.message)}},cancel:function(){this._noopTool.onClick(),this._clearMeasuring()},clear:function(){this._drawLayer.clear(),this._measureLayer.clear(),this._toolTipWare.clear()}}),t.extend(n,"_measure_id"),n}.apply(t,r))||(e.exports=o)},function(e,t,i){"use strict";var r,o;r=[i(1),i(0),i(5),i(3)],void 0===(o=function(e,t,i,r){return{extend:function(e,o){var n="NoopTool";e.include({_createTools:function(){var e=this.options.symbols,t=i.object2Symbol(e.line.type,e.line.options),r=i.object2Symbol(e.polygon.type,e.polygon.options),o={map:this.map,spatialRef:{srid:this.map.spatialReference},tooltipWare:this._toolTipWare},a=new g2.sfs.Path({spatialReference:this.map.spatialReference}),s=new g2.sfs.Polyline({spatialReference:this.map.spatialReference});s.addGeometry(a),this._polylineTemplate=new g2.sfs.Element({geometry:s,symbol:t}),this._lineTool=new g2.draw.DrawTool({id:"measureLineTool",cursor:"crosshair",templateElement:this._polylineTemplate.copy(),drawLayer:this._drawLayer}),this._extendLineTool(this._lineTool),this._lineTool.onCreate(o);var l=new g2.sfs.Ring({spatialReference:this.map.spatialReference}),c=new g2.sfs.Polygon({spatialReference:this.map.spatialReference});c.addGeometry(l),this._polygonTemplate=new g2.sfs.Element({geometry:c,symbol:r}),this._polygonTool=new g2.draw.DrawTool({id:"measurePolygonTool",cursor:"crosshair",templateElement:this._polygonTemplate.copy(),drawLayer:this._drawLayer}),this._extendPolygonTool(this._polygonTool),this._polygonTool.onCreate(o),this._circleTool=new g2.draw.DrawTool({id:"measureCircleTool",cursor:"crosshair",templateElement:this._polygonTemplate.copy(),drawLayer:this._drawLayer}),this._extendCircleTool(this._circleTool),this._circleTool.onCreate(o),this._ellipseTool=new g2.draw.DrawTool({id:"measureEllipseTool",cursor:"crosshair",templateElement:this._polygonTemplate.copy(),drawLayer:this._drawLayer}),this._extendEllipseTool(this._ellipseTool),this._ellipseTool.onCreate(o),this._noopTool=new g2.interact.NoopTool({id:n,cursor:"pointer"}),this._noopTool.onCreate(o)},_extendLineTool:function(e){var i=this;e.onMouseUp=function(){(function(e,i,r,n,a,s,l){var c=this._measuringTool[o],h=this._getMeasuring(c),p=new g2.sfs.Point({x:a,y:s,spatialReference:this.map.spatialReference}),u=this._lineTool.drawElement.geometry.paths[0].points.slice(h.points.length);"ontouchend"in document?0===h.points.length?u=u.slice(0,1).concat(u.slice(2)):1===h.points.length&&(u=u.slice(1)):u=u.slice(0,u.length-1);for(var f=0,y=u.length;f<y;f++){var p=u[f],d=this._addNodeEle(c,p,this._nodeSymbol);h.nodes.push(d),h.points.push(p);var m,g,v=this._getStyleName(0),_=this._measureLayer.id;1==h.points.length?m=this.options.lengthTipFn("start"):(g=this._measurePolyline(h.points),m=this.options.lengthTipFn("node",g));var b=new g2.widget.Tooltip({id:t.newUUID32(),anchor:p,content:m,layerId:_,offset:[10,0],className:v});h.tooltips.push(b),this._toolTipWare.add(b)}}).apply(i,arguments)},e.onEndDraw=function(){(function(e){e=e||this._drawLayer.elements[0];var i=this._measuringTool[o],r=this._getMeasuring(i);if(r.points.length<2)throw new Error("距离测量至少两个点！");e.geometry=this._constructGeometry("polyline",r.points);var n=r.tooltips.splice(r.tooltips.length-1,1)[0];this._toolTipWare.remove(n.id);var a=this._measureLayer.id,s=this._getStyleName(1),l=this._measurePolyline(r.points),c=this.options.lengthTipFn("end",l),h=function(e){var t=this.options.symbols.delete.options,i=t.width,r=t.height,o=t.offsetX,n=t.offsetY,a=e.points;if(isNaN(o)&&a.length>1){var s=a[a.length-1],l=a[a.length-2];o=s.x>=l.x?-5:i+5}return isNaN(n)&&(n=r/2),[o,n]}.call(this,r),p=new g2.widget.Tooltip({id:t.newUUID32(),anchor:n.anchor,content:c,layerId:a,offset:[10,h[1]],className:s});r.tooltips.push(p),this._toolTipWare.add(p),this._deleteSymbol.offsetX=h[0],this._deleteSymbol.offsetY=h[1];var u=new g2.sfs.Element({geometry:n.anchor,symbol:this._deleteSymbol});u[o]=i,this._measureLayer.add(u),r.deleteEle=u,this._measureLayer.add(e),r.element=e,this._measures[i]=r,this._measuringObj=null,this.cancel()}).apply(i,arguments)}},_extendPolygonTool:function(e){var i=this;e.onMouseUp=function(){(function(e,t,i,r,n,a,s){var l=this._measuringTool[o],c=this._getMeasuring(l),h=new g2.sfs.Point({x:n,y:a,spatialReference:this.map.spatialReference}),p=this._polygonTool.drawElement.geometry.shell.points;p.length>2&&(h=p[p.length-3]);var u=this._addNodeEle(l,h,this._nodeSymbol);c.nodes.push(u),c.points.push(h)}).apply(i,arguments)},e.onEndDraw=function(){(function(e){e=e||this._drawLayer.elements[0];var i=this._measuringTool[o],r=this._getMeasuring(i);if(r.points.length<3)throw new Error("多边形测量至少三个点！");e.geometry=this._constructGeometry("polygon",r.points);var n=this._measurePolygon(r.points),a=this._getStyleName(1),s=this._measureLayer.id,l=[0,0],c=this.options.areaTipFn.apply(window,n),h=e.geometry.getBaryCenter(),p=new g2.sfs.Point(h),u=new g2.widget.Tooltip({id:t.newUUID32(),anchor:p,content:c,layerId:s,offset:l,className:a});r.tooltips.push(u),this._toolTipWare.add(u);var l=this._caculateDeleteMarkerOffset(r);this._deleteSymbol.offsetX=l[0],this._deleteSymbol.offsetY=l[1];var f=r.points[r.points.length-1],y=new g2.sfs.Element({geometry:f,symbol:this._deleteSymbol});y[o]=i,this._measureLayer.add(y),r.deleteEle=y,this._addLinkEle(r,p,f),this._measureLayer.add(e),r.element=e,this._measures[i]=r,this._measuringObj=null,this.cancel()}).apply(i,arguments)}},_extendCircleTool:function(e){var t=this;function i(e,t){if(e.points.length>0){e.points=e.points.splice(0,1),e.points.push(t);var i=e.points,o=i[0],n=i[1],a=this.map.getPixelFromCoordinate([o.x,o.y]),s=this.map.getPixelFromCoordinate([n.x,n.y]),l=Math.sqrt(Math.pow(a[0]-s[0],2)+Math.pow(a[1]-s[1],2));if(0==parseFloat(l).toFixed(6))return;for(var c=r.getCirclePonits({center:a,radius:l,count:128,spatialReference:3857}),h=new g2.sfs.Ring,p=0,u=c.length;p<u;p++){var f=c[p],y=this.map.getCoordinateFromPixel(f);h.addPoint(new g2.sfs.Point({x:y[0],y:y[1]}))}var d=this._drawLayer.elements[0],m=d.geometry;m.removeAllGeometry(),m.addGeometry(h),this._drawLayer.update(d)}}e.onMouseUp=function(){(function(e,t,r,n,a,s,l){var c=this._measuringTool[o],h=this._getMeasuring(c),p=new g2.sfs.Point({x:a,y:s,spatialReference:this.map.spatialReference});0==h.points.length?h.points.push(p):(i.call(this,h,p),this._onCircleEllipseEndDraw.call(this))}).apply(t,arguments)},e.onMouseMove=function(){(function(e,t,r,n,a,s,l){var c=this._measuringTool[o],h=this._getMeasuring(c),p=new g2.sfs.Point({x:a,y:s,spatialReference:this.map.spatialReference});i.call(this,h,p)}).apply(t,arguments)},e.onEndDraw=function(){t._onCircleEllipseEndDraw.apply(t,arguments)}},_extendEllipseTool:function(e){var i=this;function r(e,t){if(e.points.length>0){e.points=e.points.splice(0,1),e.points.push(t);var i=this._ellipseElement.plot,r=this._ellipseElement.algorithm.createGeometries(i,t)[0],o=this._drawLayer.elements[0];o.geometry=r,this._drawLayer.update(o)}}e.onMouseUp=function(){(function(e,i,n,a,s,l,c){var h=this._measuringTool[o],p=this._getMeasuring(h),u=new g2.sfs.Point({x:s,y:l,spatialReference:this.map.spatialReference});0==p.points.length?(p.points.push(u),this._ellipseElement=function(e){var i=new g2.plot.EllipseAlgorithm({}),r=new g2.sfs.AttributeSet,o=new g2.sfs.PlotElement({id:t.newUUID32(),kind:"ellipseTemplate",algorithm:i,attributeSet:r}),n=new g2.sfs.Element({geometry:new g2.sfs.Polygon,attributeSet:r});return o.add(n),o.reset(),o}.call(this,{}),this._ellipseElement.plot.addControlPoint(u)):(r.call(this,p,u),this._onCircleEllipseEndDraw.call(this))}).apply(i,arguments)},e.onMouseMove=function(){(function(e,t,i,n,a,s,l){var c=this._measuringTool[o],h=this._getMeasuring(c),p=new g2.sfs.Point({x:a,y:s,spatialReference:this.map.spatialReference});r.call(this,h,p)}).apply(i,arguments)},e.onEndDraw=function(){i._onCircleEllipseEndDraw.apply(i,arguments)}},_constructGeometry:function(e,t){return{polyline:function(e){for(var t=new g2.sfs.Path,i=0;i<e.length;i++)t.addPoint(e[i]);var r=new g2.sfs.Polyline;return r.addGeometry(t),r},polygon:function(e){for(var t=new g2.sfs.Ring,i=0;i<e.length;i++)t.addPoint(e[i]);var r=new g2.sfs.Polygon;return r.addGeometry(t),r}}[e](t)},_onCircleEllipseEndDraw:function(e){e=e||this._drawLayer.elements[0];var i=this._measuringTool[o],r=this._getMeasuring(i),n=e.geometry.shell,a=this._measurePolygon(n.points),s=this._getStyleName(1),l=this._measureLayer.id,c=[0,0],h=this.options.areaTipFn.apply(window,a),p=e.geometry.getBaryCenter(),u=new g2.sfs.Point(p),f=new g2.widget.Tooltip({id:t.newUUID32(),anchor:u,content:h,layerId:l,offset:c,className:s});r.tooltips.push(f),this._toolTipWare.add(f),c=this._caculateDeleteMarkerOffset(r,!0),this._deleteSymbol.offsetX=c[0],this._deleteSymbol.offsetY=c[1];var y=n.points[parseInt(7*(n.points.length-1)/8)],d=new g2.sfs.Element({geometry:y,symbol:this._deleteSymbol});d[o]=i,this._measureLayer.add(d),r.deleteEle=d,this._addLinkEle(r,u,y),this._measureLayer.add(e),r.element=e,this._measures[i]=r,this._measuringObj=null,this.cancel()},_caculateDeleteMarkerOffset:function(e,t){var i=this.options.symbols.delete.options,r=i.width,o=i.height,n=i.offsetX,a=i.offsetY,s=e.points;if(isNaN(n)&&s.length>1){var l=s[s.length-1],c=s[s.length-2];n=!0===t||l.x>=c.x?-5:r+5}return isNaN(a)&&(a=o/2),[n,a]},_addNodeEle:function(e,t,i){var r=new g2.sfs.Element({geometry:t,symbol:i});return this._measureLayer.add(r),r},_addLinkEle:function(e,t,r){if(!0===this.options.showTipLink){var o=this.options.symbols,n=new g2.sfs.Path;n.addPoint(t),n.addPoint(r);var a=new g2.sfs.Polyline;a.addGeometry(n);var s=jQuery.extend(!0,{},o.line);"SimpleFillSymbol"==s.type&&(s={type:"SimpleLineSymbol",options:{color:s.options.borderColor}}),s.options.style=3,s.options.width=2,s.options.color.alpha*=.7;var l=i.geoinfoToElement(a,s);this._measureLayer.add(l),e.linkEle=l}},_getStyleName:function(e){return t.isArray(this.options.styleName)?this.options.styleName[e]:this.options.styleName},_getMeasuring:function(e){return this._measuringObj||(this._measuringObj={element:null,points:[],tooltips:[],nodes:[],deleteEle:null,linkEle:null}),this._measuringObj.id=e,this._measuringObj},_measurePolyline:function(e){for(var t=new g2.sfs.Path({spatialReference:this.map.spatialReference}),i=0,o=e.length;i<o;i++)t.addPoint(e[i]);var n=new g2.sfs.Polyline({spatialReference:this.map.spatialReference});return n.addGeometry(t),r.measureLength(n)},_measurePolygon:function(e){for(var t=new g2.sfs.Ring({spatialReference:this.map.spatialReference}),i=0,o=e.length;i<o;i++)t.addPoint(e[i]);t.addPoint(e[0]);var n=new g2.sfs.Polygon({spatialReference:this.map.spatialReference});return n.addGeometry(t),[o=r.measureLength(n),r.measureArea(n)]}})}}}.apply(t,r))||(e.exports=o)},function(e,t,i){"use strict";var r,o;r=[i(1),i(73),i(0),i(7),i(5),i(11),i(3)],void 0===(o=function(e,t,i,r,o,n,a){var s=e.extend({options:{collision:"visibility",symbol:{type:"SimpleLineSymbol",options:{color:{alpha:250,r:0,g:0,b:0},style:5,width:2}}},initialize:function(t){e.prototype.initialize.call(this,t),this._tailLables=[],this._tailOpts={tailLength:!0,tailAlign:!0,tailAngle:!0,symbol:!0,showArrow:!0,arrowSymbol:!0,arrowShape:!0,arrowLength:!0,arrowScale:!0,arrowAngle:!0,domClassName:!0,domStyle:!0},this._lastLevel=this.map.getZoomLevel(),this.map.on("extentchanged",this._onExtentChange,this);try{this.map.map.on("pointerdrag",this._onMapDragg,this)}catch(e){}},clear:function(){for(var e=0,t=this._tailLables.length;e<t;e++)try{this._tailLables[e].destroy()}catch(e){}this._tailLables=[]},destroy:function(){this.map.off("extentchanged",this._onExtentChange,this);try{this.map.map.un("pointerdrag",this._onMapDragg,this)}catch(e){}e.prototype.destroy.call(this)}});return s.include({_onExtentChange:function(e){var t="";t=this._lastLevel==this.map.getZoomLevel()?"updateDom":"update";for(var i=0,r=this._tailLables.length;i<r;i++)try{this._tailLables[i][t]()}catch(e){}this._lastLevel=this.map.getZoomLevel(),this._detectCollision()},_onMapDragg:function(e){e.pixel,e.coordinate;for(var t=0,i=this._tailLables.length;t<i;t++)try{this._tailLables[t].updateDom()}catch(e){}this._detectCollision()},_detectCollision:function(){({none:function(){},visibility:function(){for(var e=[],t=0,i=this._tailLables.length;t<i;t++){var r=this._tailLables[t];o(r,e)?r.toggleVisible(!1):(r.toggleVisible(!0),e.push(r))}function o(e,t){for(var i=!1,r=0,o=t.length;r<o;r++){var n=t[r];if(e.intersects(n)){i=!0;break}}return i}}})[this.options.collision].call(this)},_getLayer:function(){if(!this._layer){var e=this.options.layerId,t=r.getLayerById(this.map,e);t||(t=new g2.carto.ElementLayer({map:this.map,id:e}),this.map.addLayer(t)),this._layer=t}return this._layer},_getTailedLabel:function(e){for(var t=null,i=this._tailLables.length-1;i>=0;i--){var r=this._tailLables[i];if(r&&r.getId()==e){t=r;break}}return t}}),s.include({add:function(e){var i=jQuery.extend(!0,{},e);for(var r in this._tailOpts)i[r]=i[r]||this.options[r];i.layer=this._getLayer(),i.map=this.map;var o=new t(i);return o.setContent(i.label),this._tailLables.push(o),this._detectCollision(),o.getId()},update:function(e,t,i){var r=!1,o=this._getTailedLabel(e);return null!=o&&(o.setContent(t),null!=i&&o.update(i||{}),r=!0),r},remove:function(e){for(var t=!1,i=this._tailLables.length-1;i>=0;i--){var r=this._tailLables[i];if(r&&r.getId()==e){r.destroy(),this._tailLables.splice(i,1),t=!0;break}}return t},removeAll:function(){for(var e=this._tailLables.length-1;e>=0;e--){var t=this._tailLables[e];t&&(t.destroy(),this._tailLables.splice(e,1))}}}),s}.apply(t,r))||(e.exports=o)},function(e,t,i){"use strict";var r,o;r=[i(74),i(0),i(5),i(11),i(3)],void 0===(o=function(e,t,i,r,o){var n=e.extend({options:{domContainer:"emap-tailedlabel-container",tailLength:100,tailAlign:"auto",tailAngle:45,minHeight:15,minWidth:50,domTag:"span"},initialize:function(t){e.prototype.initialize.call(this,t)},destroy:function(){e.prototype.destroy.call(this)}});return n.include({_getDomAnchorPos:function(){var e=this.options.tailAngle,i={"[0,90)":{xVar:0,yVar:-1},"[90,180)":{xVar:0,yVar:0},"[180,270)":{xVar:-1,yVar:0},"[270,360)":{xVar:-1,yVar:-1}},r={};for(var o in i)if(t.assertWithin(e,o)){r=i[o];break}return"center"===this.options.tailAlign&&(r.xVar=-.5),r}}),n.include({}),n}.apply(t,r))||(e.exports=o)},function(e,t,i){"use strict";var r,o;r=[i(4),i(0),i(75),i(5),i(11),i(3),i(2),i(6)],void 0===(o=function(e,t,i,r,o,n,a,s){var l=e.extend({options:{domContainer:"emap-taileddiv-container",tailLength:100,tailAngle:45,showArrow:!1,arrowAngle:30,arrowScale:.3,arrowLength:NaN,arrowSymbol:!1,arrowShape:"triangle",minHeight:15,minWidth:50,symbol:{type:"SimpleLineSymbol",options:{color:{alpha:200,r:0,g:0,b:255},style:"5",width:1}},domTag:"div",domMinGap:[5,5,5,5],domHtml:"新建引线文本",mousedownTime:null,mouseUpTime:null},includes:s.prototype,initialize:function(i){e.setOptions(this,i),this._id=i.id||t.newUUID32(),this.options.domId=this.options.domId||this._id,this.options.domHtml=i.label,this._visible=!1,this._tail=null,this._tailArrow=null,this._dom=null,this._domContainer=null,this._tailAnchor=null,this._domAnchor=null,this._domBounds=[],this.options.geometry=n.toJstsGeometry(this.options.geometry);var r={position:"absolute",display:"block","white-space":"nowrap","min-width":this.options.minWidth+"px","min-height":this.options.minHeight+"px","font-family":"SimSun"};this.options.domStyle=jQuery.extend(!0,r,this.options.domStyle||{}),this._domMove=!1,this._domMoveStart={},this._update()},update:function(e){var t=JSON.stringify(this.options.domStyle);if(e&&jQuery.extend(!0,this.options,e),t!=JSON.stringify(this.options.domStyle))for(var i in this.options.domStyle)this._dom.css(i,this.options.domStyle[i]);this._update()},destroy:function(){this._unbindDomEvent(),this._clearTail(),this._clearDom()}});return l.include({getId:function(){return this._id},updateTail:function(){this._clearTail(),this._updateTailAnchor(),this._updateDomAnchor(),this._updateTail(),!0===this.options.showArrow&&this._updateArrow()},updateDom:function(){this._updateTailAnchor(),this._updateDomAnchor(),this._updateDomPosition()},setContent:function(e){this._dom.html(e),this.options.domHtml=e},getBounds:function(){var e=this.options.domMinGap,t=[];return t.push(this._domBounds[0]-e[0]),t.push(this._domBounds[1]-e[1]),t.push(this._domBounds[2]+e[2]),t.push(this._domBounds[3]+e[3]),t},intersects:function(e){var t=e.getBounds(),i=this.getBounds(),r=new jsts.geom.Envelope(t[0],t[2],t[1],t[3]);return new jsts.geom.Envelope(i[0],i[2],i[1],i[3]).intersects(r)},toggleVisible:function(e){e=!!e;var t=this._getDom();e?t.css("display","block"):t.css("display","none");var i=this.options.layer;null!=this._tail&&i.showElement(this._tail,e),null!=this._tailArrow&&i.showElement(this._tailArrow,e),this._visible=e},visible:function(){return this._visible},serialize:function(){var e=jQuery.extend(!0,{},this.options);return delete e.layer,delete e.map,console.log(e),JSON.stringify(e)}}),l.include({_getDomContainer:function(){if(null==this._domContainer){var e=this.options.domContainer;if(0==jQuery("#"+e).length){var t='<div id="'+e+'"';t+='style="top:0px;left:0px;position:absolute;pointer-events:auto;cursor:pointer"',t+="></div>",jQuery("#"+this.options.map.id).find(".ol-overlaycontainer-stopevent").append(t)}this._domContainer=jQuery("#"+e)}return this._domContainer},_getDom:function(){var e=this._getDomContainer(),t=this.options.domId,i=this.options.domTag;if(null==this._dom){var r="<"+i+' id="'+t+'"';if(this.options.domClassName&&(r+=' class="'+this.options.domClassName+'" '),this.options.domStyle){var o="";for(var n in this.options.domStyle)o+=n+":"+this.options.domStyle[n]+";";r+=' style="'+o+'" '}r+="></"+i+">",e.append(r),this._dom=jQuery("#"+t),this._bindDomEvent()}return this._dom},_update:function(){this.updateTail(),this.updateDom()},_updateDomPosition:function(){var e=this._getDom(),t=this._getDomAnchorPos(),i=e.outerWidth(),r=e.outerHeight(),o=this._domAnchor[2]+t.xVar*i,n=this._domAnchor[3]+t.yVar*r;e.css("marginLeft",o+"px"),e.css("marginTop",n+"px"),this._domBounds=[o,n,o+i,n+r]},_drawBounds:function(){this._bounds&&this.options.layer.remove(this._bounds);var e=[],i=this.options.map;function o(e,t,i){var r=i.getCoordinateFromPixel(t);e.push(r)}var n=this.getBounds();o(e,[n[0],n[1]],i),o(e,[n[0],n[3]],i),o(e,[n[2],n[3]],i),o(e,[n[2],n[1]],i),o(e,[n[0],n[1]],i);var a={type:"Polygon",coordinates:[e]};this._bounds=r.geoinfoToElement(a,{type:"SimpleFillSymbol",options:{borderColor:{alpha:120,r:255,g:0,b:0},fillColor:{alpha:50,r:200,g:0,b:0},borderThickness:2,opacity:1}},{id:t.newUUID32(),layer:this.options.layer})},_getDomAnchorPos:function(){return{xVar:0,yVar:-1}},_updateTailAnchor:function(){var e=this.options.map,t=this.options.geometry.getCentroid().coordinate,i=[t.x,t.y],r=e.getPixelFromCoordinate(i);this._tailAnchor=i.concat(r)},_updateDomAnchor:function(){var e=this._tailAnchor,t=this.options.tailLength,i=this.options.tailAngle,r=this.options.map,o=(270+i)*Math.PI/180,n=[e[2]+Math.cos(o)*t,e[3]+Math.sin(o)*t],a=r.getCoordinateFromPixel(n);this._domAnchor=a.concat(n)},_updateTail:function(){var e=this._tailAnchor,t=this._domAnchor,i={type:"LineString",coordinates:[[e[0],e[1]],[t[0],t[1]]]};this._tail=r.geoinfoToElement(i,this.options.symbol,{id:this._id,layer:this.options.layer})},_updateArrow:function(){var e={},t=this.options.map;e.startPt=this._domAnchor.slice(2),e.endPt=this._tailAnchor.slice(2),e.arrowScale=this.options.arrowScale,e.arrowAngle=this.options.arrowAngle,e.arrowLength=this.options.arrowLength;for(var o=i.getSimpleArrow(e),n=[],a=0,s=o.length;a<s;a++){var l=o[a],c=t.getCoordinateFromPixel(l);n.push(c)}var h=((t={line:function(e){return{geometry:{type:"LineString",coordinates:e},symbol:this.options.arrowSymbol||this.options.symbol}},triangle:function(e){e.push(e[0]);var t,i={type:"Polygon",coordinates:[e]};if(this.options.arrowSymbol)t=this.options.arrowSymbol;else{t={type:"SimpleFillSymbol",options:{borderColor:{alpha:1,r:0,g:0,b:0},fillColor:{},opacity:1}};var r=this.options.symbol.options;t.options.fillColor=r.fillColor||r.color}return{geometry:i,symbol:t}}})[this.options.arrowShape]||t.triangle).call(this,n);this._tailArrow=r.geoinfoToElement(h.geometry,h.symbol,{id:this._id+"_arrow",layer:this.options.layer})},_moveDomStart:function(e){this._domMove=!0,e.preventDefault(),e.stopPropagation(),this._domMoveStart.disX=e.pageX-this._dom.offset().left,this._domMoveStart.disY=e.pageY-this._dom.offset().top},_moveDomMove:function(e){if(this._domMove){var t=e.pageX-this._domMoveStart.disX,i=e.pageY-this._domMoveStart.disY;this._dom.css({marginLeft:t,marginTop:i});var r=this._getDom(),o=this._getDomAnchorPos(),n=r.outerWidth(),a=r.outerHeight(),s=t-o.xVar*n,l=i-o.yVar*a,c=[s,l],h=this.options.map.getCoordinateFromPixel(c);this._domAnchor=h.concat(c),this._domBounds=[t,i,t+n,i+a];var p=this._tailAnchor,u=p[3]-l,f=p[2]-s,y=Math.atan(Math.abs(u/f)),d=180/Math.PI*y,m=void 0;u<0&&f<0?m=d+90:u>0&&f<0?m=90-d:u<0&&f>0?m=270-d:u>0&&f>0?m=270+d:0==u&&x<0?m=90:0==u&&x>0?m=270:u<0&&0==x?m=180:u>0&&0==x&&(m=0);var g=Math.sqrt(f*f+u*u);this.options.tailLength=g,this.options.tailAngle=m,this._clearTail(),this._updateTail()}},_moveDomEnd:function(){this._domMove=!1,this.fire("updateTailedLabelAttr")},_domMoveMapMove:function(e,t){if(this._domMove){var i=e-this._domMoveStart.disX,r=t-this._domMoveStart.disY;this._dom.css({marginLeft:i,marginTop:r});var o=this._getDom(),n=this._getDomAnchorPos(),a=o.outerWidth(),s=o.outerHeight(),l=i-n.xVar*a,c=r-n.yVar*s,h=[l,c],p=this.options.map.getCoordinateFromPixel(h);this._domAnchor=p.concat(h),this._domBounds=[i,r,i+a,r+s];var u=this._tailAnchor,f=u[3]-c,y=u[2]-l,d=Math.atan(Math.abs(f/y)),m=180/Math.PI*d,g=void 0;f<0&&y<0?g=m+90:f>0&&y<0?g=90-m:f<0&&y>0?g=270-m:f>0&&y>0?g=270+m:0==f&&x<0?g=90:0==f&&x>0?g=270:f<0&&0==x?g=180:f>0&&0==x&&(g=0);var v=Math.sqrt(y*y+f*f);this.options.tailLength=v,this.options.tailAngle=g,this._clearTail(),this._updateTail()}},_changeDomLabel:function(){},_clearTail:function(){null!=this._tail&&(this.options.layer.remove(this._tail),this._tail=null),null!=this._tailArrow&&(this.options.layer.remove(this._tailArrow),this._tailArrow=null)},_clearDom:function(){null!=this._dom&&this._dom.remove()},_bindDomEvent:function(){var e=this;this._dom.on("mousedown",function(t){e.mousedownTime=(new Date).getTime(),e._moveDomStart(t),e.options.map.on("mousemove",function(t){e._domMoveMapMove(t.screenX,t.screenY)}),e.options.map.on("mouseup",function(t){e._moveDomEnd(t)})}),this._dom.on("mouseup",function(t){e.mouseUpTime=(new Date).getTime(),e._moveDomEnd(),e.options.map.off("mousemove"),e.options.map.off("mouseup")}),this._dom.on("click",function(t){e.mouseUpTime-e.mousedownTime<200&&e.fire("tailedLabelClick")})},_unbindDomEvent:function(){this._dom.off("mousedown"),this._dom.off("mousemove"),this._dom.off("mouseup"),this._dom.off("click")}}),l}.apply(t,r))||(e.exports=o)},function(e,t,i){"use strict";var r;void 0===(r=function(){function e(e){return"[object Array]"===Object.prototype.toString.call(e)}var t={angle:function(e,t){var i;return(i=t[0]===e[0]?t[1]>=e[1]?-Math.PI/2:Math.PI/2:Math.atan2(e[1]-t[1],t[0]-e[0]))<0&&(i+=2*Math.PI),180*i/Math.PI},getSimpleArrow:function(i){if(!e((i=i||{}).startPt)||2!=i.startPt.length||!e(i.endPt)||2!=i.endPt.length)throw new Error("参数错误！");var r=i.startPt,o=i.endPt,n=i.arrowLength,a=isNaN(i.arrowScale)?.2:i.arrowScale,s=isNaN(i.arrowAngle)?30:i.arrowAngle,l=!1!==i.forScreen,c=Math.PI,h=t.angle(o,r),p=Math.sqrt(Math.pow(r[0]-o[0],2)+Math.pow(r[1]-o[1],2));isNaN(n)&&(n=p*a);var u=l?-1:1,f=(h+s)*c/180,y=(h-s)*c/180,d=o[0]+Math.cos(f)*n,m=o[1]+u*Math.sin(f)*n,g=o[0]+Math.cos(y)*n,v=o[1]+u*Math.sin(y)*n,_=[];return _.push([d,m]),_.push([o[0],o[1]]),_.push([g,v]),_}};return t}.apply(t,[]))||(e.exports=r)},function(e,t,i){"use strict";var r,o;r=[i(1),i(7),i(0)],void 0===(o=function(e,t,i){var r={NoopTool:"NoopTool"},o=g2.interact.Tool.extend({initialize:function(e){var t=e||{};g2.interact.Tool.call(this,t),this.parent=t.parent,this.onMove=-1,this.currentElement=null,this.center=t.center,this.map=t.map,this.drawLayer=t.drawLayer,this.circleEle=t.circleEle,this.lineEle=t.lineEle,this.picEle=t.picEle,this.textEle=t.textEle,this.geoSearch=t.geoSearch,this.callback=t.callBack,this.query=t.query,this.context=t.context,this.markerSymbol=t.markerSymbol,this.fillSymbol=t.fillSymbol},onMouseUp:function(e,t,i,r,o,n,a){if(this.map.resumeDragPan(),0==this.onMove)this.onMove=-1;else if(this.onMove>0){var s={x:this.center.x,y:this.center.y,radius:this.radius,count:128},l=this.parent._getCircleGeoJson(s);this.callback.call(this.context,l,this.textlength),this.onMove=-1,this.currentElement=null,this.drawLayer.update(this.picEle,!0)}},onMouseDown:function(e,t,i,r,o,n,a){if(this.onMove<0){var s=this.drawLayer.hitTest(i,r);s&&(this.map.stopDragPan(),s&&this.picEle.id==s.element.id&&(this.currentElement=s.element,this.onMove++,this.drawLayer.update(this.picEle,!0)))}},onMouseMove:function(e,t,i,r,o,n,a){if(this.onMove>=0&&this.currentElement){this.currentElement.geometry.x=o,this.currentElement.geometry.y=this.center.y,this.drawLayer.update(this.currentElement);var s=new g2.sfs.Polyline({spatialReference:this.map.spatialReference}),l=new g2.sfs.Path({spatialReference:this.map.spatialReference}),c=this.center,h=new g2.sfs.Point({x:o,y:this.center.y,spatialReference:this.map.spatialReference});l.addPoint(c),l.addPoint(h),s.addGeometry(l),this.lineEle.geometry=s,this.drawLayer.update(this.lineEle),this.radius=Math.abs(c.x-h.x);var p=new g2.sfs.CoordinateTransform,u=new g2.sfs.MeasureService({projectService:p});this.textlength=u.length(this.lineEle.geometry),this.textEle.symbol.text=Math.round(this.textlength)/1e3+"km",this.drawLayer.update(this.textEle,!0),this.drawLayer.remove(this.circleEle);this.center.x,this.center.y,this.textlength;var f=new g2.sfs.Point({x:this.center.x,y:this.center.y,spatialReference:this.map.spatialReference}),y=this.parent._getBufferGeoJson(f,this.textlength),d=g2.sfs.GeometryFactory.createGeometryFromGeoJson(y,this.map.spatialReference),m=new g2.sfs.Ring({spatialReference:this.map.spatialReference});d.addGeometry(m);var g=this.fillSymbol,v=new g2.sfs.Element({geometry:d,symbol:g});this.circleEle=v,this.drawLayer.add(this.circleEle),this.onMove++}},onMouseClick:function(e,t,i,r,o,n,a){}}),n=g2.interact.Tool.extend({initialize:function(e){var t=e||{};g2.interact.Tool.call(this,t),this.onMove=-1,this.currentElement=null,this.geometry=t.geometry,this.map=t.map,this.drawLayer=t.drawLayer,this.lineEle=t.lineEle,this.picEle=t.picEle,this.bufferEle=t.bufferEle,this.maxPoint=t.maxPoint,this.bufferMaxPoint=t.bufferMaxPoint,this.callback=t.callBack,this.context=t.context,this.parent=t.parent,this.textEle=t.textEle,this.fillSymbol=t.fillsymbol},onMouseUp:function(e,t,i,r,o,n,a){if(this.map.resumeDragPan(),0==this.onMove)this.onMove=-1;else if(this.onMove>0){this.callback.call(this.context,this.bufferGeoJSON,this.textlength),this.onMove=-1,this.currentElement=null,this.drawLayer.update(this.picEle,!0)}},onMouseDown:function(e,t,i,r,o,n,a){if(this.onMove<0){var s=this.drawLayer.hitTest(i,r);s&&(this.map.stopDragPan(),s&&this.picEle.id==s.element.id&&(this.currentElement=s.element,this.onMove++))}},onMouseMove:function(e,t,i,r,o,n,a){if(this.onMove>=0&&this.currentElement){var s=this.maxPoint,l=new g2.sfs.Point({x:o,y:n,spatialReference:this.map.spatialReference}),c=new g2.sfs.Polyline({spatialReference:this.map.spatialReference}),h=new g2.sfs.Path({spatialReference:this.map.spatialReference});h.addPoint(s),h.addPoint(l),c.addGeometry(h),this.lineEle.geometry=c,this.radius=Math.abs(s.x-l.x);var p=new g2.sfs.CoordinateTransform,u=new g2.sfs.MeasureService({projectService:p});this.textlength=u.length(this.lineEle.geometry),this.drawLayer.remove(this.bufferEle);var f=(new jsts.io.GeoJSONReader).read(this.geometry);f=f.buffer(this.textlength*(360/(2*Math.PI*6378137))),this.bufferGeoJSON=(new jsts.io.GeoJSONWriter).write(f);var y=this.bufferGeoJSON,d=g2.sfs.GeometryFactory.createGeometryFromGeoJson(y,this.map.spatialReference),m=new g2.sfs.Ring({spatialReference:this.map.spatialReference});d.addGeometry(m);var g=this.fillSymbol;this.bufferEle=new g2.sfs.Element({geometry:d,symbol:g}),this.drawLayer.add(this.bufferEle);var v=y.coordinates,_=this.parent._sortFunction(v,y.type),b=new g2.sfs.Point({x:_[0][0],y:_[0][1],spatialReference:this.map.spatialReference});this.currentElement.geometry=b,this.drawLayer.update(this.currentElement);var w=new g2.sfs.Polyline({spatialReference:this.map.spatialReference}),S=new g2.sfs.Path({spatialReference:this.map.spatialReference});S.addPoint(s),S.addPoint(b),w.addGeometry(S),this.lineEle.geometry=w,this.drawLayer.update(this.lineEle);p=new g2.sfs.CoordinateTransform,u=new g2.sfs.MeasureService({projectService:p});this.textlength=u.length(this.lineEle.geometry),this.drawLayer.remove(this.textEle);var L=Math.round(this.textlength)/1e3+"km",P=new g2.sfs.TextSymbol({text:L,foreground:new g2.sfs.Color({r:255,g:0,b:0,a:255}),offsetX:10,offsetY:-13,rotation:0});this.textEle=new g2.sfs.Element({geometry:w,symbol:P}),this.drawLayer.add(this.textEle),this.onMove++}},onMouseClick:function(e,t,i,r,o,n,a){}}),a=e.extend({options:{name:"缓冲区查询 ",buffer_img:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAUCAYAAADskT9PAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyJpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMy1jMDExIDY2LjE0NTY2MSwgMjAxMi8wMi8wNi0xNDo1NjoyNyAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENTNiAoV2luZG93cykiIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6QzdCRTQ5OTYzRkFFMTFFNDk1NTE5ODREMUQwMDhDMzMiIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6QzdCRTQ5OTczRkFFMTFFNDk1NTE5ODREMUQwMDhDMzMiPiA8eG1wTU06RGVyaXZlZEZyb20gc3RSZWY6aW5zdGFuY2VJRD0ieG1wLmlpZDpDN0JFNDk5NDNGQUUxMUU0OTU1MTk4NEQxRDAwOEMzMyIgc3RSZWY6ZG9jdW1lbnRJRD0ieG1wLmRpZDpDN0JFNDk5NTNGQUUxMUU0OTU1MTk4NEQxRDAwOEMzMyIvPiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gPD94cGFja2V0IGVuZD0iciI/PpA7b9wAAAPDSURBVHjarFZbTxNREJ7d7ba7lbaAgqBUMETEW9OggCYiYIyKJhp+gA/6B4wPhGhMjET9CaivXggxXogkaqLxQXxofCCKFRSjQohRgZa2WLbXXWfWs02tB2ONk3xJe2Z25pvvzDm7Ql9fH3BMQEigaeWQTu8Cw9iB/0sQ1fA3ZhgGCMIs/gojXiGeg8czzwu1cQrbIJWqhETiOOj6YX9LS+X6hga3Q1Gk0rIyB/ylLcZiqaV4PPN5evr7i5GROYhEhpDUFSQS/qVgngJUXIFkcgsWP9dx4IC/pa2t2m63S8bPrqBoEwQzKT5pvHj27Mvj4eGXuHYKSUwWKkBxKmQyjVj8Uld397amnTurdF2HbDYL/8GE5ra2NStcLnloYKAfotFjSOJLPgHZ3F9NO7m3q2uzv7W1KpPJwH81bGaTz1eRTCS2PLx79yKunKBlkaEU9313jdfb3NrevjaLxal7Hvb1BE0U6yNkUE2cqaqtTU17UIUOi4AdUYkE9qCznDon2XkJ9veO5zX0u98yiuOSwLyU37d9+0qcqSMWAdUkoOt1NXV1nmw6bQYW4uDpt7kCDy5s4MbQumUUz4shdau9XjeGNFsEFEQZMnKqTqecpcErwKGz73OJh/vqgRdjgfyW0XOFftoGUZJErFWC2+CysQFUkIAoCoJAAcYfjpxe5KngxRtIRLbbRS2RUMTcMRTFBF4caYPtVT7unfXmHj56foorrQXyW0bPFfpZfiMWiWjgdoeIAFFMIoHw/Oxs3MDLgyft7TNrc4m7L8xwY2jdMornxZC2USouCNMkhmgWx5sTZHn6XTC4INtswFOBcKu36hdpC2EZxfH8lNeG+SffvAkhgadEgGZgCTEHDsfE2Oior76hwbOmtnYVXhjcWRjsqcwdw2J8OF5gk2UIzc1FR548mQRFGbJOASnwDfEVVDVwb2DgYyQcjuKQmHItd6kUA2qEiqeSyaWbV6++B0m6jA2HiIDU2dlJdTLmIEqSDanqrwMBtaa21rGyosJpsARFg3UtoeSKqkIkFIpc6+9/h1t9HUpK7rDGc++CBGLGvBUd+MYVxfjQ4GB8q9+/rtHnK3N7PKq7tFQ1ONIu+/YRRdDi8eRiNKqNjo8vjAYCnzD3DVT5Ptt2I5+Abg4iwAdEClnGaCiDExMbg2Nj61FHD8L9D6/jRWwmhJM3Bi7XI/xN+SPs5P32QUKLMUZiAbEaGU8h3Oy2lIq5f5iq1FTInK+fX0dLzLfsF5HOgpLsASfCweKEIghYc5VCaAzcK/SHAAMA4XIlf6DGCVoAAAAASUVORK5CYII="},initialize:function(r){e.prototype.initialize.call(this,r);var o=this.map.getMap();this.options.layerId=this.options.layerId||i.newUUID32();var n=t.getLayerById(this.map,this.options.layerId);n||(n=new g2.carto.ElementLayer({id:this.options.layerId,map:o}),o.addLayer(n)),this._layer=n},destroy:function(){var t=this.map.getMap();this._layer.clear(),t.removeLayer(this._layer),e.prototype.destroy.call(this)}});return a.include({drawBuffer:function(e){if(this.clearBufferLayer(),i.isEmptyObject(e))throw new Error("传入参数错误！");this.param=e;var t=e.type;this._noopTool(),this.map.off("click",this._getMapPolt()),this.map.off("click",this._getMapClickPoint()),"point"==t&&this.map.on("click",this._getMapClickPoint()),"polyline"==t&&this._drawPolyline(e),"getGeo"==t&&this.map.on("click",this._getMapPolt())},circleBuffer:function(e){this.clearBufferLayer();var t,i,r=e.mapX,n=e.mapY,a=e.radius,s=e.context,l=e.callback,c=this._layer;t=0!=e.showDrag||e.showDrag,i=0!=e.showLine||e.showLine;var h=this.map,p=e.symbol||new g2.sfs.SimpleFillSymbol,u=new g2.sfs.Point({x:r,y:n,spatialReference:h.spatialReference}),f={x:r,y:n,radius:a,angle:90,srs:h.spatialReference},y=this._getCirclePointByAngle(f);if(t){var d=this.options.buffer_img,m=new g2.sfs.PictureMarkerSymbol({source:d,width:32,height:20,rotation:"0",opacity:"1",offsetX:"2",offsetY:"5"});this.picEle=new g2.sfs.Element({id:"moveMarker",geometry:y,symbol:m}),c.add(this.picEle)}var g=new g2.sfs.SimpleLineSymbol({color:new g2.sfs.Color({a:153,r:255,g:0,b:0})}),v=new g2.sfs.Polyline({spatialReference:h.spatialReference}),_=new g2.sfs.Path({spatialReference:h.spatialReference}),b=u,w=y;_.addPoint(b),_.addPoint(w),v.addGeometry(_),this.polylineElement=new g2.sfs.Element({geometry:v,symbol:g});var S=new g2.sfs.CoordinateTransform,L=new g2.sfs.MeasureService({projectService:S}).length(this.polylineElement.geometry),P=Math.round(L)/1e3+"km",E=new g2.sfs.TextSymbol({text:P,foreground:new g2.sfs.Color({r:255,g:0,b:0,a:255}),offsetX:10,offsetY:-13,rotation:0});this.textEle=new g2.sfs.Element({geometry:u,symbol:E}),i&&(c.add(this.polylineElement),c.add(this.textEle));h.spatialReference;var C=new g2.sfs.Point({x:r,y:n,spatialReference:h.spatialReference}),x=this._getBufferGeoJson(C,a),T=g2.sfs.GeometryFactory.createGeometryFromGeoJson(x,h.spatialReference),M=new g2.sfs.Polygon({spatialReference:h.spatialReference});if(T.addGeometry(M),this.circleEle=new g2.sfs.Element({geometry:T,symbol:p}),c.add(this.circleEle),t){var A=new o({center:u,parent:this,callBack:l,map:h,drawLayer:c,circleEle:this.circleEle,lineEle:this.polylineElement,picEle:this.picEle,textEle:this.textEle,markerSymbol:m,context:s,fillSymbol:p});A.onCreate({map:h}),A.onClick()}l.call(s,x,a)},geojsonBuffer:function(e){this.clearBufferLayer();var t,i,r=e.geojson,o=new jsts.io.GeoJSONReader,a=e.radius,s=e.callback,l=e.symbol,c=this._layer,h=this.map,p=e.context;t=0!=e.showDrag||e.showDrag,i=0!=e.showLine||e.showLine,"LineString"==r.type&&r.coordinates.length<2&&(r.coordinates=r.coordinates[0]);var u=$.extend(!0,{},r),f=o.read(r),y=this._sortFunction(r.coordinates,r.type),d=new g2.sfs.Point({x:y[0][0],y:y[0][1],spatialReference:h.spatialReference});f=f.buffer(a*(360/(2*Math.PI*6378137)));var m=(new jsts.io.GeoJSONWriter).write(f),g=m.coordinates,v=this._sortFunction(g,m.type),_=new g2.sfs.Point({x:v[0][0],y:v[0][1],spatialReference:h.spatialReference}),b=new g2.sfs.SimpleLineSymbol({color:new g2.sfs.Color({a:153,r:255,g:0,b:0})}),w=new g2.sfs.Polyline({spatialReference:h.spatialReference}),S=new g2.sfs.Path({spatialReference:h.spatialReference});S.addPoint(d),S.addPoint(_),w.addGeometry(S),this.polylineElement=new g2.sfs.Element({geometry:w,symbol:b}),i&&c.add(this.polylineElement);var L=Math.round(a)/1e3+"km",P=new g2.sfs.TextSymbol({text:L,foreground:new g2.sfs.Color({r:255,g:0,b:0,a:255}),offsetX:10,offsetY:-13,rotation:0});this.textEle=new g2.sfs.Element({geometry:this.polylineElement.geometry,symbol:P}),c.add(this.textEle);var E=this.options.buffer_img,C=new g2.sfs.PictureMarkerSymbol({source:E,width:32,height:20,rotation:"0",opacity:"1",offsetX:"2",offsetY:"5"}),x=new g2.sfs.Element({id:"moveMarker",geometry:_,symbol:C});t&&c.add(x);var T=g2.sfs.GeometryFactory.createGeometryFromGeoJson(m,h.spatialReference),M=l||new g2.sfs.SimpleFillSymbol,A=new g2.sfs.Ring({spatialReference:h.spatialReference});T.addGeometry(A);var R=new g2.sfs.Element({geometry:T,symbol:M});if(c.add(R),t){var k=new n({maxPoint:d,bufferMaxPoint:_,geometry:u,bufferEle:R,parent:this,callBack:s,map:h,drawLayer:c,lineEle:this.polylineElement,picEle:x,textEle:this.textEle,fillsymbol:l,context:p});k.onCreate({map:h}),k.onClick()}s.call(p,m,a)},clearBufferLayer:function(){this._layer&&this._layer.clear()}}),a.include({_noopTool:function(){var e=new g2.gdm.CommandManager,t=new g2.cmd.CommandNotify({manager:e}),i=new g2.gdm.NoopTool({id:r.NoopTooll,cursor:"pointer"});e.add(i);var o=new g2.carto.GraphicSelectionSet;e.onCreate({map:this.map,commandNotify:t,graphicSelectionSet:o,spatialRef:{srid:this.map.spatialReference}}),t.activeCommand(r.NoopTool,null)},_drawPolyline:function(e){var t=this._layer,i=e.callback,r=e.context,o=e.symbol||new g2.sfs.SimpleLineSymbol,n=new g2.sfs.Path({spatialReference:this.map.spatialReference}),a=new g2.sfs.Polyline({spatialReference:this.map.spatialReference});a.addGeometry(n);var s=new g2.sfs.Element({geometry:a,symbol:o});this.ploylinePlot=new g2.draw.DrawTool({id:"ploylinePlot",templateElement:s,layer:t,drawLayer:t});var l=new g2.sfs.CoordinateTransform,c=new g2.sfs.MeasureService({projectService:l});this.ploylinePlot.onCreate({map:this.map,spatialRef:this.map.spatialReference,measureService:c}),this.ploylinePlot.onEndDraw=function(e){t.add(e),this.map.currentTool(null);var o=c.length(e.geometry),n=e.geometry.asGeoJson(),a=Math.round(o)/1e3+"km",s=new g2.sfs.TextSymbol({text:a,foreground:new g2.sfs.Color({r:255,g:0,b:0,a:255}),offsetX:10,offsetY:-13,rotation:0}),l=new g2.sfs.Element({geometry:e.geometry,symbol:s});t.add(l),i.call(r,n,o)},this.ploylinePlot.onClick()},_getBufferGeoJson:function(e,t){if(!e||isNaN(t))return null;var i=null,r=e.spatialReference;if(4326==r){var o={center:[e.x,e.y],radius:t,count:128,spatialReference:r};return(n=G.utils.GeometryUtil.getCirclePonits(o)).push(n[0]),(i={}).coordinates=[n],i.type="Polygon",i}if(3857==r){var n,a=new g2.sfs.CoordinateTransform,s=new g2.sfs.Point({x:e.x,y:e.y,spatialReference:r}),l=a.transform(s,4326),c=(o={center:[l.x,l.y],radius:t,count:128,spatialReference:4326},{type:"Polygon",coordinates:[n=G.utils.GeometryUtil.getCirclePonits(o)]}),h=g2.sfs.GeometryFactory.createGeometryFromGeoJson(c);h.spatialReference=4326,i=a.transform(h,r).asGeoJson()}return i},_getCirclePointByAngle:function(e){var t=e.x,i=e.y,r=e.radius,o=e.angle,n=e.srs;if("3857"==n){var a=new g2.sfs.CoordinateTransform,s=new g2.sfs.Point({x:e.x,y:e.y,spatialReference:n}),l=a.transform(s,4326),c={center:[l.x,l.y],radius:r,count:360,spatialReference:4326},h=G.utils.GeometryUtil.getCirclePonits(c),p={type:"Point",coordinates:[h[o][0],h[o][1]]},u=g2.sfs.GeometryFactory.createGeometryFromGeoJson(p);u.spatialReference=4326;var f=a.transform(u,n).asGeoJson();return p=new g2.sfs.Point({x:f.coordinates[0],y:f.coordinates[1],spatialReference:n})}r/=6378137,o=o*Math.PI/180;var y=i*Math.PI/180,d=t*Math.PI/180,m=Math.asin(Math.sin(y)*Math.cos(r)+Math.cos(y)*Math.sin(r)*Math.cos(o)),g=d+Math.atan2(Math.sin(o)*Math.sin(r)*Math.cos(y),Math.cos(r)-Math.sin(y)*Math.sin(m));if(!isNaN(m)||!isNaN(g)){var v=180*g/Math.PI,_=180*m/Math.PI;return p=new g2.sfs.Point({x:v,y:_,spatialReference:n})}},_getCircleGeoJson:function(e){var t=e.x,i=e.y,r=e.radius,o=e.count,n=[],a={};if("3857"==e.srs){var s={type:"Point"};s.coordinates=[t,i],a=this._getGeoBuffer(s,r)}else{for(var l=0;l<o;l++){var c=360/o;n.push(c*l)}a.type="Polygon";var h=[];r/=6378137;for(var p=0;p<n.length;p++){var u=n[p];u=u*Math.PI/180;var f=i*Math.PI/180,y=t*Math.PI/180,d=Math.asin(Math.sin(f)*Math.cos(r)+Math.cos(f)*Math.sin(r)*Math.cos(u)),m=y+Math.atan2(Math.sin(u)*Math.sin(r)*Math.cos(f),Math.cos(r)-Math.sin(f)*Math.sin(d));if(!isNaN(d)||!isNaN(m)){var g=[],v=180*m/Math.PI,_=180*d/Math.PI;g.push(v),g.push(_),h.unshift(g),p==n.length-1&&h.push(h[0])}}a.coordinates=[h]}return a},_getMapPolt:function(){if(!this._getMapPoltListener){var e=this;this._getMapPoltListener=function(t){for(var i,r=e.param.callback,o=e.options.layerId,n=e.param.map.getLayers(),a=0;a<n.length;a++)n[a].id==o&&(i=n[a]);var s=i.hitTest(t.screenX,t.screenY);s&&(r(s.element.geometry.asGeoJson()),e.map.off("click",e._getMapPolt()))}}return this._getMapPoltListener},_getMapClickPoint:function(){if(!this._mapClickListener){var e=this;this._mapClickListener=function(t){var i=e.param.callback,r=e.param.symbol,o=e._layer,n=new g2.sfs.Point({x:t.mapX,y:t.mapY,spatialReference:e.map.spatialReference}),a=r||new g2.sfs.MarkerSymbol,s=new g2.sfs.Element({geometry:n,symbol:a});o.add(s),e.map.off("click",e._getMapClickPoint()),i(n)}}return this._mapClickListener},_sortFunction:function(e,t){var i=[];if("LineString"==t)(i=e).sort(function(e,t){return e[0]<t[0]?1:-1});else if("Point"==t)i.push(e);else{for(var r=0;r<e.length;r++)for(var o=e[r],n=0;n<o.length;n++)i.push(o[n]);i.sort(function(e,t){return e[0]<t[0]?1:-1})}return i}}),a}.apply(t,r))||(e.exports=o)},function(e,t,i){"use strict";var r,o;r=[i(78)],void 0===(o=function(e){var t=window.G||{};window.G=t,t.data={AnalysisFile:e}}.apply(t,r))||(e.exports=o)},function(e,t,i){var r,o;r=[i(1),i(79)],void 0===(o=function(e,t){var i=e.extend({options:{},initialize:function(t){e.prototype.initialize.call(this,t)},destroy:function(){e.prototype.destroy.call(this)}});return i.include({analysisDifferenceTypeFile:function(e){if(!e.fileUrl||!e.fileType)throw new Error("参数不完整");var t="_analysis"+e.fileType;"function"==typeof this[t]&&(e.layer=layer,this[t](e))},_analysisCsv:function(e){window.papaparse.parse(e.fileUrl,{download:!0,complete:function(t){if(t){for(var i,r,o,n=t.data,a={type:"FeatureCollection",features:[]},s=0;s<n[0].length;s++)"x"!=n[0][s]&&"X"!=n[0][s]&&"longitude"!=n[0][s]&&"LONGITUDE"!=n[0][s]||(i=s),"y"!=n[0][s]&&"Y"!=n[0][s]&&"latitude"!=n[0][s]&&"LATITUDE"!=n[0][s]||(r=s),"wkt"!=n[0][s]&&"SDE.ST_ASTEXT(SHAPE)"!=n[0][s]||(o=s);for(var l in n)if("0"!=l){var c={type:"Feature",properties:{},geometry:{},symbol:{}},h={};if(null!=i||null!=r){var p={type:"Point",coordinates:[n[l][i],n[l][r]]};h.type="SimpleMarkerSymbol",c.geometry=p,c.symbol=h,a.features.push(c)}if(null!=o){if(!n[l][o])break;"LineString"==(p=G.utils.GeometryUtil.getGeoJSONWriter().write(G.utils.GeometryUtil.getWktReader().read(n[l][o]))).type?h.type="SimpleLineSymbol":h.type="SimpleFillSymbol",c.geometry=p,c.symbol=h,a.features.push(c)}}}e.callback&&e.context&&e.callback.call(e.context,a)}})},_analysisShape:function(e){window.shp.load(e.fileUrl,function(t){var i=[],r={type:"FeatureCollection",features:[]};if(t.records.length>0&&(i=t.records),1==t.shapeType||2==t.shapeType)for(var o=0;o<i.length;o++){var n={type:"Feature",properties:{},geometry:{},symbol:{}},a={},s={type:"Point",coordinates:[i[o].shape.content.x,i[o].shape.content.y]};a.type="SimpleMarkerSymbol",n.geometry=s,n.symbol=a,r.features.push(n)}else if(3==t.shapeType||4==t.shapeType)for(o=0;o<i.length;o++){n={type:"Feature",properties:{},geometry:{},symbol:{}},a={},s={type:"LineString",coordinates:[]};if((c=i[o].shape.content.points).length>0)for(var l=0;l<c.length/2;l++)s.coordinates.push([c[2*l],c[2*l+1]]);a.type="SimpleLineSymbol",n.geometry=s,n.symbol=a,r.features.push(n)}else if(5==t.shapeType||6==t.shapeType)for(o=0;o<i.length;o++){var c;n={type:"Feature",properties:{},geometry:{},symbol:{}},a={},s={type:"Polygon",coordinates:[[]]};if((c=i[o].shape.content.points).length>0)for(l=0;l<c.length/2;l++)s.coordinates[0].push([c[2*l],c[2*l+1]]);a.type="SimpleFillSymbol",n.geometry=s,n.symbol=a,r.features.push(n)}e.callback&&e.context&&e.callback.call(e.context,r)},function(e){throw new Error(e)})},_analysisGml:function(e){$.ajax({type:"get",url:e.fileUrl,dataType:"XML",async:!0,success:function(t){var i=$(t).find("featureMember"),r={type:"FeatureCollection",features:[]};i.each(function(){var e={type:"Feature",properties:{},geometry:{},symbol:{}},t={};if($(this).find("Point").length>0){var i=$(this).find("Point").find("pos").text().split(" "),o={type:"Point",coordinates:[i[1],i[0]]};t.type="SimpleMarkerSymbol",e.geometry=o,e.symbol=t,r.features.push(e)}if($(this).find("LineString").length>0){for(var n=$(this).find("LineString").find("posList").text().split(" "),a=(o={type:"LineString",coordinates:[]},0);a<n.length/2;a++)o.coordinates.push([n[2*a+1],n[2*a]]);t.type="SimpleLineSymbol",e.geometry=o,e.symbol=t,r.features.push(e)}if($(this).find("LinearRing").length>0){for(var s=$(this).find("LinearRing").find("posList").text().split(" "),l=(o={type:"Polygon",coordinates:[[]]},0);l<s.length/2;l++)o.coordinates[0].push([s[2*l+1],s[2*l]]);t.type="SimpleFillSymbol",e.geometry=o,e.symbol=t,r.features.push(e)}}),e.callback&&e.context&&e.callback.call(e.context,r)},error:function(e){throw new Error(e.message)}})},_analysisKml:function(e){var t=this;$.ajax({type:"get",url:e.fileUrl,dataType:"XML",async:!0,success:function(i){var r=$(i).find("Placemark"),o=$(i).find("Style"),n=($(i).find("featureMember"),{type:"FeatureCollection",features:[]});r.each(function(){var e={type:"Feature",properties:{},geometry:{},symbol:{}},i={};if($(this).find("Point").length>0){$(this).find("styleUrl").length>0&&(i=t._getSymbolObj(o,$(this).find("styleUrl").text(),"IconStyle"));var r={type:"Point",coordinates:[(l=$(this).find("Point").find("coordinates").text().split(","))[0],l[1]]};e.geometry=r,e.symbol=i,n.features.push(e)}if($(this).find("LineString").length>0){$(this).find("styleUrl").length>0&&(i=t._getSymbolObj(o,$(this).find("styleUrl").text(),"LineStyle"));for(var a=$(this).find("LineString").find("coordinates").text().split(" "),s=(r={type:"LineString",coordinates:[]},0);s<a.length;s++){var l=a[s].split(",");r.coordinates.push([l[0],l[1]])}e.geometry=r,e.symbol=i,n.features.push(e)}if($(this).find("LinearRing").length>0){$(this).find("styleUrl").length>0&&(i=t._getSymbolObj(o,$(this).find("styleUrl").text(),"PolyStyle"));var c=$(this).find("LinearRing").find("coordinates").text().split(" ");for(r={type:"LineString",coordinates:[[]]},s=0;s<c.length;s++){var h=c[s].split(",");r.coordinates[0].push([h[0],h[1]])}e.geometry=r,e.symbol=i,n.features.push(e)}}),e.callback&&e.context&&e.callback.call(e.context,n)},error:function(e){throw new Error(e.message)}})},analysisWfsData:function(e){if(!e.wfsData)throw new Error("传入参数错误！");return t.wfsXmlToJsonDataArray(e.wfsData)}}),i.include({_getSymbolObj:function(e,t,i){var r={};return e.length>0&&e.each(function(){if("#"+$(this)[0].id==t){if("IconStyle"==i){var e=$(this).find("scale").text()||.2,o=$(this).find("href").text()||void 0,n=$(this).find("rotation").text()||0,a=$(this).find("width").text()||void 0,s=$(this).find("height").text()||void 0;r={type:"PictureMarkerSymbol",scale:e,sourceKey:o,width:a,height:s,rotation:n}}if("LineStyle"==i){var l=$(this).find("style").text()||5,c=$(this).find("width").text()||2,h=$(this).find("color").text()||"#ff0000",p=g2.sfs.Color.fromHex(h);r={type:"SimpleLineSymbol",color:p,style:l,width:c}}if("PolyStyle"==i){h=$(this).find("color").text()||"#ff0000";var u=$(this).find("borderThickness").text()||0,f=$(this).find("opacity").text()||1;p=g2.sfs.Color.fromHex(h);r={type:"SimpleFillSymbol",borderColor:p,fillColor:p,borderThickness:u,opacity:f}}}}),r}}),i}.apply(t,r))||(e.exports=o)},function(e,t,i){var r,o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};void 0===(r=function(){var e={};function t(e){var t={};for(var i in e)0==i.indexOf("esri:")&&(t[i.substr(5)]=e[i]);var r=e["gml:envelope"].split(","),o=parseFloat(r[0]),n=parseFloat(r[1]),a=parseFloat(r[2]),s=parseFloat(r[3]);t.longitude=(o+a)/2,t.latitude=(n+s)/2;var l=e["gml:multiPointProperty"],c=e["gml:multiLineStringProperty"],h=e["gml:multiPolygonProperty"];if(l){var p=l["gml:MultiPoint"]["gml:pointMember"],u="";if(p.length){u="MULTIPOINT(",t.wkttype="MULTIPOINT";for(var f=0;f<p.length;f++){var y=p[f]["gml:Point"]["gml:coordinates"];f==p.length-1?u+=y:u+=y+","}u+=")"}else u+="POINT(",t.wkttype="POINT",u+=p["gml:Point"]["gml:coordinates"],u+=")";t.wktdata=u}if(c){var d=c["gml:MultiLineString"]["gml:lineStringMember"],m="";if(d.length){t.wkttype="MULTILINESTRING",m+="MULTILINESTRING(";for(f=0;f<d.length;f++){var g=d[f]["gml:LineString"]["gml:coordinates"];f==d.length-1?m+="("+g.replace(new RegExp(";","gm"),",")+")":m+="("+g.replace(new RegExp(";","gm"),",")+"),"}m+=")"}else{t.wkttype="LINESTRING",m+="LINESTRING(",m+=(g=d["gml:LineString"]["gml:coordinates"]).replace(new RegExp(";","gm"),","),m+=")"}t.wktdata=m}if(h){var v=h["gml:MultiPolygon"]["gml:polygonMember"],_="";if(v.length){t.wkttype="MULTIPOLYGON",_+="MULTIPOLYGON(";for(f=0;f<v.length;f++){var b=v[f]["gml:Polygon"]["gml:outerBoundaryIs"]["gml:LinearRing"]["gml:coordinates"];f==v.length-1?_+="(("+b.replace(new RegExp(";","gm"),",")+"))":_+="(("+b.replace(new RegExp(";","gm"),",")+")),"}_+=")"}else{t.wkttype="POLYGON",_+="POLYGON(",_+="("+(b=v["gml:Polygon"]["gml:outerBoundaryIs"]["gml:LinearRing"]["gml:coordinates"]).replace(new RegExp(";","gm"),",")+")",_+=")"}t.wktdata=_}return l||h||c||(t.wkttype="未知类型"),t}return e.xml2json=function(e,t){var i={toObj:function(e){var t={};if(1==e.nodeType){if(e.attributes.length)for(var r=0;r<e.attributes.length;r++)t["@"+e.attributes[r].nodeName]=(e.attributes[r].nodeValue||"").toString();if(e.firstChild){for(var o=0,n=0,a=!1,s=e.firstChild;s;s=s.nextSibling)1==s.nodeType?a=!0:3==s.nodeType&&s.nodeValue.match(/[^ \f\n\r\t\v]/)?o++:4==s.nodeType&&n++;if(a)if(o<2&&n<2){i.removeWhite(e);for(s=e.firstChild;s;s=s.nextSibling)3==s.nodeType?t["#text"]=i.escape(s.nodeValue):4==s.nodeType?t["#cdata"]=i.escape(s.nodeValue):t[s.nodeName]?t[s.nodeName]instanceof Array?t[s.nodeName][t[s.nodeName].length]=i.toObj(s):t[s.nodeName]=[t[s.nodeName],i.toObj(s)]:t[s.nodeName]=i.toObj(s)}else e.attributes.length?t["#text"]=i.escape(i.innerXml(e)):t=i.escape(i.innerXml(e));else if(o)e.attributes.length?t["#text"]=i.escape(i.innerXml(e)):t=i.escape(i.innerXml(e));else if(n)if(n>1)t=i.escape(i.innerXml(e));else for(s=e.firstChild;s;s=s.nextSibling)t["#cdata"]=i.escape(s.nodeValue)}e.attributes.length||e.firstChild||(t=null)}else 9==e.nodeType?t=i.toObj(e.documentElement):alert("unhandled node type: "+e.nodeType);return t},toJson:function(e,t,r){var n=t?'"'+t+'"':"";if(e instanceof Array){for(var a=0,s=e.length;a<s;a++)e[a]=i.toJson(e[a],"",r+"\t");n+=(t?":[":"[")+(e.length>1?"\n"+r+"\t"+e.join(",\n"+r+"\t")+"\n"+r:e.join(""))+"]"}else if(null==e)n+=(t&&":")+"null";else if("object"==(void 0===e?"undefined":o(e))){var l=[];for(var c in e)l[l.length]=i.toJson(e[c],c,r+"\t");n+=(t?":{":"{")+(l.length>1?"\n"+r+"\t"+l.join(",\n"+r+"\t")+"\n"+r:l.join(""))+"}"}else n+="string"==typeof e?(t&&":")+'"'+e.toString()+'"':(t&&":")+e.toString();return n},innerXml:function(e){var t="";if("innerHTML"in e)t=e.innerHTML;else for(var i=function e(t){var i="";if(1==t.nodeType){i+="<"+t.nodeName;for(var r=0;r<t.attributes.length;r++)i+=" "+t.attributes[r].nodeName+'="'+(t.attributes[r].nodeValue||"").toString()+'"';if(t.firstChild){i+=">";for(var o=t.firstChild;o;o=o.nextSibling)i+=e(o);i+="</"+t.nodeName+">"}else i+="/>"}else 3==t.nodeType?i+=t.nodeValue:4==t.nodeType&&(i+="<![CDATA["+t.nodeValue+"]]>");return i},r=e.firstChild;r;r=r.nextSibling)t+=i(r);return t},escape:function(e){return e.replace(/[\\]/g,"\\\\").replace(/[\"]/g,'\\"').replace(/[\n]/g,"\\n").replace(/[\r]/g,"\\r")},removeWhite:function(e){e.normalize();for(var t=e.firstChild;t;)if(3==t.nodeType)if(t.nodeValue.match(/[^ \f\n\r\t\v]/))t=t.nextSibling;else{var r=t.nextSibling;e.removeChild(t),t=r}else 1==t.nodeType?(i.removeWhite(t),t=t.nextSibling):t=t.nextSibling;return e}};9==e.nodeType&&(e=e.documentElement);var r=i.toJson(i.toObj(i.removeWhite(e)),e.nodeName,"\t");return"{\n"+t+(t?r.replace(/\t/g,t):r.replace(/\t|\n/g,""))+"\n}"},e.json2xml=function(e,t){var i=function e(t,i,r){var n="";if(t instanceof Array)for(var a=0,s=t.length;a<s;a++)n+=r+e(t[a],i,r+"\t")+"\n";else if("object"==(void 0===t?"undefined":o(t))){var l=!1;for(var c in n+=r+"<"+i,t)"@"==c.charAt(0)?n+=" "+c.substr(1)+'="'+t[c].toString()+'"':l=!0;if(n+=l?">":"/>",l){for(var c in t)"#text"==c?n+=t[c]:"#cdata"==c?n+="<![CDATA["+t[c]+"]]>":"@"!=c.charAt(0)&&(n+=e(t[c],c,r+"\t"));n+=("\n"==n.charAt(n.length-1)?r:"")+"</"+i+">"}}else n+=r+"<"+i+">"+t.toString()+"</"+i+">";return n},r="";for(var n in e)r+=i(e[n],n,"");return t?r.replace(/\t/g,t):r.replace(/\t|\n/g,"")},e.wfsXmlToJsonDataArray=function(e,i){return function(e,i){var r,o=JSON.parse(e),n=[];if(!o||!o["wfs:FeatureCollection"])return;r=o["wfs:FeatureCollection"]["gml:featureMember"];if(!r)return;if(r&&null==r.length){for(var a in r)break;n.push(t(r[a]))}else for(var s=0;s<r.length;s++){for(var a in r[s])break;var l=r[s][a],c=t(l);n.push(c)}return n}(this.xml2json(e,""))},e}.apply(t,[]))||(e.exports=r)}])});